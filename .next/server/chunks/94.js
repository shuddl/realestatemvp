exports.id=94,exports.ids=[94],exports.modules={93197:(e,t)=>{"use strict";t.JQ=function(e){for(var t,r=e.length,s=r%3,i=[],a=0,o=r-s;a<o;a+=16383)i.push(function(e,t,r){for(var s,i=[],a=t;a<r;a+=3)i.push(n[(s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]))>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return i.join("")}(e,a,a+16383>o?o:a+16383));return 1===s?i.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===s&&i.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),i.join("")};for(var n=[],r=[],s=("undefined"!=typeof Uint8Array&&Uint8Array,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i=0,a=s.length;i<a;++i)n[i]=s[i],r[s.charCodeAt(i)]=i;r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},315:(e,t,n)=>{"use strict";var r=n(14300).Buffer,s=n(14300).SlowBuffer;function i(e,t){if(!r.isBuffer(e)||!r.isBuffer(t)||e.length!==t.length)return!1;for(var n=0,s=0;s<e.length;s++)n|=e[s]^t[s];return 0===n}e.exports=i,i.install=function(){r.prototype.equal=s.prototype.equal=function(e){return i(this,e)}};var a=r.prototype.equal,o=s.prototype.equal;i.restore=function(){r.prototype.equal=a,s.prototype.equal=o}},644:(e,t,n)=>{"use strict";var r=n(41684).Buffer,s=n(81858);function i(e){if(r.isBuffer(e))return e;if("string"==typeof e)return r.from(e,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function a(e,t,n){for(var r=0;t+r<n&&0===e[t+r];)++r;return e[t+r]>=128&&--r,r}e.exports={derToJose:function(e,t){e=i(e);var n=s(t),a=n+1,o=e.length,c=0;if(48!==e[c++])throw Error('Could not find expected "seq"');var u=e[c++];if(129===u&&(u=e[c++]),o-c<u)throw Error('"seq" specified length of "'+u+'", only "'+(o-c)+'" remaining');if(2!==e[c++])throw Error('Could not find expected "int" for "r"');var l=e[c++];if(o-c-2<l)throw Error('"r" specified length of "'+l+'", only "'+(o-c-2)+'" available');if(a<l)throw Error('"r" specified length of "'+l+'", max of "'+a+'" is acceptable');var h=c;if(c+=l,2!==e[c++])throw Error('Could not find expected "int" for "s"');var p=e[c++];if(o-c!==p)throw Error('"s" specified length of "'+p+'", expected "'+(o-c)+'"');if(a<p)throw Error('"s" specified length of "'+p+'", max of "'+a+'" is acceptable');var d=c;if((c+=p)!==o)throw Error('Expected to consume entire buffer, but "'+(o-c)+'" bytes remain');var f=n-l,v=n-p,g=r.allocUnsafe(f+l+v+p);for(c=0;c<f;++c)g[c]=0;e.copy(g,c,h+Math.max(-f,0),h+l),c=n;for(var m=c;c<m+v;++c)g[c]=0;return e.copy(g,c,d+Math.max(-v,0),d+p),g=(g=g.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=i(e);var n=s(t),o=e.length;if(o!==2*n)throw TypeError('"'+t+'" signatures must be "'+2*n+'" bytes, saw "'+o+'"');var c=a(e,0,n),u=a(e,n,e.length),l=n-c,h=n-u,p=2+l+1+1+h,d=p<128,f=r.allocUnsafe((d?2:3)+p),v=0;return f[v++]=48,d?f[v++]=p:(f[v++]=129,f[v++]=255&p),f[v++]=2,f[v++]=l,c<0?(f[v++]=0,v+=e.copy(f,v,0,n)):v+=e.copy(f,v,c,n),f[v++]=2,f[v++]=h,u<0?(f[v++]=0,e.copy(f,v,n)):e.copy(f,v,n+u),f}}},81858:e=>{"use strict";function t(e){return(e/8|0)+(e%8==0?0:1)}var n={ES256:t(256),ES384:t(384),ES512:t(521)};e.exports=function(e){var t=n[e];if(t)return t;throw Error('Unknown algorithm "'+e+'"')}},32912:(e,t,n)=>{"use strict";e.exports=n(91282)},72817:(e,t,n)=>{"use strict";var r=n(26455);e.exports=function(e,t){t=t||{};var n=r.decode(e,t);if(!n)return null;var s=n.payload;if("string"==typeof s)try{var i=JSON.parse(s);null!==i&&"object"==typeof i&&(s=i)}catch(e){}return!0===t.complete?{header:n.header,payload:s,signature:n.signature}:s}},40183:(e,t,n)=>{"use strict";e.exports={decode:n(72817),verify:n(26973),sign:n(21871),JsonWebTokenError:n(99352),NotBeforeError:n(74113),TokenExpiredError:n(88163)}},99352:e=>{"use strict";var t=function(e,t){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,t&&(this.inner=t)};t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,e.exports=t},74113:(e,t,n)=>{"use strict";var r=n(99352),s=function(e,t){r.call(this,e),this.name="NotBeforeError",this.date=t};s.prototype=Object.create(r.prototype),s.prototype.constructor=s,e.exports=s},88163:(e,t,n)=>{"use strict";var r=n(99352),s=function(e,t){r.call(this,e),this.name="TokenExpiredError",this.expiredAt=t};s.prototype=Object.create(r.prototype),s.prototype.constructor=s,e.exports=s},55194:(e,t,n)=>{"use strict";let r=n(60309);e.exports=r.satisfies(process.version,">=15.7.0")},87435:(e,t,n)=>{"use strict";var r=n(60309);e.exports=r.satisfies(process.version,"^6.12.0 || >=8.0.0")},72723:(e,t,n)=>{"use strict";let r=n(60309);e.exports=r.satisfies(process.version,">=16.9.0")},2261:(e,t,n)=>{"use strict";var r=n(26786);e.exports=function(e,t){var n=t||Math.floor(Date.now()/1e3);if("string"==typeof e){var s=r(e);if(void 0===s)return;return Math.floor(n+s/1e3)}if("number"==typeof e)return n+e}},7549:(e,t,n)=>{"use strict";let r=n(55194),s=n(72723),i={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},a={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};e.exports=function(e,t){if(!e||!t)return;let n=t.asymmetricKeyType;if(!n)return;let o=i[n];if(!o)throw Error(`Unknown key type "${n}".`);if(!o.includes(e))throw Error(`"alg" parameter for "${n}" key type must be one of: ${o.join(", ")}.`);if(r)switch(n){case"ec":let c=t.asymmetricKeyDetails.namedCurve,u=a[e];if(c!==u)throw Error(`"alg" parameter "${e}" requires curve "${u}".`);break;case"rsa-pss":if(s){let n=parseInt(e.slice(-3),10),{hashAlgorithm:r,mgf1HashAlgorithm:s,saltLength:i}=t.asymmetricKeyDetails;if(r!==`sha${n}`||s!==r)throw Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}.`);if(void 0!==i&&i>n>>3)throw Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}.`)}}}},21871:(e,t,n)=>{"use strict";let r=n(2261),s=n(87435),i=n(7549),a=n(26455),o=n(77919),c=n(52909),u=n(84474),l=n(13881),h=n(65840),p=n(20479),d=n(84639),{KeyObject:f,createSecretKey:v,createPrivateKey:g}=n(6113),m=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];s&&m.splice(3,0,"PS256","PS384","PS512");let y={expiresIn:{isValid:function(e){return u(e)||p(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return u(e)||p(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return p(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:o.bind(null,m),message:'"algorithm" must be a valid string enum value'},header:{isValid:h,message:'"header" must be an object'},encoding:{isValid:p,message:'"encoding" must be a string'},issuer:{isValid:p,message:'"issuer" must be a string'},subject:{isValid:p,message:'"subject" must be a string'},jwtid:{isValid:p,message:'"jwtid" must be a string'},noTimestamp:{isValid:c,message:'"noTimestamp" must be a boolean'},keyid:{isValid:p,message:'"keyid" must be a string'},mutatePayload:{isValid:c,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:c,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:c,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},b={iat:{isValid:l,message:'"iat" should be a number of seconds'},exp:{isValid:l,message:'"exp" should be a number of seconds'},nbf:{isValid:l,message:'"nbf" should be a number of seconds'}};function w(e,t,n,r){if(!h(n))throw Error('Expected "'+r+'" to be a plain object.');Object.keys(n).forEach(function(s){let i=e[s];if(!i){if(!t)throw Error('"'+s+'" is not allowed in "'+r+'"');return}if(!i.isValid(n[s]))throw Error(i.message)})}let _={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},x=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];e.exports=function(e,t,n,s){var o,c;"function"==typeof n?(s=n,n={}):n=n||{};let u="object"==typeof e&&!Buffer.isBuffer(e),l=Object.assign({alg:n.algorithm||"HS256",typ:u?"JWT":void 0,kid:n.keyid},n.header);function h(e){if(s)return s(e);throw e}if(!t&&"none"!==n.algorithm)return h(Error("secretOrPrivateKey must have a value"));if(null!=t&&!(t instanceof f))try{t=g(t)}catch(e){try{t=v("string"==typeof t?Buffer.from(t):t)}catch(e){return h(Error("secretOrPrivateKey is not valid key material"))}}if(l.alg.startsWith("HS")&&"secret"!==t.type)return h(Error(`secretOrPrivateKey must be a symmetric key when using ${l.alg}`));if(/^(?:RS|PS|ES)/.test(l.alg)){if("private"!==t.type)return h(Error(`secretOrPrivateKey must be an asymmetric key when using ${l.alg}`));if(!n.allowInsecureKeySizes&&!l.alg.startsWith("ES")&&void 0!==t.asymmetricKeyDetails&&t.asymmetricKeyDetails.modulusLength<2048)return h(Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${l.alg}`))}if(void 0===e)return h(Error("payload is required"));if(u){try{o=e,w(b,!0,o,"payload")}catch(e){return h(e)}n.mutatePayload||(e=Object.assign({},e))}else{let t=x.filter(function(e){return void 0!==n[e]});if(t.length>0)return h(Error("invalid "+t.join(",")+" option for "+typeof e+" payload"))}if(void 0!==e.exp&&void 0!==n.expiresIn)return h(Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(void 0!==e.nbf&&void 0!==n.notBefore)return h(Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{c=n,w(y,!1,c,"options")}catch(e){return h(e)}if(!n.allowInvalidAsymmetricKeyTypes)try{i(l.alg,t)}catch(e){return h(e)}let p=e.iat||Math.floor(Date.now()/1e3);if(n.noTimestamp?delete e.iat:u&&(e.iat=p),void 0!==n.notBefore){try{e.nbf=r(n.notBefore,p)}catch(e){return h(e)}if(void 0===e.nbf)return h(Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(void 0!==n.expiresIn&&"object"==typeof e){try{e.exp=r(n.expiresIn,p)}catch(e){return h(e)}if(void 0===e.exp)return h(Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(_).forEach(function(t){let r=_[t];if(void 0!==n[t]){if(void 0!==e[r])return h(Error('Bad "options.'+t+'" option. The payload already has an "'+r+'" property.'));e[r]=n[t]}});let m=n.encoding||"utf8";if("function"==typeof s)s=s&&d(s),a.createSign({header:l,privateKey:t,payload:e,encoding:m}).once("error",s).once("done",function(e){if(!n.allowInsecureKeySizes&&/^(?:RS|PS)/.test(l.alg)&&e.length<256)return s(Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${l.alg}`));s(null,e)});else{let r=a.sign({header:l,payload:e,secret:t,encoding:m});if(!n.allowInsecureKeySizes&&/^(?:RS|PS)/.test(l.alg)&&r.length<256)throw Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${l.alg}`);return r}}},26973:(e,t,n)=>{"use strict";let r=n(99352),s=n(74113),i=n(88163),a=n(72817),o=n(2261),c=n(7549),u=n(87435),l=n(26455),{KeyObject:h,createSecretKey:p,createPublicKey:d}=n(6113),f=["RS256","RS384","RS512"],v=["ES256","ES384","ES512"],g=["RS256","RS384","RS512"],m=["HS256","HS384","HS512"];u&&(f.splice(f.length,0,"PS256","PS384","PS512"),g.splice(g.length,0,"PS256","PS384","PS512")),e.exports=function(e,t,n,u){let y,b,w;if("function"!=typeof n||u||(u=n,n={}),n||(n={}),n=Object.assign({},n),y=u||function(e,t){if(e)throw e;return t},n.clockTimestamp&&"number"!=typeof n.clockTimestamp)return y(new r("clockTimestamp must be a number"));if(void 0!==n.nonce&&("string"!=typeof n.nonce||""===n.nonce.trim()))return y(new r("nonce must be a non-empty string"));if(void 0!==n.allowInvalidAsymmetricKeyTypes&&"boolean"!=typeof n.allowInvalidAsymmetricKeyTypes)return y(new r("allowInvalidAsymmetricKeyTypes must be a boolean"));let _=n.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return y(new r("jwt must be provided"));if("string"!=typeof e)return y(new r("jwt must be a string"));let x=e.split(".");if(3!==x.length)return y(new r("jwt malformed"));try{b=a(e,{complete:!0})}catch(e){return y(e)}if(!b)return y(new r("invalid token"));let k=b.header;if("function"==typeof t){if(!u)return y(new r("verify must be called asynchronous if secret or public key is provided as a callback"));w=t}else w=function(e,n){return n(null,t)};return w(k,function(t,a){let u;if(t)return y(new r("error in secret or public key callback: "+t.message));let w=""!==x[2].trim();if(!w&&a)return y(new r("jwt signature is required"));if(w&&!a)return y(new r("secret or public key must be provided"));if(!w&&!n.algorithms)return y(new r('please specify "none" in "algorithms" to verify unsigned tokens'));if(null!=a&&!(a instanceof h))try{a=d(a)}catch(e){try{a=p("string"==typeof a?Buffer.from(a):a)}catch(e){return y(new r("secretOrPublicKey is not valid key material"))}}if(n.algorithms||("secret"===a.type?n.algorithms=m:["rsa","rsa-pss"].includes(a.asymmetricKeyType)?n.algorithms=g:"ec"===a.asymmetricKeyType?n.algorithms=v:n.algorithms=f),-1===n.algorithms.indexOf(b.header.alg))return y(new r("invalid algorithm"));if(k.alg.startsWith("HS")&&"secret"!==a.type)return y(new r(`secretOrPublicKey must be a symmetric key when using ${k.alg}`));if(/^(?:RS|PS|ES)/.test(k.alg)&&"public"!==a.type)return y(new r(`secretOrPublicKey must be an asymmetric key when using ${k.alg}`));if(!n.allowInvalidAsymmetricKeyTypes)try{c(k.alg,a)}catch(e){return y(e)}try{u=l.verify(e,b.header.alg,a)}catch(e){return y(e)}if(!u)return y(new r("invalid signature"));let S=b.payload;if(void 0!==S.nbf&&!n.ignoreNotBefore){if("number"!=typeof S.nbf)return y(new r("invalid nbf value"));if(S.nbf>_+(n.clockTolerance||0))return y(new s("jwt not active",new Date(1e3*S.nbf)))}if(void 0!==S.exp&&!n.ignoreExpiration){if("number"!=typeof S.exp)return y(new r("invalid exp value"));if(_>=S.exp+(n.clockTolerance||0))return y(new i("jwt expired",new Date(1e3*S.exp)))}if(n.audience){let e=Array.isArray(n.audience)?n.audience:[n.audience],t=Array.isArray(S.aud)?S.aud:[S.aud],s=t.some(function(t){return e.some(function(e){return e instanceof RegExp?e.test(t):e===t})});if(!s)return y(new r("jwt audience invalid. expected: "+e.join(" or ")))}if(n.issuer){let e="string"==typeof n.issuer&&S.iss!==n.issuer||Array.isArray(n.issuer)&&-1===n.issuer.indexOf(S.iss);if(e)return y(new r("jwt issuer invalid. expected: "+n.issuer))}if(n.subject&&S.sub!==n.subject)return y(new r("jwt subject invalid. expected: "+n.subject));if(n.jwtid&&S.jti!==n.jwtid)return y(new r("jwt jwtid invalid. expected: "+n.jwtid));if(n.nonce&&S.nonce!==n.nonce)return y(new r("jwt nonce invalid. expected: "+n.nonce));if(n.maxAge){if("number"!=typeof S.iat)return y(new r("iat required when maxAge is specified"));let e=o(n.maxAge,S.iat);if(void 0===e)return y(new r('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(_>=e+(n.clockTolerance||0))return y(new i("maxAge exceeded",new Date(1e3*e)))}if(!0===n.complete){let e=b.signature;return y(null,{header:k,payload:S,signature:e})}return y(null,S)})}},17527:(e,t,n)=>{"use strict";var r=n(315),s=n(41684).Buffer,i=n(6113),a=n(644),o=n(73837),c="secret must be a string or buffer",u="key must be a string or a buffer",l="function"==typeof i.createPublicKey;function h(e){if(!s.isBuffer(e)&&"string"!=typeof e&&(!l||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw v(u)}function p(e){if(!s.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw v("key must be a string, a buffer or an object")}function d(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var n=0;n<t;++n)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function v(e){var t=[].slice.call(arguments,1);return TypeError(o.format.bind(o,e).apply(null,t))}function g(e){var t;return t=e,s.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function m(e){return function(t,n){(function(e){if(!s.isBuffer(e)&&"string"!=typeof e&&(!l||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export))throw v(c)})(n),t=g(t);var r=i.createHmac("sha"+e,n);return d((r.update(t),r.digest("base64")))}}function y(e){return function(t,n,i){var a=m(e)(t,i);return r(s.from(n),s.from(a))}}function b(e){return function(t,n){p(n),t=g(t);var r=i.createSign("RSA-SHA"+e);return d((r.update(t),r.sign(n,"base64")))}}function w(e){return function(t,n,r){h(r),t=g(t),n=f(n);var s=i.createVerify("RSA-SHA"+e);return s.update(t),s.verify(r,n,"base64")}}function _(e){return function(t,n){p(n),t=g(t);var r=i.createSign("RSA-SHA"+e);return d((r.update(t),r.sign({key:n,padding:i.constants.RSA_PKCS1_PSS_PADDING,saltLength:i.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function x(e){return function(t,n,r){h(r),t=g(t),n=f(n);var s=i.createVerify("RSA-SHA"+e);return s.update(t),s.verify({key:r,padding:i.constants.RSA_PKCS1_PSS_PADDING,saltLength:i.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function k(e){var t=b(e);return function(){var n=t.apply(null,arguments);return a.derToJose(n,"ES"+e)}}function S(e){var t=w(e);return function(n,r,s){return t(n,r=a.joseToDer(r,"ES"+e).toString("base64"),s)}}function E(){return function(){return""}}function C(){return function(e,t){return""===t}}l&&(u+=" or a KeyObject",c+="or a KeyObject"),e.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!t)throw v('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var n=(t[1]||t[3]).toLowerCase(),r=t[2];return{sign:({hs:m,rs:b,ps:_,es:k,none:E})[n](r),verify:({hs:y,rs:w,ps:x,es:S,none:C})[n](r)}}},26455:(e,t,n)=>{var r=n(42881),s=n(5895);t.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],t.sign=r.sign,t.verify=s.verify,t.decode=s.decode,t.isValid=s.isValid,t.createSign=function(e){return new r(e)},t.createVerify=function(e){return new s(e)}},97308:(e,t,n)=>{"use strict";var r=n(41684).Buffer,s=n(12781);function i(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=r.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=r.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}n(73837).inherits(i,s),i.prototype.write=function(e){this.buffer=r.concat([this.buffer,r.from(e)]),this.emit("data",e)},i.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},e.exports=i},42881:(e,t,n)=>{"use strict";var r=n(41684).Buffer,s=n(97308),i=n(17527),a=n(12781),o=n(69521),c=n(73837);function u(e,t){return r.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function l(e){var t,n,r,s=e.header,a=e.payload,l=e.secret||e.privateKey,h=e.encoding,p=i(s.alg),d=(t=(t=h)||"utf8",n=u(o(s),"binary"),r=u(o(a),t),c.format("%s.%s",n,r)),f=p.sign(d,l);return c.format("%s.%s",d,f)}function h(e){var t=new s(e.secret||e.privateKey||e.key);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new s(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}c.inherits(h,a),h.prototype.sign=function(){try{var e=l({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},h.sign=l,e.exports=h},69521:(e,t,n)=>{"use strict";var r=n(14300).Buffer;e.exports=function(e){return"string"==typeof e?e:"number"==typeof e||r.isBuffer(e)?e.toString():JSON.stringify(e)}},5895:(e,t,n)=>{"use strict";var r=n(41684).Buffer,s=n(97308),i=n(17527),a=n(12781),o=n(69521),c=n(73837),u=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function l(e){var t=e.split(".",1)[0];return function(e){if("[object Object]"===Object.prototype.toString.call(e))return e;try{return JSON.parse(e)}catch(e){return}}(r.from(t,"base64").toString("binary"))}function h(e){return e.split(".")[2]}function p(e){return u.test(e)&&!!l(e)}function d(e,t,n){if(!t){var r=Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}var s=h(e=o(e)),a=e.split(".",2).join(".");return i(t).verify(a,s,n)}function f(e,t){if(t=t||{},!p(e=o(e)))return null;var n,s,i=l(e);if(!i)return null;var a=(n=n||"utf8",s=e.split(".")[1],r.from(s,"base64").toString(n));return("JWT"===i.typ||t.json)&&(a=JSON.parse(a,t.encoding)),{header:i,payload:a,signature:h(e)}}function v(e){var t=new s((e=e||{}).secret||e.publicKey||e.key);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new s(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}c.inherits(v,a),v.prototype.verify=function(){try{var e=d(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},v.decode=f,v.isValid=p,v.verify=d,e.exports=v},77919:e=>{"use strict";var t,n,r=1/0,s=0/0,i=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=/^(?:0|[1-9]\d*)$/,l=parseInt;function h(e){return e!=e}var p=Object.prototype,d=p.hasOwnProperty,f=p.toString,v=p.propertyIsEnumerable,g=(t=Object.keys,n=Object,function(e){return t(n(e))}),m=Math.max,y=Array.isArray;function b(e){var t,n;return null!=e&&"number"==typeof(t=e.length)&&t>-1&&t%1==0&&t<=9007199254740991&&!("[object Function]"==(n=w(e)?f.call(e):"")||"[object GeneratorFunction]"==n)}function w(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function _(e){return!!e&&"object"==typeof e}e.exports=function(e,t,n,x){e=b(e)?e:(k=e)?function(e,t){for(var n=-1,r=e?e.length:0,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}(b(k)?function(e,t){var n,r=y(e)||_(e)&&b(e)&&d.call(e,"callee")&&(!v.call(e,"callee")||"[object Arguments]"==f.call(e))?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],s=r.length,i=!!s;for(var a in e)d.call(e,a)&&!(i&&("length"==a||(n=null==(n=s)?9007199254740991:n)&&("number"==typeof a||u.test(a))&&a>-1&&a%1==0&&a<n))&&r.push(a);return r}(k):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||p))return g(e);var t,n=[];for(var r in Object(e))d.call(e,r)&&"constructor"!=r&&n.push(r);return n}(k),function(e){return k[e]}):[],n=n&&!x?(C=(E=(S=n)?(S=function(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||_(t)&&"[object Symbol]"==f.call(t))return s;if(w(e)){var t,n="function"==typeof e.valueOf?e.valueOf():e;e=w(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var r=o.test(e);return r||c.test(e)?l(e.slice(2),r?2:8):a.test(e)?s:+e}(S))===r||S===-r?(S<0?-1:1)*17976931348623157e292:S==S?S:0:0===S?S:0)%1,E==E?C?E-C:E:0):0;var k,S,E,C,R,O=e.length;return n<0&&(n=m(O+n,0)),"string"==typeof(R=e)||!y(R)&&_(R)&&"[object String]"==f.call(R)?n<=O&&e.indexOf(t,n)>-1:!!O&&function(e,t,n){if(t!=t)return function(e,t,n,r){for(var s=e.length,i=n+(r?1:-1);r?i--:++i<s;)if(t(e[i],i,e))return i;return -1}(e,h,n);for(var r=n-1,s=e.length;++r<s;)if(e[r]===t)return r;return -1}(e,t,n)>-1}},52909:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){return!0===e||!1===e||!!e&&"object"==typeof e&&"[object Boolean]"==t.call(e)}},84474:e=>{"use strict";var t=1/0,n=0/0,r=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,c=Object.prototype.toString;function u(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){var l,h,p;return"number"==typeof e&&e==(p=(h=(l=e)?(l=function(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==c.call(t))return n;if(u(e)){var t,l="function"==typeof e.valueOf?e.valueOf():e;e=u(l)?l+"":l}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var h=i.test(e);return h||a.test(e)?o(e.slice(2),h?2:8):s.test(e)?n:+e}(l))===t||l===-t?(l<0?-1:1)*17976931348623157e292:l==l?l:0:0===l?l:0)%1,h==h?p?h-p:h:0)}},13881:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){return"number"==typeof e||!!e&&"object"==typeof e&&"[object Number]"==t.call(e)}},65840:e=>{"use strict";var t,n,r=Object.prototype,s=Function.prototype.toString,i=r.hasOwnProperty,a=s.call(Object),o=r.toString,c=(t=Object.getPrototypeOf,n=Object,function(e){return t(n(e))});e.exports=function(e){if(!(e&&"object"==typeof e)||"[object Object]"!=o.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=c(e);if(null===t)return!0;var n=i.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&s.call(n)==a}},20479:e=>{"use strict";var t=Object.prototype.toString,n=Array.isArray;e.exports=function(e){var r;return"string"==typeof e||!n(e)&&!!(r=e)&&"object"==typeof r&&"[object String]"==t.call(e)}},84639:e=>{"use strict";var t=1/0,n=0/0,r=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,c=Object.prototype.toString;function u(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return function(e,l){var h,p,d,f;if("function"!=typeof l)throw TypeError("Expected a function");return f=(d=(p=e)?(p=function(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==c.call(t))return n;if(u(e)){var t,l="function"==typeof e.valueOf?e.valueOf():e;e=u(l)?l+"":l}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var h=i.test(e);return h||a.test(e)?o(e.slice(2),h?2:8):s.test(e)?n:+e}(p))===t||p===-t?(p<0?-1:1)*17976931348623157e292:p==p?p:0:0===p?p:0)%1,e=d==d?f?d-f:d:0,function(){return--e>0&&(h=l.apply(this,arguments)),e<=1&&(l=void 0),h}}(2,e)}},41684:(e,t,n)=>{"use strict";/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var r=n(14300),s=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return s(e,t,n)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=a),a.prototype=Object.create(s.prototype),i(s,a),a.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return s(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var r=s(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return s(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r.SlowBuffer(e)}},52539:(e,t,n)=>{"use strict";let r=Symbol("SemVer ANY");class s{static get ANY(){return r}constructor(e,t){if(t=i(t),e instanceof s){if(!!t.loose===e.loose)return e;e=e.value}u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?a[o.COMPARATORLOOSE]:a[o.COMPARATOR],n=e.match(t);if(!n)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new l(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new l(e,this.options)}catch(e){return!1}return c(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof s))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new Range(e.value,t).test(this.value):""===e.operator?""===e.value||new Range(this.value,t).test(e.semver):!((t=i(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||c(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||c(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=s;let i=n(25855),{safeRe:a,t:o}=n(35993),c=n(47510),u=n(50523),l=n(54790),Range=n(99025)},99025:(e,t,n)=>{"use strict";let r=/\s+/g;class Range{constructor(e,t){if(t=a(t),e instanceof Range){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new Range(e.raw,t)}if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(r," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!m(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=(this.options.includePrerelease&&v)|(this.options.loose&&g),n=t+":"+e,r=i.get(n);if(r)return r;let s=this.options.loose,a=s?l[h.HYPHENRANGELOOSE]:l[h.HYPHENRANGE];c("hyphen replace",e=e.replace(a,U(this.options.includePrerelease))),c("comparator trim",e=e.replace(l[h.COMPARATORTRIM],p)),c("tilde trim",e=e.replace(l[h.TILDETRIM],d)),c("caret trim",e=e.replace(l[h.CARETTRIM],f));let u=e.split(" ").map(e=>w(e,this.options)).join(" ").split(/\s+/).map(e=>I(e,this.options));s&&(u=u.filter(e=>(c("loose invalid filter",e,this.options),!!e.match(l[h.COMPARATORLOOSE])))),c("range list",u);let y=new Map,b=u.map(e=>new o(e,this.options));for(let e of b){if(m(e))return[e];y.set(e.value,e)}y.size>1&&y.has("")&&y.delete("");let _=[...y.values()];return i.set(n,_),_}intersects(e,t){if(!(e instanceof Range))throw TypeError("a Range is required");return this.set.some(n=>b(n,t)&&e.set.some(e=>b(e,t)&&n.every(n=>e.every(e=>n.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(L(this.set[t],e,this.options))return!0;return!1}}e.exports=Range;let s=n(77261),i=new s,a=n(25855),o=n(52539),c=n(50523),u=n(54790),{safeRe:l,t:h,comparatorTrimReplace:p,tildeTrimReplace:d,caretTrimReplace:f}=n(35993),{FLAG_INCLUDE_PRERELEASE:v,FLAG_LOOSE:g}=n(28367),m=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,b=(e,t)=>{let n=!0,r=e.slice(),s=r.pop();for(;n&&r.length;)n=r.every(e=>s.intersects(e,t)),s=r.pop();return n},w=(e,t)=>(c("comp",e,t),c("caret",e=S(e,t)),c("tildes",e=x(e,t)),c("xrange",e=C(e,t)),c("stars",e=O(e,t)),e),_=e=>!e||"x"===e.toLowerCase()||"*"===e,x=(e,t)=>e.trim().split(/\s+/).map(e=>k(e,t)).join(" "),k=(e,t)=>{let n=t.loose?l[h.TILDELOOSE]:l[h.TILDE];return e.replace(n,(t,n,r,s,i)=>{let a;return c("tilde",e,t,n,r,s,i),_(n)?a="":_(r)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:_(s)?a=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:i?(c("replaceTilde pr",i),a=`>=${n}.${r}.${s}-${i} <${n}.${+r+1}.0-0`):a=`>=${n}.${r}.${s} <${n}.${+r+1}.0-0`,c("tilde return",a),a})},S=(e,t)=>e.trim().split(/\s+/).map(e=>E(e,t)).join(" "),E=(e,t)=>{c("caret",e,t);let n=t.loose?l[h.CARETLOOSE]:l[h.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(t,n,s,i,a)=>{let o;return c("caret",e,t,n,s,i,a),_(n)?o="":_(s)?o=`>=${n}.0.0${r} <${+n+1}.0.0-0`:_(i)?o="0"===n?`>=${n}.${s}.0${r} <${n}.${+s+1}.0-0`:`>=${n}.${s}.0${r} <${+n+1}.0.0-0`:a?(c("replaceCaret pr",a),o="0"===n?"0"===s?`>=${n}.${s}.${i}-${a} <${n}.${s}.${+i+1}-0`:`>=${n}.${s}.${i}-${a} <${n}.${+s+1}.0-0`:`>=${n}.${s}.${i}-${a} <${+n+1}.0.0-0`):(c("no pr"),o="0"===n?"0"===s?`>=${n}.${s}.${i}${r} <${n}.${s}.${+i+1}-0`:`>=${n}.${s}.${i}${r} <${n}.${+s+1}.0-0`:`>=${n}.${s}.${i} <${+n+1}.0.0-0`),c("caret return",o),o})},C=(e,t)=>(c("replaceXRanges",e,t),e.split(/\s+/).map(e=>R(e,t)).join(" ")),R=(e,t)=>{e=e.trim();let n=t.loose?l[h.XRANGELOOSE]:l[h.XRANGE];return e.replace(n,(n,r,s,i,a,o)=>{c("xRange",e,n,r,s,i,a,o);let u=_(s),l=u||_(i),h=l||_(a);return"="===r&&h&&(r=""),o=t.includePrerelease?"-0":"",u?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&h?(l&&(i=0),a=0,">"===r?(r=">=",l?(s=+s+1,i=0):i=+i+1,a=0):"<="===r&&(r="<",l?s=+s+1:i=+i+1),"<"===r&&(o="-0"),n=`${r+s}.${i}.${a}${o}`):l?n=`>=${s}.0.0${o} <${+s+1}.0.0-0`:h&&(n=`>=${s}.${i}.0${o} <${s}.${+i+1}.0-0`),c("xRange return",n),n})},O=(e,t)=>(c("replaceStars",e,t),e.trim().replace(l[h.STAR],"")),I=(e,t)=>(c("replaceGTE0",e,t),e.trim().replace(l[t.includePrerelease?h.GTE0PRE:h.GTE0],"")),U=e=>(t,n,r,s,i,a,o,c,u,l,h,p)=>(n=_(r)?"":_(s)?`>=${r}.0.0${e?"-0":""}`:_(i)?`>=${r}.${s}.0${e?"-0":""}`:a?`>=${n}`:`>=${n}${e?"-0":""}`,c=_(u)?"":_(l)?`<${+u+1}.0.0-0`:_(h)?`<${u}.${+l+1}.0-0`:p?`<=${u}.${l}.${h}-${p}`:e?`<${u}.${l}.${+h+1}-0`:`<=${c}`,`${n} ${c}`.trim()),L=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(c(e[n].semver),e[n].semver!==o.ANY&&e[n].semver.prerelease.length>0){let r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},54790:(e,t,n)=>{"use strict";let r=n(50523),{MAX_LENGTH:s,MAX_SAFE_INTEGER:i}=n(28367),{safeRe:a,safeSrc:o,t:c}=n(35993),u=n(25855),{compareIdentifiers:l}=n(22200);class h{constructor(e,t){if(t=u(t),e instanceof h){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>s)throw TypeError(`version is longer than ${s} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?a[c.LOOSE]:a[c.FULL]);if(!n)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>i||this.major<0)throw TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<i)return t}return e}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof h)){if("string"==typeof e&&e===this.version)return 0;e=new h(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof h||(e=new h(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof h||(e=new h(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],s=e.prerelease[t];if(r("prerelease compare",t,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return -1;if(n===s)continue;else return l(n,s)}while(++t)}compareBuild(e){e instanceof h||(e=new h(e,this.options));let t=0;do{let n=this.build[t],s=e.build[t];if(r("build compare",t,n,s),void 0===n&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===n)return -1;if(n===s)continue;else return l(n,s)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw Error("invalid increment argument: identifier is empty");if(t){let e=RegExp(`^${this.options.loose?o[c.PRERELEASELOOSE]:o[c.PRERELEASE]}$`),n=`-${t}`.match(e);if(!n||n[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===l(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=h},19452:(e,t,n)=>{"use strict";let r=n(92033);e.exports=(e,t)=>{let n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},47510:(e,t,n)=>{"use strict";let r=n(32290),s=n(23330),i=n(69988),a=n(46085),o=n(81998),c=n(27440);e.exports=(e,t,n,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return r(e,n,u);case"!=":return s(e,n,u);case">":return i(e,n,u);case">=":return a(e,n,u);case"<":return o(e,n,u);case"<=":return c(e,n,u);default:throw TypeError(`Invalid operator: ${t}`)}}},12535:(e,t,n)=>{"use strict";let r=n(54790),s=n(92033),{safeRe:i,t:a}=n(35993);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let r;let s=t.includePrerelease?i[a.COERCERTLFULL]:i[a.COERCERTL];for(;(r=s.exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&r.index+r[0].length===n.index+n[0].length||(n=r),s.lastIndex=r.index+r[1].length+r[2].length;s.lastIndex=-1}else n=e.match(t.includePrerelease?i[a.COERCEFULL]:i[a.COERCE]);if(null===n)return null;let o=n[2],c=n[3]||"0",u=n[4]||"0",l=t.includePrerelease&&n[5]?`-${n[5]}`:"",h=t.includePrerelease&&n[6]?`+${n[6]}`:"";return s(`${o}.${c}.${u}${l}${h}`,t)}},37662:(e,t,n)=>{"use strict";let r=n(54790);e.exports=(e,t,n)=>{let s=new r(e,n),i=new r(t,n);return s.compare(i)||s.compareBuild(i)}},58745:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t)=>r(e,t,!0)},51089:(e,t,n)=>{"use strict";let r=n(54790);e.exports=(e,t,n)=>new r(e,n).compare(new r(t,n))},31662:(e,t,n)=>{"use strict";let r=n(92033);e.exports=(e,t)=>{let n=r(e,null,!0),s=r(t,null,!0),i=n.compare(s);if(0===i)return null;let a=i>0,o=a?n:s,c=a?s:n,u=!!o.prerelease.length,l=!!c.prerelease.length;if(l&&!u){if(!c.patch&&!c.minor)return"major";if(0===c.compareMain(o))return c.minor&&!c.patch?"minor":"patch"}let h=u?"pre":"";return n.major!==s.major?h+"major":n.minor!==s.minor?h+"minor":n.patch!==s.patch?h+"patch":"prerelease"}},32290:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t,n)=>0===r(e,t,n)},69988:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t,n)=>r(e,t,n)>0},46085:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t,n)=>r(e,t,n)>=0},87681:(e,t,n)=>{"use strict";let r=n(54790);e.exports=(e,t,n,s,i)=>{"string"==typeof n&&(i=s,s=n,n=void 0);try{return new r(e instanceof r?e.version:e,n).inc(t,s,i).version}catch(e){return null}}},81998:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t,n)=>0>r(e,t,n)},27440:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t,n)=>0>=r(e,t,n)},47473:(e,t,n)=>{"use strict";let r=n(54790);e.exports=(e,t)=>new r(e,t).major},67035:(e,t,n)=>{"use strict";let r=n(54790);e.exports=(e,t)=>new r(e,t).minor},23330:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t,n)=>0!==r(e,t,n)},92033:(e,t,n)=>{"use strict";let r=n(54790);e.exports=(e,t,n=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(e){if(!n)return null;throw e}}},18429:(e,t,n)=>{"use strict";let r=n(54790);e.exports=(e,t)=>new r(e,t).patch},19058:(e,t,n)=>{"use strict";let r=n(92033);e.exports=(e,t)=>{let n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},15887:(e,t,n)=>{"use strict";let r=n(51089);e.exports=(e,t,n)=>r(t,e,n)},93181:(e,t,n)=>{"use strict";let r=n(37662);e.exports=(e,t)=>e.sort((e,n)=>r(n,e,t))},83507:(e,t,n)=>{"use strict";let Range=n(99025);e.exports=(e,t,n)=>{try{t=new Range(t,n)}catch(e){return!1}return t.test(e)}},28542:(e,t,n)=>{"use strict";let r=n(37662);e.exports=(e,t)=>e.sort((e,n)=>r(e,n,t))},80774:(e,t,n)=>{"use strict";let r=n(92033);e.exports=(e,t)=>{let n=r(e,t);return n?n.version:null}},60309:(e,t,n)=>{"use strict";let r=n(35993),s=n(28367),i=n(54790),a=n(22200),o=n(92033),c=n(80774),u=n(19452),l=n(87681),h=n(31662),p=n(47473),d=n(67035),f=n(18429),v=n(19058),g=n(51089),m=n(15887),y=n(58745),b=n(37662),w=n(28542),_=n(93181),x=n(69988),k=n(81998),S=n(32290),E=n(23330),C=n(46085),R=n(27440),O=n(47510),I=n(12535),U=n(52539),Range=n(99025),L=n(83507),P=n(2e4),A=n(80586),T=n(14499),j=n(81343),M=n(1197),D=n(42408),N=n(56711),$=n(63390),F=n(13749),q=n(39787),H=n(22433);e.exports={parse:o,valid:c,clean:u,inc:l,diff:h,major:p,minor:d,patch:f,prerelease:v,compare:g,rcompare:m,compareLoose:y,compareBuild:b,sort:w,rsort:_,gt:x,lt:k,eq:S,neq:E,gte:C,lte:R,cmp:O,coerce:I,Comparator:U,Range,satisfies:L,toComparators:P,maxSatisfying:A,minSatisfying:T,minVersion:j,validRange:M,outside:D,gtr:N,ltr:$,intersects:F,simplifyRange:q,subset:H,SemVer:i,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:s.SEMVER_SPEC_VERSION,RELEASE_TYPES:s.RELEASE_TYPES,compareIdentifiers:a.compareIdentifiers,rcompareIdentifiers:a.rcompareIdentifiers}},28367:e=>{"use strict";let t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},50523:e=>{"use strict";let t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},22200:e=>{"use strict";let t=/^[0-9]+$/,n=(e,n)=>{let r=t.test(e),s=t.test(n);return r&&s&&(e=+e,n=+n),e===n?0:r&&!s?-1:s&&!r?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},77261:e=>{"use strict";class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){let n=this.delete(e);if(!n&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},25855:e=>{"use strict";let t=Object.freeze({loose:!0}),n=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:n},35993:(e,t,n)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=n(28367),a=n(50523);t=e.exports={};let o=t.re=[],c=t.safeRe=[],u=t.src=[],l=t.safeSrc=[],h=t.t={},p=0,d="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",i],[d,s]],v=e=>{for(let[t,n]of f)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e},g=(e,t,n)=>{let r=v(t),s=p++;a(e,s,t),h[e]=s,u[s]=t,l[s]=r,o[s]=new RegExp(t,n?"g":void 0),c[s]=new RegExp(r,n?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),g("MAINVERSION",`(${u[h.NUMERICIDENTIFIER]})\\.(${u[h.NUMERICIDENTIFIER]})\\.(${u[h.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${u[h.NUMERICIDENTIFIERLOOSE]})\\.(${u[h.NUMERICIDENTIFIERLOOSE]})\\.(${u[h.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${u[h.NUMERICIDENTIFIER]}|${u[h.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${u[h.NUMERICIDENTIFIERLOOSE]}|${u[h.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${u[h.PRERELEASEIDENTIFIER]}(?:\\.${u[h.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${u[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[h.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${d}+`),g("BUILD",`(?:\\+(${u[h.BUILDIDENTIFIER]}(?:\\.${u[h.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${u[h.MAINVERSION]}${u[h.PRERELEASE]}?${u[h.BUILD]}?`),g("FULL",`^${u[h.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${u[h.MAINVERSIONLOOSE]}${u[h.PRERELEASELOOSE]}?${u[h.BUILD]}?`),g("LOOSE",`^${u[h.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${u[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${u[h.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${u[h.XRANGEIDENTIFIER]})(?:\\.(${u[h.XRANGEIDENTIFIER]})(?:\\.(${u[h.XRANGEIDENTIFIER]})(?:${u[h.PRERELEASE]})?${u[h.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${u[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[h.XRANGEIDENTIFIERLOOSE]})(?:${u[h.PRERELEASELOOSE]})?${u[h.BUILD]}?)?)?`),g("XRANGE",`^${u[h.GTLT]}\\s*${u[h.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${u[h.GTLT]}\\s*${u[h.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),g("COERCE",`${u[h.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",u[h.COERCEPLAIN]+`(?:${u[h.PRERELEASE]})?`+`(?:${u[h.BUILD]})?`+"(?:$|[^\\d])"),g("COERCERTL",u[h.COERCE],!0),g("COERCERTLFULL",u[h.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${u[h.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${u[h.LONETILDE]}${u[h.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${u[h.LONETILDE]}${u[h.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${u[h.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${u[h.LONECARET]}${u[h.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${u[h.LONECARET]}${u[h.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${u[h.GTLT]}\\s*(${u[h.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${u[h.GTLT]}\\s*(${u[h.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${u[h.GTLT]}\\s*(${u[h.LOOSEPLAIN]}|${u[h.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${u[h.XRANGEPLAIN]})\\s+-\\s+(${u[h.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${u[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[h.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},56711:(e,t,n)=>{"use strict";let r=n(42408);e.exports=(e,t,n)=>r(e,t,">",n)},13749:(e,t,n)=>{"use strict";let Range=n(99025);e.exports=(e,t,n)=>(e=new Range(e,n),t=new Range(t,n),e.intersects(t,n))},63390:(e,t,n)=>{"use strict";let r=n(42408);e.exports=(e,t,n)=>r(e,t,"<",n)},80586:(e,t,n)=>{"use strict";let r=n(54790),Range=n(99025);e.exports=(e,t,n)=>{let s=null,i=null,a=null;try{a=new Range(t,n)}catch(e){return null}return e.forEach(e=>{a.test(e)&&(!s||-1===i.compare(e))&&(i=new r(s=e,n))}),s}},14499:(e,t,n)=>{"use strict";let r=n(54790),Range=n(99025);e.exports=(e,t,n)=>{let s=null,i=null,a=null;try{a=new Range(t,n)}catch(e){return null}return e.forEach(e=>{a.test(e)&&(!s||1===i.compare(e))&&(i=new r(s=e,n))}),s}},81343:(e,t,n)=>{"use strict";let r=n(54790),Range=n(99025),s=n(69988);e.exports=(e,t)=>{e=new Range(e,t);let n=new r("0.0.0");if(e.test(n)||(n=new r("0.0.0-0"),e.test(n)))return n;n=null;for(let t=0;t<e.set.length;++t){let i=e.set[t],a=null;i.forEach(e=>{let t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!a||s(t,a))&&(a=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),a&&(!n||s(n,a))&&(n=a)}return n&&e.test(n)?n:null}},42408:(e,t,n)=>{"use strict";let r=n(54790),s=n(52539),{ANY:i}=s,Range=n(99025),a=n(83507),o=n(69988),c=n(81998),u=n(27440),l=n(46085);e.exports=(e,t,n,h)=>{let p,d,f,v,g;switch(e=new r(e,h),t=new Range(t,h),n){case">":p=o,d=u,f=c,v=">",g=">=";break;case"<":p=c,d=l,f=o,v="<",g="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(a(e,t,h))return!1;for(let n=0;n<t.set.length;++n){let r=t.set[n],a=null,o=null;if(r.forEach(e=>{e.semver===i&&(e=new s(">=0.0.0")),a=a||e,o=o||e,p(e.semver,a.semver,h)?a=e:f(e.semver,o.semver,h)&&(o=e)}),a.operator===v||a.operator===g||(!o.operator||o.operator===v)&&d(e,o.semver)||o.operator===g&&f(e,o.semver))return!1}return!0}},39787:(e,t,n)=>{"use strict";let r=n(83507),s=n(51089);e.exports=(e,t,n)=>{let i=[],a=null,o=null,c=e.sort((e,t)=>s(e,t,n));for(let e of c){let s=r(e,t,n);s?(o=e,a||(a=e)):(o&&i.push([a,o]),o=null,a=null)}a&&i.push([a,null]);let u=[];for(let[e,t]of i)e===t?u.push(e):t||e!==c[0]?t?e===c[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let l=u.join(" || "),h="string"==typeof t.raw?t.raw:String(t);return l.length<h.length?l:t}},22433:(e,t,n)=>{"use strict";let Range=n(99025),r=n(52539),{ANY:s}=r,i=n(83507),a=n(51089),o=[new r(">=0.0.0-0")],c=[new r(">=0.0.0")],u=(e,t,n)=>{let r,u,p,d,f,v,g;if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=n.includePrerelease?o:c}if(1===t.length&&t[0].semver===s){if(n.includePrerelease)return!0;t=c}let m=new Set;for(let t of e)">"===t.operator||">="===t.operator?r=l(r,t,n):"<"===t.operator||"<="===t.operator?u=h(u,t,n):m.add(t.semver);if(m.size>1||r&&u&&((p=a(r.semver,u.semver,n))>0||0===p&&(">="!==r.operator||"<="!==u.operator)))return null;for(let e of m){if(r&&!i(e,String(r),n)||u&&!i(e,String(u),n))return null;for(let r of t)if(!i(e,String(r),n))return!1;return!0}let y=!!u&&!n.includePrerelease&&!!u.semver.prerelease.length&&u.semver,b=!!r&&!n.includePrerelease&&!!r.semver.prerelease.length&&r.semver;for(let e of(y&&1===y.prerelease.length&&"<"===u.operator&&0===y.prerelease[0]&&(y=!1),t)){if(g=g||">"===e.operator||">="===e.operator,v=v||"<"===e.operator||"<="===e.operator,r){if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if((d=l(r,e,n))===e&&d!==r)return!1}else if(">="===r.operator&&!i(r.semver,String(e),n))return!1}if(u){if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if((f=h(u,e,n))===e&&f!==u)return!1}else if("<="===u.operator&&!i(u.semver,String(e),n))return!1}if(!e.operator&&(u||r)&&0!==p)return!1}return(!r||!v||!!u||0===p)&&(!u||!g||!!r||0===p)&&!b&&!y},l=(e,t,n)=>{if(!e)return t;let r=a(e.semver,t.semver,n);return r>0?e:r<0?t:">"===t.operator&&">="===e.operator?t:e},h=(e,t,n)=>{if(!e)return t;let r=a(e.semver,t.semver,n);return r<0?e:r>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n={})=>{if(e===t)return!0;e=new Range(e,n),t=new Range(t,n);let r=!1;e:for(let s of e.set){for(let e of t.set){let t=u(s,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0}},2e4:(e,t,n)=>{"use strict";let Range=n(99025);e.exports=(e,t)=>new Range(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},1197:(e,t,n)=>{"use strict";let Range=n(99025);e.exports=(e,t)=>{try{return new Range(e,t).range||"*"}catch(e){return null}}},96094:(e,t,n)=>{"use strict";n.d(t,{c8:()=>tH,t1:()=>ee});var r,s,i=n(93197),a=n(24233),o=n.n(a),c=n(59585),u=n.n(c),l=n(17434),h=n.n(l),p=n(27538),d=n.n(p),f=n(94213),v=n.n(f),g=n(71450),m=n.n(g),y=n(5233),b=n.n(y),w=n(61090),_=n.n(w),x=n(29963),k=n.n(x),S=n(78708),E=n.n(S),C=n(77294),R=n(95687),O=n.n(R),I=n(4080),U=n.n(I),L=n(32912),P=n.n(L),A=n(40183),T=n.n(A),j=n(6113),M=n.n(j),D=n(35536),N=n.n(D),$=n(30899),F=n.n($),q=n(1429),H=n.n(q),V=n(80733),B=n.n(V),W=n(48963),G=n.n(W);function z(e){return"string"==typeof e}var K=function(e){var t,n,r,s={},i=String.fromCharCode,a=e.length,o=0,c=0,u="";for(t=0;t<64;t++)s["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;n<a;n++)for(o=(o<<6)+s[e.charAt(n)],c+=6;c>=8;)((r=o>>>(c-=8)&255)||n<a-2)&&(u+=i(r));return u},X=function(){var e,t,n,r,s,i;function a(e,t,n){u()(this,a),d()(this,"id",void 0),d()(this,"data",void 0),d()(this,"client",void 0),this.client=e,this.id=t,this.data=n}return h()(a,[{key:"create",value:(e=o()(v().mark(function e(){var t,n,r,s,i,a,o,c,u,l,h,p,d,f;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d={id:this.id,message_template:null===(t=this.data)||void 0===t?void 0:t.message_template,segment_ids:null===(n=this.data)||void 0===n?void 0:n.segment_ids,sender_id:null===(r=this.data)||void 0===r?void 0:r.sender_id,sender_mode:null===(s=this.data)||void 0===s?void 0:s.sender_mode,channel_template:null===(i=this.data)||void 0===i?void 0:i.channel_template,create_channels:null===(a=this.data)||void 0===a?void 0:a.create_channels,show_channels:null===(o=this.data)||void 0===o?void 0:o.show_channels,description:null===(c=this.data)||void 0===c?void 0:c.description,name:null===(u=this.data)||void 0===u?void 0:u.name,skip_push:null===(l=this.data)||void 0===l?void 0:l.skip_push,skip_webhook:null===(h=this.data)||void 0===h?void 0:h.skip_webhook,user_ids:null===(p=this.data)||void 0===p?void 0:p.user_ids},e.next=3,this.client.createCampaign(d);case 3:return f=e.sent,this.id=f.campaign.id,this.data=f.campaign,e.abrupt("return",f);case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"verifyCampaignId",value:function(){if(!this.id)throw Error("Campaign id is missing. Either create the campaign using campaign.create() or set the id during instantiation - const campaign = client.campaign(id)")}},{key:"start",value:(t=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.startCampaign(this.id,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"update",value:(n=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.updateCampaign(this.id,t));case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"delete",value:(r=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.deleteCampaign(this.id);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"stop",value:(s=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.stopCampaign(this.id));case 2:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"get",value:(i=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.getCampaign(this.id,t));case 2:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})}]),a}();function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Q(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){throw e}),f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){o=!0,i=e}),f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t){e.then().catch(function(e){console.warn("failed to do ".concat(t,", ran into error: "),e)})}var et=function(e){return new Promise(function(t){return setTimeout(t,e)})};function en(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}var er={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function es(e){var t,n=[],r=Q(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var s=t.value,i=Object.entries(s);i.length>1&&console.warn("client._buildSort() - multiple fields in a single sort object detected. Object's field order is not guaranteed");for(var a=0;a<i.length;a++){var o=m()(i[a],2),c=o[0],u=o[1];n.push({field:c,direction:u})}}}catch(e){r.e(e)}finally{r.f()}return n}function ei(e){var t=Math.min(Math.max(250,(e-1)*2e3),25e3);return Math.floor(Math.random()*(Math.min(500+2e3*e,25e3)-t)+t)}function ea(e){for(var t="",n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t}function eo(){var e,t=(eu(e=new Uint8Array(16)),e);return t[6]=15&t[6]|64,t[8]=191&t[8]|128,ea(t.subarray(0,4))+"-"+ea(t.subarray(4,6))+"-"+ea(t.subarray(6,8))+"-"+ea(t.subarray(8,10))+"-"+ea(t.subarray(10,16))}function ec(e){for(var t=Math.pow(2,8*e.byteLength/e.length),n=0;n<e.length;n++)e[n]=Math.random()*t}var eu=function(){var e;return"undefined"!=typeof crypto&&void 0!==(null===(e=crypto)||void 0===e?void 0:e.getRandomValues)?crypto.getRandomValues.bind(crypto):"undefined"!=typeof msCrypto?msCrypto.getRandomValues.bind(msCrypto):ec}(),el=function(e){var t=[];for(var n in e)void 0!==e[n]&&(Array.isArray(e[n])||"object"===_()(e[n])?t.push("".concat(n,"=").concat(encodeURIComponent(JSON.stringify(e[n])))):t.push("".concat(n,"=").concat(encodeURIComponent(e[n]))));return t.join("&")};function eh(e){return Y(Y({},e),{},{__html:e.html,pinned_at:e.pinned_at?new Date(e.pinned_at):null,created_at:e.created_at?new Date(e.created_at):new Date,updated_at:e.updated_at?new Date(e.updated_at):new Date,deleted_at:e.deleted_at?new Date(e.deleted_at):null,status:e.status||"received",reaction_groups:function(e,t,n){if(e)return e;if(t&&n){for(var r={},s=0,i=Object.keys(t);s<i.length;s++){var a=i[s];r[a]={count:t[a],sum_scores:n[a]}}return r}return null}(e.reaction_groups,e.reaction_counts,e.reaction_scores)})}var ep=function(e){var t=e.needle,n=e.sortedArray,r=e.selectKey,s=e.selectValueToCompare,i=void 0===s?function(e){return e}:s,a=e.sortDirection,o=void 0===a?"ascending":a;if(!n.length)return 0;for(var c=0,u=n.length-1,l=0,h=i(t);c<=u;){var p=i(n[l=Math.round((c+u)/2)]);"ascending"===o&&h<p||"descending"===o&&h>=p?u=l-1:c=l+1}if(r){for(var d=r(t),f="ascending"===o?-1:1,v=c+f;0<=v&&v<n.length&&i(n[v])===h;v+=f)if(r(n[v])===d)return v}return c};function ed(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",s=!(arguments.length>4)||void 0===arguments[4]||arguments[4],i=s||n,a=E()(e);if(n&&(a=a.filter(function(e){return!(e.id&&t.id===e.id)})),0===a.length&&i)return a.concat(t);if(0===a.length)return a;var o=t[r].getTime(),c=a.at(-1)[r].getTime()<o;if(c&&i)return a.concat(t);if(c)return a;var u=ep({needle:t,sortedArray:a,sortDirection:"ascending",selectValueToCompare:function(e){return e[r].getTime()},selectKey:function(e){return e.id}});return!n&&t.id&&a[u]&&t.id===a[u].id?a[u]=t:i&&a.splice(u,0,t),a}var ef=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.leading,s=void 0===r||r,i=n.trailing,a=void 0!==i&&i,o=null,c=null;return function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];if(o){a&&(c=r);return}s&&e.apply(void 0,r),o=setTimeout(function n(){if(c){e.apply(void 0,E()(c)),c=null,o=setTimeout(n,t);return}o=null},t)}},ev=function(e,t){if(!Array.isArray(e))return[];var n=new Set;return e.filter(function(e){var r="function"==typeof t?t(e):t.split(".").reduce(function(e,t){if(e&&"object"===_()(e)&&t in e)return e[t]},e);return!n.has(r)&&(n.add(r),!0)})},eg=function(e){var t=e.parentSet,n=e.requestedPageSize,r=e.returnedPage,s=e.messagePaginationOptions,i=Y({},t.pagination);if(!(null!=s&&s.created_at_around))return i;var a=new Date(s.created_at_around),o=[r[0],r.slice(-1)[0]],c=o[0],u=o[1],l=!!(null!=c&&c.created_at)&&new Date(c.created_at)>a,h=!!(null!=u&&u.created_at)&&new Date(u.created_at)<a,p=n>t.messages.length&&n>r.length,d=(n>t.messages.length||t.messages.length>=r.length)&&n>r.length;if(l)f=!1,g=!0,p&&(v=!1,m=!0);else if(h)v=!1,m=!0,p&&(f=!1,g=!0);else if(d)v=f=!1,g=m=!0;else{var f,v,g,m,y,b,w=(null==c?void 0:c.id)&&c.id===(null===(y=t.messages[0])||void 0===y?void 0:y.id),_=(null==u?void 0:u.id)&&u.id===(null===(b=t.messages.slice(-1)[0])||void 0===b?void 0:b.id);g=w,m=_;var x=Math.floor(r.length/2),k=function(e,t){for(var n=0,r=e.length-1;n<=r;){var s=Math.floor((n+r)/2),i=e[s].created_at;if(!i){n+=1;continue}var a=new Date(i);if(a.getTime()===t.getTime())return s;a.getTime()<t.getTime()?n=s+1:r=s-1}return n}(r,a);-1!==k&&(f=x<=k,v=x>=k)}return g&&void 0!==f&&(i.hasPrev=f),m&&void 0!==v&&(i.hasNext=v),i},em=function(e){var t=e.parentSet,n=e.requestedPageSize,r=e.returnedPage,s=e.messagePaginationOptions,i=Y({},t.pagination),a=(s||{}).id_around;if(!a)return i;var o=[r[0],r.slice(-1)[0]],c=o[0],u=o[1],l=(null==c?void 0:c.id)===(null===(v=t.messages[0])||void 0===v?void 0:v.id),h=(null==u?void 0:u.id)===(null===(g=t.messages.slice(-1)[0])||void 0===g?void 0:g.id),p=l,d=h,f=Math.floor(r.length/2);if((n>t.messages.length||t.messages.length>=r.length)&&n>r.length)y=m=!1,p=d=!0;else if(!r[f])return i;else if(r[f].id===a)m=y=!0;else{var v,g,m,y,b,w=[r.slice(0,f),r.slice(f)];m=y=!0;for(var _=0;_<w.length;_++)(b=w[_].find(function(e){return e.id===a}))&&0===_&&(m=!1),b&&1===_&&(y=!1)}return p&&void 0!==m&&(i.hasPrev=m),d&&void 0!==y&&(i.hasNext=y),i},ey=function(e){var t,n,r,s,i=e.parentSet,a=e.requestedPageSize,o=e.returnedPage,c=e.messagePaginationOptions,u=Y({},i.pagination),l=[o[0],o.slice(-1)[0]],h=l[0],p=l[1],d=(null==h?void 0:h.id)&&h.id===(null===(t=i.messages[0])||void 0===t?void 0:t.id),f=(null==p?void 0:p.id)&&p.id===(null===(n=i.messages.slice(-1)[0])||void 0===n?void 0:n.id),v=c&&(c.created_at_after_or_equal||c.created_at_after||c.id_gt||c.id_gte),g=void 0===c||c.created_at_before_or_equal||c.created_at_before||c.id_lt||c.id_lte||c.offset,m=!v&&!g&&!(null!=c&&c.id_around)&&!(null!=c&&c.created_at_around),y=o.length>=a;(void 0!==g||m)&&(r=y),void 0!==v&&(s=y);var b=0===o.length;return(d||b)&&void 0!==r&&(u.hasPrev=r),(f||b)&&void 0!==s&&(u.hasNext=s),u},eb=function(e){var t,n,r;return e.parentSet.messages.length<e.returnedPage.length?(null===(r=e.logger)||void 0===r||r.call(e,"error","Corrupted message set state: parent set size < returned page size"),e.parentSet.pagination):null!==(t=e.messagePaginationOptions)&&void 0!==t&&t.created_at_around?eg(e):null!==(n=e.messagePaginationOptions)&&void 0!==n&&n.id_around?em(e):ey(e)},ew={},e_=function(){var e=o()(v().mark(function e(t){var n,r,s,i,a,o,c,u,l;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.channel,r=t.client,s=t.id,i=t.members,a=t.options,o=t.type,!(!n&&!o)){e.next=3;break}throw Error("Channel or channel type have to be provided to query a channel.");case 3:if(u=(c=n||r.channel(o,s,{members:i})).id?c.cid:i&&i.length?ex(c.type,i):void 0){e.next=7;break}throw Error("Channel ID or channel members array have to be provided to query a channel.");case 7:if(!(l=ew[u])){e.next=13;break}return e.next=11,l;case 11:e.next=20;break;case 13:return e.prev=13,ew[u]=c.watch(a),e.next=17,ew[u];case 17:return e.prev=17,delete ew[u],e.finish(17);case 20:return e.abrupt("return",c);case 21:case"end":return e.stop()}},e,null,[[13,,17,20]])}));return function(t){return e.apply(this,arguments)}}(),ex=function(e,t){if(t){var n=E()(t).sort().join(",");if(n)return"".concat(e,":!members-").concat(n)}},ek=function(e){if(!e)return!1;var t=e.state.membership;return!!(null!=t&&t.pinned_at)},eS=function(e){if(!e)return!1;var t=e.state.membership;return!!(null!=t&&t.archived_at)},eE=function(e){return!!e&&"boolean"==typeof e.archived},eC=function(e){var t,n,r,s=e.atIndex,i=e.sort,a=e.targetKey;if(!i)return null;var o=null;if(Array.isArray(i))o=null!==(r=i[s])&&void 0!==r?r:null;else{var c=0;for(var u in i){if(c!==s){c++;continue}if(u!==a)return null;o=i;break}}return null!==(t=null===(n=o)||void 0===n?void 0:n[a])&&void 0!==t?t:null},eR=function(e){var t=eO({sort:e});return"number"==typeof t&&1===Math.abs(t)},eO=function(e){return eC({atIndex:0,sort:e.sort,targetKey:"pinned_at"})},eI=function(e){var t,n=e.channels,r=null,s=Q(n);try{for(s.s();!(t=s.n()).done;){var i=t.value;if(!ek(i))break;"number"==typeof r?r++:r=0}}catch(e){s.e(e)}finally{s.f()}return r},eU=function(e){var t=e.channels,n=e.channelToMove,r=e.channelToMoveIndexWithinChannels,s=e.sort,i=null!=r?r:t.findIndex(function(e){return e.cid===n.cid}),a=i>=0,o=0===i,c=eR(s),u=ek(n);if(o||c&&u)return t;var l=E()(t);a&&l.splice(i,1);var h=null;return c&&(h=eI({channels:l})),l.splice("number"==typeof h?h+1:0,0,n),l},eL={hasNext:!1,hasPrev:!1};function eP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eP(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eP(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eT=function(){var e;function t(e){var n,r=this;u()(this,t),d()(this,"_channel",void 0),d()(this,"watcher_count",void 0),d()(this,"typing",void 0),d()(this,"read",void 0),d()(this,"pinnedMessages",void 0),d()(this,"pending_messages",void 0),d()(this,"threads",void 0),d()(this,"mutedUsers",void 0),d()(this,"watchers",void 0),d()(this,"members",void 0),d()(this,"unreadCount",void 0),d()(this,"membership",void 0),d()(this,"last_message_at",void 0),d()(this,"isUpToDate",void 0),d()(this,"messageSets",[]),d()(this,"formatMessage",function(e){return eh(e)}),d()(this,"setIsUpToDate",function(e){r.isUpToDate=e}),d()(this,"removeMessageFromArray",function(e,t){var n=e.filter(function(e){return!(e.id&&t.id&&e.id===t.id)});return{removed:n.length<e.length,result:n}}),d()(this,"updateUserMessages",function(e){var t=function(e,t){for(var n=0;n<e.length;n++){var r,s=e[n];(null===(r=s.user)||void 0===r?void 0:r.id)===t.id&&(e[n]=eA(eA({},s),{},{user:t}))}};for(var n in r.messageSets.forEach(function(n){return t(n.messages,e)}),r.threads)t(r.threads[n],e);t(r.pinnedMessages,e)}),d()(this,"deleteUserMessages",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<e.length;r++){var s,i=e[r];(null===(s=i.user)||void 0===s?void 0:s.id)===t.id&&(n?e[r]={cid:i.cid,created_at:i.created_at,deleted_at:t.deleted_at,id:i.id,latest_reactions:[],mentioned_users:[],own_reactions:[],parent_id:i.parent_id,reply_count:i.reply_count,status:i.status,thread_participants:i.thread_participants,type:"deleted",updated_at:i.updated_at,user:i.user}:e[r]=eA(eA({},i),{},{type:"deleted",deleted_at:t.deleted_at?new Date(t.deleted_at):null}))}};for(var s in r.messageSets.forEach(function(r){return n(r.messages,e,t)}),r.threads)n(r.threads[s],e,t);n(r.pinnedMessages,e,t)}),this._channel=e,this.watcher_count=0,this.typing={},this.read={},this.initMessages(),this.pinnedMessages=[],this.pending_messages=[],this.threads={},this.mutedUsers=[],this.watchers={},this.members={},this.membership={},this.unreadCount=0,this.isUpToDate=!0,this.last_message_at=(null==e?void 0:null===(n=e.state)||void 0===n?void 0:n.last_message_at)!=null?new Date(e.state.last_message_at):null}return h()(t,[{key:"messages",get:function(){var e;return(null===(e=this.messageSets.find(function(e){return e.isCurrent}))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex(function(e){return e.isCurrent});this.messageSets[t].messages=e}},{key:"latestMessages",get:function(){var e;return(null===(e=this.messageSets.find(function(e){return e.isLatest}))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex(function(e){return e.isLatest});this.messageSets[t].messages=e}},{key:"messagePagination",get:function(){var e;return(null===(e=this.messageSets.find(function(e){return e.isCurrent}))||void 0===e?void 0:e.pagination)||eL}},{key:"addMessageSorted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"latest";return this.addMessagesSorted([e],t,!1,n,r)}},{key:"addMessagesSorted",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"current",i=this.findTargetMessageSet(e,r,s),a=i.messagesToAdd,o=i.targetMessageSetIndex,c=0;c<a.length;c+=1)if(!a[c].shadowed){var u,l=a[c].created_at instanceof Date,h=void 0;l?h=a[c]:((h=this.formatMessage(a[c])).user&&null!==(u=this._channel)&&void 0!==u&&u.cid&&this._channel.getClient().state.updateUserReference(h.user,this._channel.cid),n&&h.id&&this.threads[h.id]&&delete this.threads[h.id],this.last_message_at||(this.last_message_at=new Date(h.created_at.getTime())),h.created_at.getTime()>this.last_message_at.getTime()&&(this.last_message_at=new Date(h.created_at.getTime())));var p=h.parent_id;if((!p||h.show_in_channel)&&-1!==o&&(this.messageSets[o].messages=this._addToMessageList(this.messageSets[o].messages,h,t,"created_at",r)),p&&!n){var d=this.threads[p]||[];this.threads[p]=this._addToMessageList(d,h,t,"created_at",r)}}return{messageSet:this.messageSets[o]}}},{key:"addPinnedMessages",value:function(e){for(var t=0;t<e.length;t+=1)this.addPinnedMessage(e[t])}},{key:"addPinnedMessage",value:function(e){this.pinnedMessages=this._addToMessageList(this.pinnedMessages,this.formatMessage(e),!1,"pinned_at")}},{key:"removePinnedMessage",value:function(e){var t=this.removeMessageFromArray(this.pinnedMessages,e).result;this.pinnedMessages=t}},{key:"addReaction",value:function(e,t,n){var r=this;if(t)return this._updateMessage(t,function(s){return t.own_reactions=r._addOwnReactionToMessage(s.own_reactions,e,n),r.formatMessage(t)}),t}},{key:"_addOwnReactionToMessage",value:function(e,t,n){return e=(e=n?[]:this._removeOwnReactionFromMessage(e,t))||[],this._channel.getClient().userID===t.user_id&&e.push(t),e}},{key:"_removeOwnReactionFromMessage",value:function(e,t){return e?e.filter(function(e){return e.user_id!==t.user_id||e.type!==t.type}):e}},{key:"removeReaction",value:function(e,t){var n=this;if(t)return this._updateMessage(t,function(r){return t.own_reactions=n._removeOwnReactionFromMessage(r.own_reactions,e),n.formatMessage(t)}),t}},{key:"_updateQuotedMessageReferences",value:function(e){var t=this,n=e.message,r=e.remove,s=function(e){var t,n;return eA(eA({},e),{},{created_at:e.created_at.toISOString(),pinned_at:null===(t=e.pinned_at)||void 0===t?void 0:t.toISOString(),updated_at:null===(n=e.updated_at)||void 0===n?void 0:n.toISOString()})},i=function(e){var i=e.reduce(function(e,t){return t.quoted_message_id===n.id&&e.push(eA(eA({},s(t)),{},{quoted_message:r?eA(eA({},n),{},{attachments:[]}):n})),e},[]);t.addMessagesSorted(i,!0)};n.parent_id?n.parent_id&&this.threads[n.parent_id]&&i(this.threads[n.parent_id]):this.messageSets.forEach(function(e){return i(e.messages)})}},{key:"removeQuotedMessageReferences",value:function(e){this._updateQuotedMessageReferences({message:e,remove:!0})}},{key:"_updateMessage",value:function(e,t){var n=e.parent_id,r=e.show_in_channel,s=e.pinned;if(n&&this.threads[n]){var i=this.threads[n],a=i.findIndex(function(t){return t.id===e.id});-1!==a&&(i[a]=t(i[a]),this.threads[n]=i)}if(!r&&!n||r){var o=this.findMessageSetIndex(e);if(-1!==o){var c=this.messageSets[o].messages.findIndex(function(t){return t.id===e.id});-1!==c&&(this.messageSets[o].messages[c]=t(this.messageSets[o].messages[c]))}}if(s){var u=this.pinnedMessages.findIndex(function(t){return t.id===e.id});-1!==u&&(this.pinnedMessages[u]=t(this.pinnedMessages[u]))}}},{key:"_addToMessageList",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",s=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return ed(e,t,n,r,s)}},{key:"removeMessage",value:function(e){var t=!1;if(e.parent_id&&this.threads[e.parent_id]){var n=this.removeMessageFromArray(this.threads[e.parent_id],e),r=n.removed,s=n.result;this.threads[e.parent_id]=s,t=r}else{var i,a=null!==(i=e.messageSetIndex)&&void 0!==i?i:this.findMessageSetIndex(e);if(-1!==a){var o=this.removeMessageFromArray(this.messageSets[a].messages,e),c=o.removed,u=o.result;this.messageSets[a].messages=u,t=c}}return t}},{key:"filterErrorMessages",value:function(){var e=this.latestMessages.filter(function(e){return"error"!==e.type});this.latestMessages=e}},{key:"clean",value:function(){for(var e=new Date,t=0,n=Object.entries(this.typing);t<n.length;t++){var r=m()(n[t],2),s=r[0],i=r[1],a="string"==typeof i.received_at?new Date(i.received_at):i.received_at||new Date;e.getTime()-a.getTime()>7e3&&(delete this.typing[s],this._channel.getClient().dispatchEvent({cid:this._channel.cid,type:"typing.stop",user:{id:s}}))}}},{key:"clearMessages",value:function(){this.initMessages(),this.pinnedMessages=[]}},{key:"initMessages",value:function(){this.messageSets=[{messages:[],isLatest:!0,isCurrent:!0,pagination:eL}]}},{key:"loadMessageIntoState",value:(e=o()(v().mark(function e(t,n){var r,s,i,a,o,c,u=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=u.length>2&&void 0!==u[2]?u[2]:25,a=!1,o=!1,c=n||t,"latest"!==t){e.next=10;break}if(this.messages!==this.latestMessages){e.next=7;break}return e.abrupt("return");case 7:i=this.messageSets.findIndex(function(e){return e.isLatest}),e.next=11;break;case 10:i=this.findMessageSetIndex({id:c});case 11:if(-1!==i&&(this.switchToMessageSet(i),a=!0),o=!n||!!(null!==(r=this.threads[n])&&void 0!==r&&r.find(function(e){return e.id===t})),!(a&&o)){e.next=15;break}return e.abrupt("return");case 15:if(a){e.next=18;break}return e.next=18,this._channel.query({messages:{id_around:c,limit:s}},"new");case 18:if(!(!o&&n)){e.next=21;break}return e.next=21,this._channel.getReplies(n,{id_around:t,limit:s});case 21:-1!==(i=this.findMessageSetIndex({id:c}))&&this.switchToMessageSet(i);case 23:case"end":return e.stop()}},e,this)})),function(t,n){return e.apply(this,arguments)})},{key:"findMessage",value:function(e,t){if(t){var n=this.threads[t];if(!n)return;return n.find(function(t){return t.id===e})}var r=this.findMessageSetIndex({id:e});if(-1!==r)return this.messageSets[r].messages.find(function(t){return t.id===e})}},{key:"switchToMessageSet",value:function(e){var t=this.messageSets.find(function(e){return e.isCurrent});t&&(t.isCurrent=!1,this.messageSets[e].isCurrent=!0)}},{key:"areMessageSetsOverlap",value:function(e,t){return e.some(function(e){return t.find(function(t){return e.id===t.id})})}},{key:"findMessageSetIndex",value:function(e){return this.messageSets.findIndex(function(t){return!!t.messages.find(function(t){return t.id===e.id})})}},{key:"findTargetMessageSet",value:function(e){var t,n=this,r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"current",i=e;if(r){var a=this.messageSets.map(function(e,t){return t}).filter(function(t){return n.areMessageSetsOverlap(n.messageSets[t].messages,e)});switch(s){case"new":a.length>0?t=a[0]:e.some(function(e){return!e.parent_id})&&(this.messageSets.push({messages:[],isCurrent:!1,isLatest:!1,pagination:eL}),t=this.messageSets.length-1);break;case"current":t=this.messageSets.findIndex(function(e){return e.isCurrent});break;case"latest":t=this.messageSets.findIndex(function(e){return e.isLatest});break;default:t=-1}var o=a.splice(0,1)[0],c=E()(a);if(void 0!==o&&o!==t&&c.push(t),c.length>0){var u=this.messageSets[o],l=this.messageSets.filter(function(e,t){return -1!==c.indexOf(t)});l.forEach(function(e){u.isLatest=u.isLatest||e.isLatest,u.isCurrent=u.isCurrent||e.isCurrent,u.pagination.hasPrev=e.messages[0].created_at<u.messages[0].created_at?e.pagination.hasPrev:u.pagination.hasPrev,u.pagination.hasNext=u.messages.slice(-1)[0].created_at<e.messages.slice(-1)[0].created_at?e.pagination.hasNext:u.pagination.hasNext,i=[].concat(E()(i),E()(e.messages))}),l.forEach(function(e){return n.messageSets.splice(n.messageSets.indexOf(e),1)}),t=this.messageSets.findIndex(function(t){return n.areMessageSetsOverlap(t.messages,e)})}}else t=this.findMessageSetIndex(e[0]);return{targetMessageSetIndex:t,messagesToAdd:i}}}]),t}();function ej(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return eM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eM(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function eM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eD(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eD(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var e$=function(){var e,t,n,r,s,i,a,c,l,p,f,g,m,y,b,w,x,k,S,C,R,O,I,U,L,P,A,T,j,M,D,N,$,F,q,H,V,B,W,G,z,K,X,J,Y,Q,Z,et,en,er,ei,ea;function eo(e,t,n,r){var s,i=this;if(u()(this,eo),d()(this,"_client",void 0),d()(this,"type",void 0),d()(this,"id",void 0),d()(this,"data",void 0),d()(this,"_data",void 0),d()(this,"cid",void 0),d()(this,"listeners",void 0),d()(this,"state",void 0),d()(this,"initialized",void 0),d()(this,"offlineMode",void 0),d()(this,"lastKeyStroke",void 0),d()(this,"lastTypingEvent",void 0),d()(this,"isTyping",void 0),d()(this,"disconnected",void 0),d()(this,"push_preferences",void 0),d()(this,"create",(s=o()(v().mark(function e(t){var n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=eN(eN({},t),{},{watch:!1,state:!1,presence:!1}),e.next=3,i.query(n,"latest");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})),d()(this,"_callChannelListeners",function(e){var t=[];i.listeners.all&&t.push.apply(t,E()(i.listeners.all)),i.listeners[e.type]&&t.push.apply(t,E()(i.listeners[e.type]));for(var n=0;n<t.length;n++){var r=t[n];"string"!=typeof r&&r(e)}}),d()(this,"_channelURL",function(){if(!i.id)throw Error("channel id is not defined");return"".concat(i.getClient().baseURL,"/channels/").concat(encodeURIComponent(i.type),"/").concat(encodeURIComponent(i.id))}),!/^[\w_-]+$/.test(t))throw Error("Invalid chat type ".concat(t,', letters, numbers and "_-" are allowed'));if("string"==typeof n&&!/^[\w!_-]+$/.test(n))throw Error("Invalid chat id ".concat(n,', letters, numbers and "!-_" are allowed'));this._client=e,this.type=t,this.id=n,this.data=r,this._data=eN({},r),this.cid="".concat(t,":").concat(n),this.listeners={},this.state=new eT(this),this.initialized=!1,this.offlineMode=!1,this.lastTypingEvent=null,this.isTyping=!1,this.disconnected=!1}return h()(eo,[{key:"getClient",value:function(){if(!0===this.disconnected)throw Error("You can't use a channel after client.disconnect() was called");return this._client}},{key:"getConfig",value:function(){return this.getClient().configs[this.cid]}},{key:"sendMessage",value:(e=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/message",eN({message:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(t,n){return e.apply(this,arguments)})},{key:"sendFile",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/file"),e,t,n,r)}},{key:"sendImage",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/image"),e,t,n,r)}},{key:"deleteFile",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/file"),{url:e})}},{key:"deleteImage",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/image"),{url:e})}},{key:"sendEvent",value:(t=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().post(this._channelURL()+"/event",{event:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"search",value:(n=o()(v().mark(function e(t){var n,r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=s.length>1&&void 0!==s[1]?s[1]:{}).offset&&n.next)){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(r=eN(eN({filter_conditions:{cid:this.cid}},n),{},{sort:n.sort?es(n.sort):void 0}),"string"!=typeof t){e.next=8;break}r.query=t,e.next=13;break;case 8:if("object"!==_()(t)){e.next=12;break}r.message_filter_conditions=t,e.next=13;break;case 12:throw Error("Invalid type ".concat(_()(t)," for query parameter"));case 13:return e.next=15,this.getClient().wsPromise;case 15:return e.next=17,this.getClient().get(this.getClient().baseURL+"/search",{payload:r});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"queryMembers",value:(r=o()(v().mark(function e(t){var n,r,s,i,a,o,c=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:[],s=c.length>2&&void 0!==c[2]?c[2]:{},a=this.type,this.id?i=this.id:null!==(n=this.data)&&void 0!==n&&n.members&&Array.isArray(this.data.members)&&(o=this.data.members),e.next=6,this.getClient().get(this.getClient().baseURL+"/members",{payload:eN({type:a,id:i,members:o,sort:es(r),filter_conditions:t},s)});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"updateMemberPartial",value:(s=o()(v().mark(function e(t,n){var r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new URL("".concat(this._channelURL(),"/member")),null!=n&&n.userId&&r.searchParams.append("user_id",n.userId),e.next=4,this.getClient().patch(r.toString(),t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"partialUpdateMember",value:(i=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the user id");case 2:return e.next=4,this.getClient().patch(this._channelURL()+"/member/".concat(encodeURIComponent(t)),n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"sendReaction",value:(a=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Message id is missing");case 2:if(!(!n||0===Object.keys(n).length)){e.next=4;break}throw Error("Reaction object is missing");case 4:return e.next=6,this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/reaction"),eN({reaction:n},r));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)})),function(e,t,n){return a.apply(this,arguments)})},{key:"deleteReaction",value:function(e,t,n){if(this._checkInitialized(),!t||!e)throw Error("Deleting a reaction requires specifying both the message and reaction type");var r=this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reaction/").concat(encodeURIComponent(t));return n?this.getClient().delete(r,{user_id:n}):this.getClient().delete(r,{})}},{key:"update",value:(c=o()(v().mark(function e(){var t,n,r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1?s[1]:void 0,r=s.length>2?s[2]:void 0,["config","cid","created_by","id","member_count","type","created_at","updated_at","last_message_at","own_capabilities"].forEach(function(e){delete t[e]}),e.next=7,this._update(eN({message:n,data:t},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"updatePartial",value:(l=o()(v().mark(function e(t){var n,r,s,i;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().patch(this._channelURL(),t);case 2:return s=e.sent,i=E()(s.channel.own_capabilities||[]).sort().join()!==E()(Array.isArray(null===(n=this.data)||void 0===n?void 0:n.own_capabilities)?null===(r=this.data)||void 0===r?void 0:r.own_capabilities:[]).sort().join(),this.data=s.channel,i&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:s.channel.own_capabilities}),e.abrupt("return",s);case 7:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"enableSlowMode",value:(p=o()(v().mark(function e(t){var n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:t});case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"disableSlowMode",value:(f=o()(v().mark(function e(){var t;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:0});case 2:return t=e.sent,this.data=t.channel,e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"delete",value:(g=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().delete(this._channelURL(),eN({},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"truncate",value:(m=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this._channelURL()+"/truncate",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"acceptInvite",value:(y=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(eN({accept_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"rejectInvite",value:(b=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(eN({reject_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return b.apply(this,arguments)})},{key:"addMembers",value:(w=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(eN({add_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"addModerators",value:(x=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(eN({add_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return x.apply(this,arguments)})},{key:"assignRoles",value:(k=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(eN({assign_roles:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},{key:"inviteMembers",value:(S=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(eN({invites:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"removeMembers",value:(C=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(eN({remove_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return C.apply(this,arguments)})},{key:"demoteModerators",value:(R=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(eN({demote_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return R.apply(this,arguments)})},{key:"_update",value:(O=o()(v().mark(function e(t){var n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),t);case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"mute",value:(I=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/mute/channel",eN({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return I.apply(this,arguments)})},{key:"unmute",value:(U=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/unmute/channel",eN({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return U.apply(this,arguments)})},{key:"archive",value:(L=o()(v().mark(function e(){var t,n,r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for archiving a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{archived:!0}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}},e,this)})),function(){return L.apply(this,arguments)})},{key:"unarchive",value:(P=o()(v().mark(function e(){var t,n,r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for unarchiving a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{archived:!1}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}},e,this)})),function(){return P.apply(this,arguments)})},{key:"pin",value:(A=o()(v().mark(function e(){var t,n,r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for pinning a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{pinned:!0}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"unpin",value:(T=o()(v().mark(function e(){var t,n,r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for unpinning a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{pinned:!1}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})},{key:"muteStatus",value:function(){return this._checkInitialized(),this.getClient()._muteStatus(this.cid)}},{key:"sendAction",value:function(e,t){if(this._checkInitialized(),!e)throw Error("Message id is missing");return this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/action"),{message_id:e,form_data:t,id:this.id,type:this.type})}},{key:"keystroke",value:(j=o()(v().mark(function e(t,n){var r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:if(r=new Date,s=this.lastTypingEvent&&r.getTime()-this.lastTypingEvent.getTime(),this.lastKeyStroke=r,this.isTyping=!0,!(null===s||s>2e3)){e.next=10;break}return this.lastTypingEvent=new Date,e.next=10,this.sendEvent(eN({type:"typing.start",parent_id:t},n||{}));case 10:case"end":return e.stop()}},e,this)})),function(e,t){return j.apply(this,arguments)})},{key:"updateAIState",value:(M=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.sendEvent(eN(eN({},r),{},{type:"ai_indicator.update",message_id:t,ai_state:n}));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return M.apply(this,arguments)})},{key:"clearAIIndicator",value:(D=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendEvent({type:"ai_indicator.clear"});case 2:case"end":return e.stop()}},e,this)})),function(){return D.apply(this,arguments)})},{key:"stopAIResponse",value:(N=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendEvent({type:"ai_indicator.stop"});case 2:case"end":return e.stop()}},e,this)})),function(){return N.apply(this,arguments)})},{key:"stopTyping",value:($=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:return this.lastTypingEvent=null,this.isTyping=!1,e.next=6,this.sendEvent(eN({type:"typing.stop",parent_id:t},n||{}));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return $.apply(this,arguments)})},{key:"_isTypingIndicatorsEnabled",value:function(){var e,t,n,r,s;return null!==(e=this.getConfig())&&void 0!==e&&!!e.typing_events&&(null===(t=null===(n=this.getClient().user)||void 0===n?void 0:null===(r=n.privacy_settings)||void 0===r?void 0:null===(s=r.typing_indicators)||void 0===s?void 0:s.enabled)||void 0===t||t)}},{key:"lastMessage",value:function(){var e=this.state.latestMessages.length-5;e<0&&(e=0);var t=this.state.latestMessages.length+1,n=this.state.latestMessages.slice(e,t);return n.sort(function(e,t){return t.created_at.getTime()-e.created_at.getTime()}),n[0]}},{key:"markRead",value:(F=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>0&&void 0!==r[0]?r[0]:{},this._checkInitialized(),!(!(null!==(t=this.getConfig())&&void 0!==t&&t.read_events)&&!this.getClient()._isUsingServerAuth())){e.next=4;break}return e.abrupt("return",Promise.resolve(null));case 4:return e.next=6,this.getClient().post(this._channelURL()+"/read",eN({},n));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)})),function(){return F.apply(this,arguments)})},{key:"markUnread",value:(q=o()(v().mark(function e(t){var n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkInitialized(),!(!(null!==(n=this.getConfig())&&void 0!==n&&n.read_events)&&!this.getClient()._isUsingServerAuth())){e.next=3;break}return e.abrupt("return",Promise.resolve(null));case 3:return e.next=5,this.getClient().post(this._channelURL()+"/unread",eN({},t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"clean",value:function(){this.lastKeyStroke&&new Date().getTime()-this.lastKeyStroke.getTime()>1e3&&this.isTyping&&ee(this.stopTyping(),"stop typing event"),this.state.clean()}},{key:"watch",value:(H=o()(v().mark(function e(t){var n,r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={state:!0,watch:!0,presence:!1},e.next=3,this.getClient().wsPromise;case 3:return this.getClient()._hasConnectionID()||(n.watch=!1),r=eN(eN({},n),t),e.next=7,this.query(r,"latest");case 7:return s=e.sent,this.initialized=!0,this.data=s.channel,this._client.logger("info","channel:watch() - started watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",s);case 12:case"end":return e.stop()}},e,this)})),function(e){return H.apply(this,arguments)})},{key:"stopWatching",value:(V=o()(v().mark(function e(){var t;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/stop-watching",{});case 2:return t=e.sent,this._client.logger("info","channel:watch() - stopped watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return V.apply(this,arguments)})},{key:"getReplies",value:(B=o()(v().mark(function e(t,n,r){var s,i;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r?es(r):void 0,e.next=3,this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/replies"),eN({sort:s},n));case 3:return(i=e.sent).messages&&this.state.addMessagesSorted(i.messages),e.abrupt("return",i);case 6:case"end":return e.stop()}},e,this)})),function(e,t,n){return B.apply(this,arguments)})},{key:"getPinnedMessages",value:(W=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:[],e.next=3,this.getClient().get(this._channelURL()+"/pinned_messages",{payload:eN(eN({},t),{},{sort:es(n)})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return W.apply(this,arguments)})},{key:"getReactions",value:function(e,t){return this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reactions"),eN({},t))}},{key:"getMessagesById",value:function(e){return this.getClient().get(this._channelURL()+"/messages",{ids:e.join(",")})}},{key:"lastRead",value:function(){var e=this.getClient().userID;if(e)return this.state.read[e]?this.state.read[e].last_read:null}},{key:"_countMessageAsUnread",value:function(e){var t,n,r,s;return!(e.shadowed||e.silent||e.parent_id&&!e.show_in_channel||(null===(t=e.user)||void 0===t?void 0:t.id)===this.getClient().userID||null!==(n=e.user)&&void 0!==n&&n.id&&this.getClient().userMuteStatus(e.user.id)||Array.isArray(null===(r=this.data)||void 0===r?void 0:r.own_capabilities)&&!(null!==(s=this.data)&&void 0!==s&&s.own_capabilities.includes("read-events")))&&!this.muteStatus().muted}},{key:"countUnread",value:function(e){if(!e)return this.state.unreadCount;for(var t=0,n=0;n<this.state.latestMessages.length;n+=1){var r=this.state.latestMessages[n];r.created_at>e&&this._countMessageAsUnread(r)&&t++}return t}},{key:"countUnreadMentions",value:function(){for(var e=this.lastRead(),t=this.getClient().userID,n=0,r=0;r<this.state.latestMessages.length;r+=1){var s,i=this.state.latestMessages[r];this._countMessageAsUnread(i)&&(!e||i.created_at>e)&&null!==(s=i.mentioned_users)&&void 0!==s&&s.some(function(e){return e.id===t})&&n++}return n}},{key:"query",value:(G=o()(v().mark(function e(t){var n,r,s,i,a,o,c,u,l,h,p=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>1&&void 0!==p[1]?p[1]:"current",e.next=3,this.getClient().wsPromise;case 3:return o="".concat(this.getClient().baseURL,"/channels/").concat(encodeURIComponent(this.type)),this.id&&(o+="/".concat(encodeURIComponent(this.id))),e.next=7,this.getClient().post(o+"/query",eN({data:this._data,state:!0},t));case 7:return c=e.sent,this.id||(this.id=c.channel.id,this.cid=c.channel.cid,(u=ex(this.type,c.members.map(function(e){var t;return e.user_id||(null===(t=e.user)||void 0===t?void 0:t.id)||""})))&&u in this.getClient().activeChannels&&delete this.getClient().activeChannels[u],!(this.cid in this.getClient().activeChannels)&&this.getClient()._cacheEnabled()&&(this.getClient().activeChannels[this.cid]=this)),this.getClient()._addChannelConfig(c.channel),(l=this._initializeState(c,a).messageSet).pagination=eN(eN({},l.pagination),eb({parentSet:l,messagePaginationOptions:null==t?void 0:t.messages,requestedPageSize:null!==(n=null==t?void 0:null===(r=t.messages)||void 0===r?void 0:r.limit)&&void 0!==n?n:100,returnedPage:c.messages,logger:this.getClient().logger})),this.getClient().polls.hydratePollCache(c.messages,!0),h=E()(c.channel.own_capabilities||[]).sort().join()!==E()(Array.isArray(null===(s=this.data)||void 0===s?void 0:s.own_capabilities)?null===(i=this.data)||void 0===i?void 0:i.own_capabilities:[]).sort().join(),this.data=c.channel,this.offlineMode=!1,h&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:c.channel.own_capabilities}),this.getClient().dispatchEvent({type:"channels.queried",queriedChannels:{channels:[c],isLatestMessageSet:l.isLatest}}),e.abrupt("return",c);case 19:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"banUser",value:(z=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().banUser(t,eN(eN({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return z.apply(this,arguments)})},{key:"hide",value:(K=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]&&r[1],this._checkInitialized(),e.next=5,this.getClient().post("".concat(this._channelURL(),"/hide"),{user_id:t,clear_history:n});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(){return K.apply(this,arguments)})},{key:"show",value:(X=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._checkInitialized(),e.next=4,this.getClient().post("".concat(this._channelURL(),"/show"),{user_id:t});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(){return X.apply(this,arguments)})},{key:"unbanUser",value:(J=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().unbanUser(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return J.apply(this,arguments)})},{key:"shadowBan",value:(Y=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().shadowBan(t,eN(eN({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return Y.apply(this,arguments)})},{key:"removeShadowBan",value:(Q=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().removeShadowBan(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return Q.apply(this,arguments)})},{key:"createCall",value:(Z=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/call",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return Z.apply(this,arguments)})},{key:"vote",value:(et=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().castPollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return et.apply(this,arguments)})},{key:"removeVote",value:(en=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().removePollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return en.apply(this,arguments)})},{key:"createDraft",value:(er=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/draft",{message:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return er.apply(this,arguments)})},{key:"deleteDraft",value:(ei=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(n.length>0&&void 0!==n[0]?n[0]:{}).parent_id,e.next=3,this.getClient().delete(this._channelURL()+"/draft",{parent_id:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return ei.apply(this,arguments)})},{key:"getDraft",value:(ea=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(n.length>0&&void 0!==n[0]?n[0]:{}).parent_id,e.next=3,this.getClient().get(this._channelURL()+"/draft",{parent_id:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return ea.apply(this,arguments)})},{key:"on",value:function(e,t){var n=this,r=t?e:"all",s=t||e;return r in this.listeners||(this.listeners[r]=[]),this._client.logger("info","Attaching listener for ".concat(r," event on channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[r].push(s),{unsubscribe:function(){n._client.logger("info","Removing listener for ".concat(r," event from channel ").concat(n.cid),{tags:["event","channel"],channel:n}),n.listeners[r]=n.listeners[r].filter(function(e){return e!==s})}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Removing listener for ".concat(n," event from channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n]=this.listeners[n].filter(function(e){return e!==r})}},{key:"_handleChannelEvent",value:function(e){this._client.logger("info","channel:_handleChannelEvent - Received event of type { ".concat(e.type," } on ").concat(this.cid),{tags:["event","channel"],channel:this});var t,n,r,s,i,a,o,c,u=this.state;switch(e.type){case"typing.start":null!==(l=e.user)&&void 0!==l&&l.id&&(u.typing[e.user.id]=e);break;case"typing.stop":null!==(h=e.user)&&void 0!==h&&h.id&&delete u.typing[e.user.id];break;case"message.read":null!==(p=e.user)&&void 0!==p&&p.id&&e.created_at&&(u.read[e.user.id]={last_read:new Date(e.created_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:0},(null===(x=e.user)||void 0===x?void 0:x.id)===(null===(k=this.getClient().user)||void 0===k?void 0:k.id)&&(u.unreadCount=0));break;case"user.watching.start":case"user.updated":null!==(f=e.user)&&void 0!==f&&f.id&&(u.watchers[e.user.id]=e.user);break;case"user.watching.stop":null!==(v=e.user)&&void 0!==v&&v.id&&delete u.watchers[e.user.id];break;case"message.deleted":e.message&&(this._extendEventWithOwnReactions(e),e.hard_delete?u.removeMessage(e.message):u.addMessageSorted(e.message,!1,!1),u.removeQuotedMessageReferences(e.message),e.message.pinned&&u.removePinnedMessage(e.message));break;case"message.new":if(e.message){var l,h,p,f,v,g,m,y,b,w,_,x,k,S,E,C,R=(null===(S=e.user)||void 0===S?void 0:S.id)===(null===(E=this.getClient().user)||void 0===E?void 0:E.id),O=e.message.parent_id&&!e.message.show_in_channel;if((this.state.isUpToDate||O)&&u.addMessageSorted(e.message,R),e.message.pinned&&u.addPinnedMessage(e.message),R||O)break;if(null!==(C=e.user)&&void 0!==C&&C.id)for(var I in u.read)I===e.user.id?u.read[e.user.id]={last_read:new Date(e.created_at),user:e.user,unread_messages:0}:u.read[I].unread_messages+=1;this._countMessageAsUnread(e.message)&&(u.unreadCount=u.unreadCount+1)}break;case"message.updated":case"message.undeleted":e.message&&(this._extendEventWithOwnReactions(e),u.addMessageSorted(e.message,!1,!1),u._updateQuotedMessageReferences({message:e.message}),e.message.pinned?u.addPinnedMessage(e.message):u.removePinnedMessage(e.message));break;case"channel.truncated":if(null!==(g=e.channel)&&void 0!==g&&g.truncated_at){var U=+new Date(e.channel.truncated_at);u.messageSets.forEach(function(e,t){e.messages.forEach(function(e){var n=e.created_at,r=e.id;U>+n&&u.removeMessage({id:r,messageSetIndex:t})})}),u.pinnedMessages.forEach(function(e){var t=e.id;U>+e.created_at&&u.removePinnedMessage({id:t})})}else u.clearMessages();u.unreadCount=0,e.message&&(u.addMessageSorted(e.message),e.message.pinned&&u.addPinnedMessage(e.message));break;case"member.added":case"member.updated":var L,P=eN({},e.member);null===P.pinned_at&&delete P.pinned_at,null===P.archived_at&&delete P.archived_at,null!=P&&P.user&&(u.members=eN(eN({},u.members),{},d()({},P.user.id,P)));var A=this.getClient().userID;"string"==typeof A&&"string"==typeof(null==P?void 0:null===(L=P.user)||void 0===L?void 0:L.id)&&P.user.id===A&&(u.membership=P);break;case"member.removed":if(null!==(m=e.user)&&void 0!==m&&m.id){var T=eN({},u.members);delete T[e.user.id],u.members=T}break;case"notification.mark_unread":if(!((null===(j=e.user)||void 0===j?void 0:j.id)===(null===(M=this.getClient().user)||void 0===M?void 0:M.id)&&e.user))break;var j,M,D,N=null!==(D=e.unread_messages)&&void 0!==D?D:0;u.read[e.user.id]={first_unread_message_id:e.first_unread_message_id,last_read:new Date(e.last_read_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:N},u.unreadCount=N;break;case"channel.updated":e.channel&&((null===(t=e.channel)||void 0===t?void 0:t.frozen)!==void 0&&e.channel.frozen!==(null===(n=this.data)||void 0===n?void 0:n.frozen)&&this.query({state:!1,messages:{limit:0},watchers:{limit:0}}),this.data=eN(eN({},e.channel),{},{hidden:null!==(r=null===(s=e.channel)||void 0===s?void 0:s.hidden)&&void 0!==r?r:null===(i=this.data)||void 0===i?void 0:i.hidden,own_capabilities:null!==(a=null===(o=e.channel)||void 0===o?void 0:o.own_capabilities)&&void 0!==a?a:null===(c=this.data)||void 0===c?void 0:c.own_capabilities}));break;case"reaction.new":e.message&&e.reaction&&(e.message=u.addReaction(e.reaction,e.message));break;case"reaction.deleted":e.reaction&&(e.message=u.removeReaction(e.reaction,e.message));break;case"reaction.updated":e.reaction&&(e.message=u.addReaction(e.reaction,e.message,!0));break;case"channel.hidden":this.data=eN(eN({},this.data),{},{hidden:!0}),e.clear_history&&u.clearMessages();break;case"channel.visible":this.data=eN(eN({},this.data),{},{hidden:!1});break;case"user.banned":if(!(null!==(y=e.user)&&void 0!==y&&y.id))break;u.members[e.user.id]=eN(eN({},u.members[e.user.id]||{}),{},{shadow_banned:!!e.shadow,banned:!e.shadow,user:eN(eN({},(null===(b=u.members[e.user.id])||void 0===b?void 0:b.user)||{}),e.user)});break;case"user.unbanned":if(!(null!==(w=e.user)&&void 0!==w&&w.id))break;u.members[e.user.id]=eN(eN({},u.members[e.user.id]||{}),{},{shadow_banned:!1,banned:!1,user:eN(eN({},(null===(_=u.members[e.user.id])||void 0===_?void 0:_.user)||{}),e.user)})}void 0!==e.watcher_count&&(this.state.watcher_count=e.watcher_count)}},{key:"_checkInitialized",value:function(){if(!this.initialized&&!this.offlineMode&&!this.getClient()._isUsingServerAuth())throw Error("Channel ".concat(this.cid," hasn't been initialized yet. Make sure to call .watch() and wait for it to resolve"))}},{key:"_initializeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest",n=this.getClient(),r=n.state,s=n.user,i=n.userID;if(e.members){this._hydrateMembers({members:e.members});var a,o=ej(e.members);try{for(o.s();!(a=o.n()).done;){var c=a.value;c.user&&r.updateUserReference(c.user,this.cid)}}catch(e){o.e(e)}finally{o.f()}}this.state.membership=e.membership||{};var u=e.messages||[];this.state.messages||this.state.initMessages();var l=this.state.addMessagesSorted(u,!1,!0,!0,t).messageSet;if(this.state.pinnedMessages||(this.state.pinnedMessages=[]),this.state.addPinnedMessages(e.pinned_messages||[]),e.pending_messages&&(this.state.pending_messages=e.pending_messages),void 0!==e.watcher_count&&(this.state.watcher_count=e.watcher_count),e.watchers){var h,p=ej(e.watchers);try{for(p.s();!(h=p.n()).done;){var d=h.value;d&&(r.updateUserReference(d,this.cid),this.state.watchers[d.id]=d)}}catch(e){p.e(e)}finally{p.f()}}if(null!=i){var f=this.state.last_message_at||new Date;s&&(this.state.read[s.id]={user:s,last_read:f,unread_messages:0})}if(e.read){var v,g=ej(e.read);try{for(g.s();!(v=g.n()).done;){var m,y=v.value;this.state.read[y.user.id]={last_read:new Date(y.last_read),last_read_message_id:y.last_read_message_id,unread_messages:null!==(m=y.unread_messages)&&void 0!==m?m:0,user:y.user},y.user.id===(null==s?void 0:s.id)&&(this.state.unreadCount=this.state.read[y.user.id].unread_messages)}}catch(e){g.e(e)}finally{g.f()}}return{messageSet:l}}},{key:"_extendEventWithOwnReactions",value:function(e){if(e.message){var t=this.state.findMessage(e.message.id,e.message.parent_id);t&&(e.message.own_reactions=t.own_reactions)}}},{key:"_hydrateMembers",value:function(e){var t=e.members,n=e.overrideCurrentState,r=void 0===n||n,s=t.reduce(function(e,t){return t.user&&(e[t.user.id]=t),e},{});r?this.state.members=s:!r&&t.length&&(this.state.members=eN(eN({},this.state.members),s))}},{key:"_disconnect",value:function(){this._client.logger("info","channel:disconnect() - Disconnecting the channel ".concat(this.cid),{tags:["connection","channel"],channel:this}),this.disconnected=!0,this.state.setIsUpToDate(!1)}}]),eo}();function eF(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var eq=function(){function e(t){var n=t.client;u()(this,e),d()(this,"client",void 0),d()(this,"users",void 0),d()(this,"userChannelReferences",void 0),this.client=n,this.users={},this.userChannelReferences={}}return h()(e,[{key:"updateUsers",value:function(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return eF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eF(e,t)}}(e))){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.updateUser(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateUser",value:function(e){null!=e&&this.client._cacheEnabled()&&(this.users[e.id]=e)}},{key:"updateUserReference",value:function(e,t){null!=e&&this.client._cacheEnabled()&&(this.updateUser(e),this.userChannelReferences[e.id]||(this.userChannelReferences[e.id]={}),this.userChannelReferences[e.id][t]=!0)}},{key:"deleteAllChannelReference",value:function(e){for(var t in this.userChannelReferences)delete this.userChannelReferences[t][e]}}]),e}();function eH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eH(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eB=function e(){u()(this,e),d()(this,"connectionStartTimestamp",void 0),d()(this,"wsConsecutiveFailures",void 0),d()(this,"wsTotalFailures",void 0),d()(this,"instanceClientId",void 0),this.connectionStartTimestamp=null,this.wsTotalFailures=0,this.wsConsecutiveFailures=0,this.instanceClientId=eo()},eW=function(){var e=o()(v().mark(function e(t,n){var r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=3,s=0;case 2:if(!(s<r)){e.next=17;break}return e.prev=3,e.next=6,C.Z.post("https://chat-insights.getstream.io/insights/".concat(t),n);case 6:e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(3),e.next=12,et((s+1)*3e3);case 12:return e.abrupt("continue",14);case 13:return e.abrupt("break",17);case 14:s++,e.next=2;break;case 17:case"end":return e.stop()}},e,null,[[3,8]])}));return function(t,n){return e.apply(this,arguments)}}();function eG(e){var t,n,r,s=e.client;return{ready_state:null===(t=e.ws)||void 0===t?void 0:t.readyState,url:e._buildUrl(),api_key:s.key,start_ts:s.insightMetrics.connectionStartTimestamp,end_ts:new Date().getTime(),auth_type:s.getAuthType(),token:s.tokenManager.token,user_id:s.userID,user_details:s._user,device:s.options.device,client_id:e.connectionID,ws_details:e.ws,ws_consecutive_failures:s.insightMetrics.wsConsecutiveFailures,ws_total_failures:s.insightMetrics.wsTotalFailures,request_id:e.requestID,online:"undefined"!=typeof navigator?null===(n=navigator)||void 0===n?void 0:n.onLine:null,user_agent:"undefined"!=typeof navigator?null===(r=navigator)||void 0===r?void 0:r.userAgent:null,instance_client_id:s.insightMetrics.instanceClientId}}function ez(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var eK=function(){var e,t,n,r;function s(e){var t=this,n=e.client;u()(this,s),d()(this,"client",void 0),d()(this,"connectionID",void 0),d()(this,"connectionOpen",void 0),d()(this,"consecutiveFailures",void 0),d()(this,"pingInterval",void 0),d()(this,"healthCheckTimeoutRef",void 0),d()(this,"isConnecting",void 0),d()(this,"isDisconnected",void 0),d()(this,"isHealthy",void 0),d()(this,"isResolved",void 0),d()(this,"lastEvent",void 0),d()(this,"connectionCheckTimeout",void 0),d()(this,"connectionCheckTimeoutRef",void 0),d()(this,"rejectPromise",void 0),d()(this,"requestID",void 0),d()(this,"resolvePromise",void 0),d()(this,"totalFailures",void 0),d()(this,"ws",void 0),d()(this,"wsID",void 0),d()(this,"_buildUrl",function(){var e=t.client._buildWSPayload(t.requestID),n=t.client.tokenManager.getToken(),r=t.client.options.wsUrlParams,s=new URLSearchParams(r);return s.set("json",e),s.set("api_key",t.client.key),s.set("authorization","".concat(n)),s.set("stream-auth-type",t.client.getAuthType()),s.set("X-Stream-Client",t.client.getUserAgent()),"".concat(t.client.wsBaseURL,"/connect?").concat(s.toString())}),d()(this,"onlineStatusChanged",function(e){"offline"===e.type?(t._log("onlineStatusChanged() - Status changing to offline"),t._setHealth(!1)):"online"!==e.type||(t._log("onlineStatusChanged() - Status changing to online. isHealthy: ".concat(t.isHealthy)),t.isHealthy||t._reconnect({interval:10}))}),d()(this,"onopen",function(e){t.wsID===e&&t._log("onopen() - onopen callback",{wsID:e})}),d()(this,"onmessage",function(e,n){if(t.wsID===e){t._log("onmessage() - onmessage callback",{event:n,wsID:e});var r,s,i="string"==typeof n.data?JSON.parse(n.data):null;if(!t.isResolved&&i){if(t.isResolved=!0,i.error){null===(s=t.rejectPromise)||void 0===s||s.call(t,t._errorFromWSEvent(i,!1));return}null===(r=t.resolvePromise)||void 0===r||r.call(t,i),t._setHealth(!0)}t.lastEvent=new Date,i&&"health.check"===i.type&&t.scheduleNextPing(),t.client.handleEvent(n),t.scheduleConnectionCheck()}}),d()(this,"onclose",function(e,n){if(t.wsID===e){if(t._log("onclose() - onclose callback - "+n.code,{event:n,wsID:e}),n.code===er.WS_CLOSED_SUCCESS){var r,s,i=Error("WS connection reject with error ".concat(n.reason));i.reason=n.reason,i.code=n.code,i.wasClean=n.wasClean,i.target=n.target,null===(s=t.rejectPromise)||void 0===s||s.call(t,i),t._log("onclose() - WS connection reject with error ".concat(n.reason),{event:n})}else t.consecutiveFailures+=1,t.totalFailures+=1,t._setHealth(!1),t.isConnecting=!1,null===(r=t.rejectPromise)||void 0===r||r.call(t,t._errorFromWSEvent(n)),t._log("onclose() - WS connection closed. Calling reconnect ...",{event:n}),t._reconnect()}}),d()(this,"onerror",function(e,n){var r;t.wsID===e&&(t.consecutiveFailures+=1,t.totalFailures+=1,t._setHealth(!1),t.isConnecting=!1,null===(r=t.rejectPromise)||void 0===r||r.call(t,t._errorFromWSEvent(n)),t._log("onerror() - WS connection resulted into error",{event:n}),t._reconnect())}),d()(this,"_setHealth",function(e){if(e!==t.isHealthy){if(t.isHealthy=e,t.isHealthy){t.client.dispatchEvent({type:"connection.changed",online:t.isHealthy});return}setTimeout(function(){t.isHealthy||t.client.dispatchEvent({type:"connection.changed",online:t.isHealthy})},5e3)}}),d()(this,"_errorFromWSEvent",function(e){var n,r,s,i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];void 0!==e.code&&(n=e.code,r="unknown",s=e.reason),void 0!==e.error&&(n=e.error.code,r=e.error.StatusCode,s=e.error.message),t._log("_errorFromWSEvent() - WS failed with code ".concat(n),{event:e},"warn");var a=Error("WS failed with code ".concat(n," and reason - ").concat(s));return a.code=n,a.StatusCode=r,a.isWSFailure=i,a}),d()(this,"_setupConnectionPromise",function(){t.isResolved=!1,t.connectionOpen=new Promise(function(e,n){t.resolvePromise=e,t.rejectPromise=n})}),d()(this,"scheduleNextPing",function(){t.healthCheckTimeoutRef&&clearTimeout(t.healthCheckTimeoutRef),t.healthCheckTimeoutRef=setTimeout(function(){var e,n=[{type:"health.check",client_id:t.client.clientID}];try{null===(e=t.ws)||void 0===e||e.send(JSON.stringify(n))}catch(e){}},t.pingInterval)}),d()(this,"scheduleConnectionCheck",function(){t.connectionCheckTimeoutRef&&clearTimeout(t.connectionCheckTimeoutRef),t.connectionCheckTimeoutRef=setTimeout(function(){var e=new Date;t.lastEvent&&e.getTime()-t.lastEvent.getTime()>t.connectionCheckTimeout&&(t._log("scheduleConnectionCheck - going to reconnect"),t._setHealth(!1),t._reconnect())},t.connectionCheckTimeout)}),this.client=n,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25e3,this.connectionCheckTimeout=this.pingInterval+1e4,this.onlineStatusChanged}return h()(s,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"connection:"+e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ez(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ez(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({tags:["connection"]},t))}},{key:"setClient",value:function(e){this.client=e}},{key:"connect",value:(e=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:15e3,!this.isConnecting){e.next=3;break}throw Error("You've called connect twice, can only attempt 1 connection at the time");case 3:return this.isDisconnected=!1,e.prev=4,e.next=7,this._connect();case 7:n=e.sent,this.consecutiveFailures=0,this._log("connect() - Established ws connection with healthcheck: ".concat(n)),e.next=23;break;case 12:if(e.prev=12,e.t0=e.catch(4),this.isHealthy=!1,this.consecutiveFailures+=1,!(e.t0.code===er.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())){e.next=21;break}this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}),e.next=23;break;case 21:if(e.t0.isWSFailure){e.next=23;break}throw Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 23:return e.next=25,this._waitForHealthy(t);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}},e,this,[[4,12]])})),function(){return e.apply(this,arguments)})},{key:"_waitForHealthy",value:(t=o()(v().mark(function e(){var t,n=this,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:15e3,e.abrupt("return",Promise.race([o()(v().mark(function e(){var r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=50,s=0;case 2:if(!(s<=t)){e.next=18;break}return e.prev=3,e.next=6,n.connectionOpen;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),s!==t){e.next=13;break}throw Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 13:return e.next=15,et(r);case 15:s+=r,e.next=2;break;case 18:case"end":return e.stop()}},e,null,[[3,9]])}))(),o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,et(t);case 2:throw n.isConnecting=!1,Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}));case 4:case"end":return e.stop()}},e)}))()]));case 2:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})},{key:"disconnect",value:function(e){var t,n=this;this._log("disconnect() - Closing the websocket connection for wsID ".concat(this.wsID)),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),this.onlineStatusChanged,this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();var r=this.ws;return r&&r.close&&r.readyState===r.OPEN?(t=new Promise(function(t){var s=function(e){n._log("disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{event:e}),t()};r.onclose=s,setTimeout(s,null!=e?e:1e3)}),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),r.close(er.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),t=Promise.resolve()),delete this.ws,t}},{key:"_connect",value:(n=o()(v().mark(function e(){var t,n,r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.isConnecting||this.isDisconnected&&this.client.options.enableWSFallback)){e.next=2;break}return e.abrupt("return");case 2:return this.isConnecting=!0,this.requestID=eo(),this.client.insightMetrics.connectionStartTimestamp=new Date().getTime(),t=!1,e.prev=6,this._log("_connect() - waiting for token"),e.next=10,this.client.tokenManager.tokenReady();case 10:t=!0,e.next=15;break;case 13:e.prev=13,e.t0=e.catch(6);case 15:if(e.prev=15,t){e.next=20;break}return this._log("_connect() - tokenProvider failed before, so going to retry"),e.next=20,this.client.tokenManager.loadToken();case 20:return this._setupConnectionPromise(),n=this._buildUrl(),this._log("_connect() - Connecting to ".concat(n),{wsURL:n,requestID:this.requestID}),this.ws=new(P())(n),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID),e.next=30,this.connectionOpen;case 30:if(r=e.sent,this.isConnecting=!1,!r){e.next=36;break}return this.connectionID=r.connection_id,this.client.insightMetrics.wsConsecutiveFailures>0&&this.client.options.enableInsights&&(eW("ws_success_after_failure",eG(this)),this.client.insightMetrics.wsConsecutiveFailures=0),e.abrupt("return",r);case 36:e.next=44;break;case 38:throw e.prev=38,e.t1=e.catch(15),this.isConnecting=!1,this._log("_connect() - Error - ",e.t1),this.client.options.enableInsights&&(this.client.insightMetrics.wsConsecutiveFailures++,this.client.insightMetrics.wsTotalFailures++,s=eV(eV({},function(e){var t={};if(!e)return t;try{Object.getOwnPropertyNames(e).forEach(function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})}catch(e){return{error:"failed to serialize the error"}}return t}(e.t1)),eG(this)),null==eW||eW("ws_fatal",s)),e.t1;case 44:case"end":return e.stop()}},e,this,[[6,13],[15,38]])})),function(){return n.apply(this,arguments)})},{key:"_reconnect",value:(r=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},this._log("_reconnect() - Initiating the reconnect"),!(this.isConnecting||this.isHealthy)){e.next=5;break}return this._log("_reconnect() - Abort (1) since already connecting or healthy"),e.abrupt("return");case 5:return(n=t.interval)||(n=ei(this.consecutiveFailures)),e.next=9,et(n);case 9:if(!(this.isConnecting||this.isHealthy)){e.next=12;break}return this._log("_reconnect() - Abort (2) since already connecting or healthy"),e.abrupt("return");case 12:if(!(this.isDisconnected&&this.client.options.enableWSFallback)){e.next=15;break}return this._log("_reconnect() - Abort (3) since disconnect() is called"),e.abrupt("return");case 15:if(this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),!t.refreshToken){e.next=20;break}return e.next=20,this.client.tokenManager.loadToken();case 20:return e.prev=20,e.next=23,this._connect();case 23:return this._log("_reconnect() - Waiting for recoverCallBack"),e.next=26,this.client.recoverState();case 26:this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0,e.next=38;break;case 30:if(e.prev=30,e.t0=e.catch(20),this.isHealthy=!1,this.consecutiveFailures+=1,!(e.t0.code===er.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())){e.next=37;break}return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),e.abrupt("return",this._reconnect({refreshToken:!0}));case 37:e.t0.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect());case 38:this._log("_reconnect() - == END ==");case 39:case"end":return e.stop()}},e,this,[[20,30]])})),function(){return r.apply(this,arguments)})},{key:"_destroyCurrentWSConnection",value:function(){this.wsID+=1;try{var e,t;this===null||void 0===this||null===(e=this.ws)||void 0===e||e.removeAllListeners(),this===null||void 0===this||null===(t=this.ws)||void 0===t||t.close()}catch(e){}}}]),s}();function eX(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof t)throw TypeError("userId should be a string");var s=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eX(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eX(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({user_id:t},n);if(null==T()||null==T().sign)throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.");var i=b()({algorithm:"HS256",noTimestamp:!0},r);return s.iat&&(i.noTimestamp=!1),T().sign(s,e,i)}function eY(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=b()({algorithm:"HS256",noTimestamp:!0},t);return T().sign({server:!0},e,n)}var eQ=function e(t){var n,r=this;u()(this,e),d()(this,"loadTokenPromise",void 0),d()(this,"type",void 0),d()(this,"secret",void 0),d()(this,"token",void 0),d()(this,"tokenProvider",void 0),d()(this,"user",void 0),d()(this,"setTokenOrProvider",(n=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.validateToken(t,n),r.user=n,en(t)&&(r.tokenProvider=t,r.type="provider"),"string"==typeof t&&(r.token=t,r.type="static"),!t&&r.user&&r.secret&&(r.token=eJ(r.secret,n.id,{},{}),r.type="static"),e.next=7,r.loadToken();case 7:case"end":return e.stop()}},e)})),function(e,t){return n.apply(this,arguments)})),d()(this,"reset",function(){r.token=void 0,r.tokenProvider=void 0,r.type="static",r.user=void 0,r.loadTokenPromise=null}),d()(this,"validateToken",function(e,t){if(!t||!t.anon||e){if(!r.secret&&!e)throw Error("User token can not be empty");if(e&&"string"!=typeof e&&!en(e))throw Error("user token should either be a string or a function");if("string"==typeof e){if(t.anon&&""===e)return;var n,s=3!==(n=e.split(".")).length?"":JSON.parse(K(n[1])).user_id;if(null!=e&&(null==s||""===s||s!==t.id))throw Error("userToken does not have a user_id or is not matching with user.id")}}}),d()(this,"tokenReady",function(){return r.loadTokenPromise}),d()(this,"loadToken",function(){var e;return r.loadTokenPromise=new Promise((e=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("static"!==r.type){e.next=2;break}return e.abrupt("return",t(r.token));case 2:if(!(r.tokenProvider&&"string"!=typeof r.tokenProvider)){e.next=13;break}return e.prev=3,e.next=6,r.tokenProvider();case 6:r.token=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",n(Error("Call to tokenProvider failed with message: ".concat(e.t0))));case 12:t(r.token);case 13:case"end":return e.stop()}},e,null,[[3,9]])})),function(t,n){return e.apply(this,arguments)})),r.loadTokenPromise}),d()(this,"getToken",function(){if(r.token||r.user&&r.user.anon&&!r.token)return r.token;if(r.secret)return eY(r.secret);throw Error("Both secret and user tokens are not set. Either client.connectUser wasn't called or client.disconnect was called")}),d()(this,"isStatic",function(){return"static"===r.type}),this.loadTokenPromise=null,t&&(this.secret=t),this.type="static",this.secret&&(this.token=eY(this.secret))},eZ={"-1":{name:"InternalSystemError",retryable:!0},2:{name:"AccessKeyError",retryable:!1},3:{name:"AuthenticationFailedError",retryable:!0},4:{name:"InputError",retryable:!1},6:{name:"DuplicateUsernameError",retryable:!1},9:{name:"RateLimitError",retryable:!0},16:{name:"DoesNotExistError",retryable:!1},17:{name:"NotAllowedError",retryable:!1},18:{name:"EventNotSupportedError",retryable:!1},19:{name:"ChannelFeatureNotSupportedError",retryable:!1},20:{name:"MessageTooLongError",retryable:!1},21:{name:"MultipleNestingLevelError",retryable:!1},22:{name:"PayloadTooBigError",retryable:!1},23:{name:"RequestTimeoutError",retryable:!0},24:{name:"MaxHeaderSizeExceededError",retryable:!1},40:{name:"AuthErrorTokenExpired",retryable:!1},41:{name:"AuthErrorTokenNotValidYet",retryable:!1},42:{name:"AuthErrorTokenUsedBeforeIssuedAt",retryable:!1},43:{name:"AuthErrorTokenSignatureInvalid",retryable:!1},44:{name:"CustomCommandEndpointMissingError",retryable:!1},45:{name:"CustomCommandEndpointCallError",retryable:!0},46:{name:"ConnectionIDNotFoundError",retryable:!1},60:{name:"CoolDownError",retryable:!0},69:{name:"ErrWrongRegion",retryable:!1},70:{name:"ErrQueryChannelPermissions",retryable:!1},71:{name:"ErrTooManyConnections",retryable:!0},99:{name:"AppSuspendedError",retryable:!1}};function e0(e){if(!e.code)return!1;var t=eZ["".concat(e.code)];return!!t&&t.retryable}function e1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e1(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e1(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}!function(e){e.Closed="CLOSED",e.Connected="CONNECTED",e.Connecting="CONNECTING",e.Disconnected="DISCONNECTED",e.Init="INIT"}(r||(r={}));var e3=function(){function e(t){var n,s=this,i=t.client;u()(this,e),d()(this,"client",void 0),d()(this,"state",void 0),d()(this,"consecutiveFailures",void 0),d()(this,"connectionID",void 0),d()(this,"cancelToken",void 0),d()(this,"_onlineStatusChanged",function(e){if(s._log("_onlineStatusChanged() - ".concat(e.type)),"offline"===e.type){var t;s._setState(r.Closed),null===(t=s.cancelToken)||void 0===t||t.cancel("disconnect() is called"),s.cancelToken=void 0;return}"online"===e.type&&s.state===r.Closed&&s.connect(!0)}),d()(this,"_req",(n=o()(v().mark(function e(t,n,r){var i,a;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s.cancelToken||t.close||(s.cancelToken=C.Z.CancelToken.source()),e.prev=1,e.next=4,s.client.doAxiosRequest("get",s.client.baseURL.replace(":3030",":8900")+"/longpoll",void 0,{config:e2(e2({},n),{},{cancelToken:null===(i=s.cancelToken)||void 0===i?void 0:i.token}),params:t});case 4:return a=e.sent,s.consecutiveFailures=0,e.abrupt("return",a);case 9:if(e.prev=9,e.t0=e.catch(1),s.consecutiveFailures+=1,!(r&&e0(e.t0))){e.next=17;break}return s._log("_req() - Retryable error, retrying request"),e.next=16,et(ei(s.consecutiveFailures));case 16:return e.abrupt("return",s._req(t,n,r));case 17:throw e.t0;case 18:case"end":return e.stop()}},e,null,[[1,9]])})),function(e,t,r){return n.apply(this,arguments)})),d()(this,"_poll",o()(v().mark(function e(){var t,n,i;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.state!==r.Connected){e.next=25;break}return e.prev=1,e.next=4,s._req({},{timeout:3e4},!0);case 4:if(null!==(t=(n=e.sent).events)&&void 0!==t&&t.length)for(i=0;i<n.events.length;i++)s.client.dispatchEvent(n.events[i]);e.next=23;break;case 8:if(e.prev=8,e.t0=e.catch(1),!C.Z.isCancel(e.t0)){e.next=13;break}return s._log("_poll() - axios canceled request"),e.abrupt("return");case 13:if(46!==e.t0.code){e.next=18;break}return s._log("_poll() - ConnectionID error, connecting without ID..."),s._setState(r.Disconnected),s.connect(!0),e.abrupt("return");case 18:if(!(void 0!==e.t0.code&&!e0(e.t0))){e.next=21;break}return s._setState(r.Closed),e.abrupt("return");case 21:return e.next=23,et(ei(s.consecutiveFailures));case 23:e.next=0;break;case 25:case"end":return e.stop()}},e,null,[[1,8]])}))),d()(this,"connect",o()(v().mark(function e(){var t,n,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],s.state!==r.Connecting){e.next=4;break}return s._log("connect() - connecting already in progress",{reconnect:t},"warn"),e.abrupt("return");case 4:if(s.state!==r.Connected){e.next=7;break}return s._log("connect() - already connected and polling",{reconnect:t},"warn"),e.abrupt("return");case 7:return s._setState(r.Connecting),s.connectionID=void 0,e.prev=9,e.next=12,s._req({json:s.client._buildWSPayload()},{timeout:8e3},t);case 12:return n=e.sent.event,s._setState(r.Connected),s.connectionID=n.connection_id,s.client.dispatchEvent(n),s._poll(),t&&s.client.recoverState(),e.abrupt("return",n);case 22:throw e.prev=22,e.t0=e.catch(9),s._setState(r.Closed),e.t0;case 26:case"end":return e.stop()}},e,null,[[9,22]])}))),d()(this,"isHealthy",function(){return!!s.connectionID&&s.state===r.Connected}),d()(this,"disconnect",o()(v().mark(function e(){var t,n,i,a=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>0&&void 0!==a[0]?a[0]:2e3,s._onlineStatusChanged,s._setState(r.Disconnected),null===(t=s.cancelToken)||void 0===t||t.cancel("disconnect() is called"),s.cancelToken=void 0,i=s.connectionID,s.connectionID=void 0,e.prev=7,e.next=10,s._req({close:!0,connection_id:i},{timeout:n},!1);case 10:s._log("disconnect() - Closed connectionID"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),s._log("disconnect() - Failed",{err:e.t0},"error");case 16:case"end":return e.stop()}},e,null,[[7,13]])}))),this.client=i,this.state=r.Init,this.consecutiveFailures=0,this._onlineStatusChanged}return h()(e,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"WSConnectionFallback:"+e,e2({tags:["connection_fallback","connection"]},t))}},{key:"_setState",value:function(e){this._log("_setState() - ".concat(e)),this.state===r.Connecting&&e===r.Connected&&this.client.dispatchEvent({type:"connection.changed",online:!0}),(e===r.Closed||e===r.Disconnected)&&this.client.dispatchEvent({type:"connection.changed",online:!1}),this.state=e}}]),e}(),e4=function(){var e,t,n,r,s,i,a,c;function l(e,t,n,r){u()(this,l),d()(this,"type",void 0),d()(this,"id",void 0),d()(this,"client",void 0),d()(this,"data",void 0),this.client=e,this.type=t,this.id=n,this.data=r}return h()(l,[{key:"create",value:(e=o()(v().mark(function e(){var t,n,r,s,i,a;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:null===(t=this.data)||void 0===t?void 0:t.name,filter:null===(n=this.data)||void 0===n?void 0:n.filter,description:null===(r=this.data)||void 0===r?void 0:r.description,all_sender_channels:null===(s=this.data)||void 0===s?void 0:s.all_sender_channels,all_users:null===(i=this.data)||void 0===i?void 0:i.all_users},e.abrupt("return",this.client.createSegment(this.type,this.id,a));case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"verifySegmentId",value:function(){if(!this.id)throw Error("Segment id is missing. Either create the segment using segment.create() or set the id during instantiation - const segment = client.segment(id)")}},{key:"get",value:(t=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.getSegment(this.id));case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"update",value:(n=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.updateSegment(this.id,t));case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"addTargets",value:(r=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.addSegmentTargets(this.id,t));case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"removeTargets",value:(s=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.removeSegmentTargets(this.id,t));case 2:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"delete",value:(i=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.deleteSegment(this.id));case 2:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"targetExists",value:(a=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.segmentTargetExists(this.id,t));case 2:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"queryTargets",value:(c=o()(v().mark(function e(){var t,n,r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},this.verifySegmentId(),e.abrupt("return",this.client.querySegmentTargets(this.id,t,n,r));case 5:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})}]),l}(),e5=function(e){F()(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=B()(r);if(t){var s=B()(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return H()(this,e)});function r(){var e;u()(this,r);for(var t=arguments.length,s=Array(t),i=0;i<t;i++)s[i]=arguments[i];return e=n.call.apply(n,[this].concat(s)),d()(N()(e),"code",void 0),d()(N()(e),"response",void 0),d()(N()(e),"status",void 0),e}return r}(G()(Error));function e8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e8(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e8(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}!function(e){e.anonymous="anonymous",e.public="public"}(s||(s={}));var e7=function(e){return"function"==typeof e},e6=function e(t){var n=this;u()(this,e),this.value=t,d()(this,"handlerSet",new Set),d()(this,"next",function(e){var t=e7(e)?e(n.value):e;if(t!==n.value){var r=n.value;n.value=t,n.handlerSet.forEach(function(e){return e(n.value,r)})}}),d()(this,"partialNext",function(e){return n.next(function(t){return e9(e9({},t),e)})}),d()(this,"getLatestValue",function(){return n.value}),d()(this,"subscribe",function(e){return e(n.value,void 0),n.handlerSet.add(e),function(){n.handlerSet.delete(e)}}),d()(this,"subscribeWithSelector",function(t,r){var s;return n.subscribe(function(n){var i=t(n),a=!s;for(var o in Array.isArray(i)&&e.logCount>0&&(console.warn("[StreamChat]: The API of our StateStore has changed. Instead of returning an array in the selector, please return a named object of properties."),e.logCount--),s)if(s[o]!==i[o]){a=!0;break}if(a){var c=s;s=i,r(i,c)}})})};d()(e6,"logCount",5);var te=["limit","sort"];function tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tr=[{created_at:-1}],ts={channel:!0,channel_cid:!0,created_at:!0,created_by_user_id:!0,parent_message_id:!0,title:!0,updated_at:!0,latest_replies:!0,active_participant_count:!0,deleted_at:!0,last_message_at:!0,participant_count:!0,reply_count:!0,read:!0,thread_participants:!0,created_by:!0,parent_message:!0},ti=function(e){var t={};for(var n in e)ts[n]||(t[n]=e[n]);return t},ta=function(){function e(t){var n,r,s,i=this,a=t.client,c=t.threadData;u()(this,e),d()(this,"state",void 0),d()(this,"id",void 0),d()(this,"client",void 0),d()(this,"unsubscribeFunctions",new Set),d()(this,"failedRepliesMap",new Map),d()(this,"activate",function(){i.state.partialNext({active:!0})}),d()(this,"deactivate",function(){i.state.partialNext({active:!1})}),d()(this,"reload",o()(v().mark(function e(){var t;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.state.getLatestValue().isLoading){e.next=2;break}return e.abrupt("return");case 2:return i.state.partialNext({isLoading:!0}),e.prev=3,e.next=6,i.client.getThread(i.id,{watch:!0});case 6:t=e.sent,i.hydrateState(t);case 8:return e.prev=8,i.state.partialNext({isLoading:!1}),e.finish(8);case 11:case"end":return e.stop()}},e,null,[[3,,8,11]])}))),d()(this,"hydrateState",function(e){if(e!==i){if(e.id!==i.id)throw Error("Cannot hydrate thread state with using thread's state");var t=e.state.getLatestValue(),n=t.read,r=t.replyCount,s=t.replies,a=t.parentMessage,o=t.participants,c=t.createdAt,u=t.deletedAt,l=t.updatedAt,h=Array.from(i.failedRepliesMap.values());i.state.partialNext({read:n,replyCount:r,replies:h.length?s.concat(h):s,parentMessage:a,participants:o,createdAt:c,deletedAt:u,updatedAt:l,isStateStale:!1})}}),d()(this,"registerSubscriptions",function(){i.unsubscribeFunctions.size||(i.unsubscribeFunctions.add(i.subscribeThreadUpdated()),i.unsubscribeFunctions.add(i.subscribeMarkActiveThreadRead()),i.unsubscribeFunctions.add(i.subscribeReloadActiveStaleThread()),i.unsubscribeFunctions.add(i.subscribeMarkThreadStale()),i.unsubscribeFunctions.add(i.subscribeNewReplies()),i.unsubscribeFunctions.add(i.subscribeRepliesRead()),i.unsubscribeFunctions.add(i.subscribeMessageDeleted()),i.unsubscribeFunctions.add(i.subscribeMessageUpdated()))}),d()(this,"subscribeThreadUpdated",function(){return i.client.on("thread.updated",function(e){if(e.thread&&e.thread.parent_message_id===i.id){var t=e.thread;i.state.partialNext({title:t.title,updatedAt:new Date(t.updated_at),deletedAt:t.deleted_at?new Date(t.deleted_at):null,custom:ti(t)})}}).unsubscribe}),d()(this,"subscribeMarkActiveThreadRead",function(){return i.state.subscribeWithSelector(function(e){return{active:e.active,unreadMessageCount:tu(i.client.userID)(e)}},function(e){var t=e.active,n=e.unreadMessageCount;t&&n&&i.throttledMarkAsRead()})}),d()(this,"subscribeReloadActiveStaleThread",function(){return i.state.subscribeWithSelector(function(e){return{active:e.active,isStateStale:e.isStateStale}},function(e){var t=e.active,n=e.isStateStale;t&&n&&i.reload()})}),d()(this,"subscribeMarkThreadStale",function(){return i.client.on("user.watching.stop",function(e){var t,n,r=i.state.getLatestValue().channel;i.client.userID&&i.client.userID===(null===(t=e.user)||void 0===t?void 0:t.id)&&(null===(n=e.channel)||void 0===n?void 0:n.cid)===r.cid&&i.state.partialNext({isStateStale:!0})}).unsubscribe}),d()(this,"subscribeNewReplies",function(){return i.client.on("message.new",function(e){if(i.client.userID&&(null===(h=e.message)||void 0===h?void 0:h.parent_id)===i.id){var t=(null===(p=e.message.user)||void 0===p?void 0:p.id)===i.client.userID,n=i.state.getLatestValue(),r=n.active,s=n.read;i.upsertReplyLocally({message:e.message,timestampChanged:t}),r&&i.throttledMarkAsRead();for(var a={},o=0,c=Object.keys(s);o<c.length;o++){var u=c[o],l=s[u];if(l){var h,p,d,f=l;u===(null===(d=e.user)||void 0===d?void 0:d.id)?f=tn(tn({},f),{},{lastReadAt:e.created_at?new Date(e.created_at):new Date,user:e.user,unreadMessageCount:0}):r&&u===i.client.userID||(f=tn(tn({},f),{},{unreadMessageCount:l.unreadMessageCount+1})),a[u]=f}}i.state.partialNext({read:a})}}).unsubscribe}),d()(this,"subscribeRepliesRead",function(){return i.client.on("message.read",function(e){if(e.user&&e.created_at&&e.thread&&e.thread.parent_message_id===i.id){var t=e.user.id,n=e.created_at,r=e.user;i.state.next(function(s){return tn(tn({},s),{},{read:tn(tn({},s.read),{},d()({},t,{lastReadAt:new Date(n),user:r,lastReadMessageId:e.last_read_message_id,unreadMessageCount:0}))})})}}).unsubscribe}),d()(this,"subscribeMessageDeleted",function(){return i.client.on("message.deleted",function(e){e.message&&(e.message.parent_id===i.id&&(e.hard_delete?i.deleteReplyLocally({message:e.message}):i.upsertReplyLocally({message:e.message})),e.message.id===i.id&&i.updateParentMessageLocally({message:e.message}))}).unsubscribe}),d()(this,"subscribeMessageUpdated",function(){var e=["message.updated","reaction.new","reaction.deleted","reaction.updated"].map(function(e){return i.client.on(e,function(e){e.message&&i.updateParentMessageOrReplyLocally(e.message)}).unsubscribe});return function(){return e.forEach(function(e){return e()})}}),d()(this,"unregisterSubscriptions",function(){i.unsubscribeFunctions.forEach(function(e){return e()}),i.unsubscribeFunctions.clear()}),d()(this,"deleteReplyLocally",function(e){var t,n=e.message,r=i.state.getLatestValue().replies,s=ep({needle:eh(n),sortedArray:r,sortDirection:"ascending",selectValueToCompare:function(e){return e.created_at.getTime()},selectKey:function(e){return e.id}});if((null===(t=r[s])||void 0===t?void 0:t.id)===n.id){var a=E()(r);a.splice(s,1),i.state.partialNext({replies:a})}}),d()(this,"upsertReplyLocally",function(e){var t=e.message,n=e.timestampChanged,r=void 0!==n&&n;if(t.parent_id!==i.id)throw Error("Reply does not belong to this thread");var s=eh(t);"failed"===t.status?i.failedRepliesMap.set(s.id,s):i.failedRepliesMap.has(t.id)&&i.failedRepliesMap.delete(t.id),i.state.next(function(e){return tn(tn({},e),{},{replies:ed(e.replies,s,r)})})}),d()(this,"updateParentMessageLocally",function(e){var t=e.message;if(t.id!==i.id)throw Error("Message does not belong to this thread");i.state.next(function(e){var n,r=eh(t);return tn(tn({},e),{},{deletedAt:r.deleted_at,parentMessage:r,replyCount:null!==(n=t.reply_count)&&void 0!==n?n:e.replyCount})})}),d()(this,"updateParentMessageOrReplyLocally",function(e){e.parent_id===i.id&&i.upsertReplyLocally({message:e}),e.parent_id||e.id!==i.id||i.updateParentMessageLocally({message:e})}),d()(this,"markAsRead",o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0!==(t=(r.length>0&&void 0!==r[0]?r[0]:{}).force)&&t,!(0===i.ownUnreadCount&&!n)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,i.channel.markRead({thread_id:i.id});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))),d()(this,"throttledMarkAsRead",ef(function(){return i.markAsRead()},1e3,{trailing:!0})),d()(this,"queryReplies",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=e.sort,r=void 0===n?tr:n,s=k()(e,te);return i.channel.getReplies(i.id,tn({limit:void 0===t?50:t},s),r)}),d()(this,"loadNextPage",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit;return i.loadPage(void 0===t?50:t)}),d()(this,"loadPrevPage",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit;return i.loadPage(-(void 0===t?50:t))}),d()(this,"loadPage",(n=o()(v().mark(function e(t){var n,r,s,a,o,c,u,l,h,p,f,g,y;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.state.getLatestValue().pagination,r=t>0?["isLoadingNext","nextCursor","push"]:["isLoadingPrev","prevCursor","unshift"],a=(s=m()(r,3))[0],o=s[1],c=s[2],!(n[a]||null===n[o])){e.next=4;break}return e.abrupt("return");case 4:return u=d()({},t>0?"id_gt":"id_lt",n[o]),l=Math.abs(t),i.state.partialNext({pagination:tn(tn({},n),{},d()({},a,!0))}),e.prev=7,e.next=10,i.queryReplies(tn(tn({},u),{},{limit:l}));case 10:y=null!==(h=null===(p=(g=(f=e.sent).messages.map(eh)).at(t>0?-1:0))||void 0===p?void 0:p.id)&&void 0!==h?h:null,i.state.next(function(e){var t,n,r=e.replies;return g.length>0&&(n=r=E()(e.replies))[c].apply(n,E()(g)),tn(tn({},e),{},{replies:r,pagination:tn(tn({},e.pagination),{},(t={},d()(t,o,f.messages.length<l?null:y),d()(t,a,!1),t))})}),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),i.client.logger("error",e.t0.message),i.state.next(function(e){return tn(tn({},e),{},{pagination:tn(tn({},e.pagination),{},d()({},a,!1))})});case 20:case"end":return e.stop()}},e,null,[[7,16]])})),function(e){return n.apply(this,arguments)}));var l=a.channel(c.channel.type,c.channel.id,{name:c.channel.name});l._hydrateMembers({members:null!==(r=c.channel.members)&&void 0!==r?r:[],overrideCurrentState:!1});var h=a.userID?[{user:{id:a.userID},unread_messages:0,last_read:new Date().toISOString()}]:[];this.state=new e6({active:!1,isLoading:!1,isStateStale:!1,channel:l,createdAt:new Date(c.created_at),deletedAt:c.deleted_at?new Date(c.deleted_at):null,pagination:tc(c),parentMessage:eh(c.parent_message),participants:c.thread_participants,read:to(c.read&&0!==c.read.length?c.read:h),replies:c.latest_replies.map(eh),replyCount:null!==(s=c.reply_count)&&void 0!==s?s:0,updatedAt:c.updated_at?new Date(c.updated_at):null,title:c.title,custom:ti(c)}),this.id=c.parent_message_id,this.client=a}return h()(e,[{key:"channel",get:function(){return this.state.getLatestValue().channel}},{key:"hasStaleState",get:function(){return this.state.getLatestValue().isStateStale}},{key:"ownUnreadCount",get:function(){return tu(this.client.userID)(this.state.getLatestValue())}}]),e}(),to=function(e){return e.reduce(function(e,t){var n;return e[t.user.id]={user:t.user,lastReadMessageId:t.last_read_message_id,unreadMessageCount:null!==(n=t.unread_messages)&&void 0!==n?n:0,lastReadAt:new Date(t.last_read)},e},{})},tc=function(e){var t,n;return{nextCursor:null,prevCursor:e.latest_replies.length===e.reply_count?null:null!==(t=null===(n=e.latest_replies.at(0))||void 0===n?void 0:n.id)&&void 0!==t?t:null,isLoadingNext:!1,isLoadingPrev:!1}},tu=function(e){return function(t){var n;return e&&(null===(n=t.read[e])||void 0===n?void 0:n.unreadMessageCount)||0}};function tl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function th(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tl(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tl(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tp={user:"stream:user",message:"stream:chat:v1:message",userprofile:"stream:v1:user_profile"},td=function(){var e,t,n,r,s,i,a,c,l,p,f,g,m,y,b,w;function _(e){u()(this,_),d()(this,"client",void 0),this.client=e}return h()(_,[{key:"flagUser",value:(e=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.abrupt("return",this.flag(tp.user,t,"",n,r));case 2:case"end":return e.stop()}},e,this)})),function(t,n){return e.apply(this,arguments)})},{key:"flagMessage",value:(t=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.abrupt("return",this.flag(tp.message,t,"",n,r));case 2:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"flag",value:(n=o()(v().mark(function e(t,n,r,s){var i,a=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>4&&void 0!==a[4]?a[4]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/flag",th({entity_type:t,entity_id:n,entity_creator_id:r,reason:s},i));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t,r,s){return n.apply(this,arguments)})},{key:"muteUser",value:(r=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/mute",th({target_ids:[t]},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"unmuteUser",value:(s=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/unmute",th({target_ids:[t]},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getUserModerationReport",value:(i=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.get(this.client.baseURL+"/api/v2/moderation/user_report",th({user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"queryReviewQueue",value:(a=o()(v().mark(function e(){var t,n,r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.client.post(this.client.baseURL+"/api/v2/moderation/review_queue",th({filter:t,sort:es(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"upsertConfig",value:(c=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/config",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"getConfig",value:(l=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(this.client.baseURL+"/api/v2/moderation/config/"+t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"deleteConfig",value:(p=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.delete(this.client.baseURL+"/api/v2/moderation/config/"+t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"queryConfigs",value:(f=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/configs",th({filter:t,sort:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"submitAction",value:(g=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/submit_action",th({action_type:t,item_id:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"check",value:(m=o()(v().mark(function e(t,n,r,s,i,a){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/check",{entity_type:t,entity_id:n,entity_creator_id:r,moderation_payload:s,config_key:i,options:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n,r,s,i){return m.apply(this,arguments)})},{key:"checkUserProfile",value:(y=o()(v().mark(function e(t,n){var r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!n.username&&!n.image)){e.next=2;break}throw Error("Either username or image must be provided");case 2:return r={},n.username&&(r.texts=[n.username]),n.image&&(r.images=[n.image]),e.next=7,this.check(tp.userprofile,t,t,r,"user_profile:default",{force_sync:!0,test_mode:!0});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return y.apply(this,arguments)})},{key:"addCustomFlags",value:(b=o()(v().mark(function e(t,n,r,s,i){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/custom_check",{entity_type:t,entity_id:n,entity_creator_id:r,moderation_payload:s,flags:i});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n,r,s){return b.apply(this,arguments)})},{key:"addCustomMessageFlags",value:(w=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addCustomFlags(tp.message,t,"",{},n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})}]),_}();function tf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function tv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tv(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tv(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tm={active:!1,isThreadOrderStale:!1,threads:[],unreadThreadCount:0,unseenThreadIds:[],lastConnectionDropAt:null,pagination:{isLoading:!1,isLoadingNext:!1,nextCursor:null},ready:!1},ty=function(){function e(t){var n=this,r=t.client;u()(this,e),d()(this,"state",void 0),d()(this,"client",void 0),d()(this,"unsubscribeFunctions",new Set),d()(this,"threadsByIdGetterCache",void 0),d()(this,"resetState",function(){n.state.next(tm)}),d()(this,"activate",function(){n.state.partialNext({active:!0})}),d()(this,"deactivate",function(){n.state.partialNext({active:!1})}),d()(this,"registerSubscriptions",function(){n.unsubscribeFunctions.size||(n.unsubscribeFunctions.add(n.subscribeUnreadThreadsCountChange()),n.unsubscribeFunctions.add(n.subscribeManageThreadSubscriptions()),n.unsubscribeFunctions.add(n.subscribeReloadOnActivation()),n.unsubscribeFunctions.add(n.subscribeNewReplies()),n.unsubscribeFunctions.add(n.subscribeRecoverAfterConnectionDrop()),n.unsubscribeFunctions.add(n.subscribeChannelDeleted()))}),d()(this,"subscribeUnreadThreadsCountChange",function(){var e,t=(null!==(e=n.client.user)&&void 0!==e?e:{}).unread_threads;n.state.partialNext({unreadThreadCount:void 0===t?0:t});var r=["health.check","notification.mark_read","notification.thread_message_new","notification.channel_deleted"].map(function(e){return n.client.on(e,function(e){var t,r=(null!==(t=e.me)&&void 0!==t?t:e).unread_threads;"number"==typeof r&&n.state.partialNext({unreadThreadCount:r})}).unsubscribe});return function(){return r.forEach(function(e){return e()})}}),d()(this,"subscribeChannelDeleted",function(){return n.client.on("notification.channel_deleted",function(e){var t=e.cid,r=n.state.getLatestValue().threads.filter(function(e){return e.channel.cid!==t});n.state.partialNext({threads:r})}).unsubscribe}),d()(this,"subscribeManageThreadSubscriptions",function(){return n.state.subscribeWithSelector(function(e){return{threads:e.threads}},function(e,t){var r=e.threads,s=(null!=t?t:{}).threads,i=(void 0===s?[]:s).filter(function(e){return e!==n.threadsById[e.id]});r.forEach(function(e){return e.registerSubscriptions()}),i.forEach(function(e){return e.unregisterSubscriptions()})})}),d()(this,"subscribeReloadOnActivation",function(){return n.state.subscribeWithSelector(function(e){return{active:e.active}},function(e){e.active&&n.reload()})}),d()(this,"subscribeNewReplies",function(){return n.client.on("notification.thread_message_new",function(e){var t,r=null===(t=e.message)||void 0===t?void 0:t.parent_id;if(r){var s=n.state.getLatestValue(),i=s.unseenThreadIds;s.ready&&(n.threadsById[r]?n.state.partialNext({isThreadOrderStale:!0}):i.includes(r)||n.state.partialNext({unseenThreadIds:i.concat(r)}))}}).unsubscribe}),d()(this,"subscribeRecoverAfterConnectionDrop",function(){var e=n.client.on("connection.changed",function(e){!1===e.online&&n.state.next(function(e){return e.lastConnectionDropAt?e:tg(tg({},e),{},{lastConnectionDropAt:new Date})})}).unsubscribe,t=ef(function(){n.state.getLatestValue().lastConnectionDropAt&&n.reload({force:!0})},1e3,{trailing:!0}),r=n.client.on("connection.recovered",t).unsubscribe;return function(){e(),r()}}),d()(this,"unregisterSubscriptions",function(){n.state.getLatestValue().threads.forEach(function(e){return e.unregisterSubscriptions()}),n.unsubscribeFunctions.forEach(function(e){return e()}),n.unsubscribeFunctions.clear()}),d()(this,"reload",o()(v().mark(function e(){var t,r,s,i,a,o,c,u,l,h,p,d,f,g,m,y,b=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0!==(t=(b.length>0&&void 0!==b[0]?b[0]:{}).force)&&t,i=(s=n.state.getLatestValue()).threads,a=s.unseenThreadIds,o=s.isThreadOrderStale,c=s.pagination,u=s.ready,!c.isLoading){e.next=4;break}return e.abrupt("return");case 4:if(!(!r&&u&&!a.length&&!o)){e.next=6;break}return e.abrupt("return");case 6:return l=i.length+a.length,e.prev=7,n.state.next(function(e){return tg(tg({},e),{},{pagination:tg(tg({},e.pagination),{},{isLoading:!0})})}),e.next=11,n.queryThreads({limit:Math.min(l,25)||25});case 11:h=e.sent,p=n.threadsById,d=[],f=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return tf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tf(e,t)}}(e))){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}(h.threads);try{for(f.s();!(g=f.n()).done;)(y=p[(m=g.value).id])?(d.push(y),y.hasStaleState&&y.hydrateState(m)):d.push(m)}catch(e){f.e(e)}finally{f.f()}n.state.next(function(e){var t;return tg(tg({},e),{},{threads:d,unseenThreadIds:[],isThreadOrderStale:!1,pagination:tg(tg({},e.pagination),{},{isLoading:!1,nextCursor:null!==(t=h.next)&&void 0!==t?t:null}),ready:!0})}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),n.client.logger("error",e.t0.message),n.state.next(function(e){return tg(tg({},e),{},{pagination:tg(tg({},e.pagination),{},{isLoading:!1})})});case 23:case"end":return e.stop()}},e,null,[[7,19]])}))),d()(this,"queryThreads",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.client.queryThreads(tg({limit:25,participant_limit:10,reply_limit:10,watch:!0},e))}),d()(this,"loadNextPage",o()(v().mark(function e(){var t,r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},!((r=n.state.getLatestValue().pagination).isLoadingNext||!r.nextCursor)){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,n.state.partialNext({pagination:tg(tg({},r),{},{isLoadingNext:!0})}),e.next=8,n.queryThreads(tg(tg({},t),{},{next:r.nextCursor}));case 8:s=e.sent,n.state.next(function(e){var t;return tg(tg({},e),{},{threads:s.threads.length?e.threads.concat(s.threads):e.threads,pagination:tg(tg({},e.pagination),{},{nextCursor:null!==(t=s.next)&&void 0!==t?t:null,isLoadingNext:!1})})}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),n.client.logger("error",e.t0.message),n.state.next(function(e){return tg(tg({},e),{},{pagination:tg(tg({},e.pagination),{},{isLoadingNext:!1})})});case 16:case"end":return e.stop()}},e,null,[[4,12]])}))),this.client=r,this.state=new e6(tm),this.threadsByIdGetterCache={threads:[],threadsById:{}}}return h()(e,[{key:"threadsById",get:function(){var e=this.state.getLatestValue().threads;if(e===this.threadsByIdGetterCache.threads)return this.threadsByIdGetterCache.threadsById;var t=e.reduce(function(e,t){return e[t.id]=t,e},{});return this.threadsByIdGetterCache.threads=e,this.threadsByIdGetterCache.threadsById=t,t}}]),e}(),tb=["own_votes","id"],tw=["id"];function t_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?t_(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tk=function(e){return!!(null!=e&&e.answer_text)},tS=function(){function e(t){var n,r,s,i,a,c,l,h,p,f,g,y,b=this,w=t.client,_=t.poll;u()(this,e),d()(this,"state",void 0),d()(this,"id",void 0),d()(this,"client",void 0),d()(this,"unsubscribeFunctions",new Set),d()(this,"getInitialStateFromPollResponse",function(e){var t,n=e.own_votes;e.id;var r=k()(e,tb),s=null!==(t=null==n?void 0:n.reduce(function(e,t){return tk(t)?e.ownAnswer=t:e.ownVotes.push(t),e},{ownVotes:[]}))&&void 0!==t?t:{ownVotes:[]},i=s.ownAnswer,a=s.ownVotes;return tx(tx({},r),{},{lastActivityAt:new Date,maxVotedOptionIds:tE(r.vote_counts_by_option),ownAnswer:i,ownVotesByOptionId:a?a.reduce(function(e,t){return tk(t)||!t.option_id||(e[t.option_id]=t),e},{}):{}})}),d()(this,"reinitializeState",function(e){b.state.partialNext(b.getInitialStateFromPollResponse(e))}),d()(this,"handlePollUpdated",function(e){if((null===(n=e.poll)||void 0===n||!n.id||e.poll.id===b.id)&&"poll.updated"===e.type){var t,n,r={allow_answers:(t=e.poll).allow_answers,allow_user_suggested_options:t.allow_user_suggested_options,description:t.description,enforce_unique_vote:t.enforce_unique_vote,id:t.id,is_closed:t.is_closed,max_votes_allowed:t.max_votes_allowed,name:t.name,options:t.options,voting_visibility:t.voting_visibility},s=k()(r,tw);b.state.partialNext(tx(tx({},s),{},{lastActivityAt:new Date(e.created_at)}))}}),d()(this,"handlePollClosed",function(e){var t;null!==(t=e.poll)&&void 0!==t&&t.id&&e.poll.id!==b.id||"poll.closed"!==e.type||b.state.partialNext({is_closed:!0,lastActivityAt:new Date(e.created_at)})}),d()(this,"handleVoteCasted",function(e){if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===b.id)&&"poll.vote_casted"===e.type){var t,n=b.data,r=e.poll_vote.user_id===b.client.userID,s=E()(n.latest_answers),i=n.ownAnswer,a=n.ownVotesByOptionId,o=n.maxVotedOptionIds;r&&(tk(e.poll_vote)?i=e.poll_vote:e.poll_vote.option_id&&(a[e.poll_vote.option_id]=e.poll_vote)),tk(e.poll_vote)?s=[e.poll_vote].concat(E()(s)):o=tE(e.poll.vote_counts_by_option);var c=tC(e.poll);b.state.partialNext(tx(tx({},c),{},{latest_answers:s,lastActivityAt:new Date(e.created_at),ownAnswer:i,ownVotesByOptionId:a,maxVotedOptionIds:o}))}}),d()(this,"handleVoteChanged",function(e){if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===b.id)&&"poll.vote_changed"===e.type){var t,n,r=b.data,s=e.poll_vote.user_id===b.client.userID,i=E()(r.latest_answers),a=r.ownAnswer,o=r.ownVotesByOptionId,c=r.maxVotedOptionIds;s?tk(e.poll_vote)?(i=[e.poll_vote].concat(E()(i.filter(function(t){return t.id!==e.poll_vote.id}))),a=e.poll_vote):e.poll_vote.option_id&&(e.poll.enforce_unique_votes?o=d()({},e.poll_vote.option_id,e.poll_vote):(o=Object.entries(o).reduce(function(t,n){var r=m()(n,2),s=r[0],i=r[1];return s!==e.poll_vote.option_id&&i.id===e.poll_vote.id||(t[s]=i),t},{}))[e.poll_vote.option_id]=e.poll_vote,(null===(n=a)||void 0===n?void 0:n.id)===e.poll_vote.id&&(a=void 0),c=tE(e.poll.vote_counts_by_option)):tk(e.poll_vote)?i=[e.poll_vote].concat(E()(i)):c=tE(e.poll.vote_counts_by_option);var u=tC(e.poll);b.state.partialNext(tx(tx({},u),{},{latest_answers:i,lastActivityAt:new Date(e.created_at),ownAnswer:a,ownVotesByOptionId:o,maxVotedOptionIds:c}))}}),d()(this,"handleVoteRemoved",function(e){if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===b.id)&&"poll.vote_removed"===e.type){var t,n=b.data,r=e.poll_vote.user_id===b.client.userID,s=E()(n.latest_answers),i=n.ownAnswer,a=tx({},n.ownVotesByOptionId),o=n.maxVotedOptionIds;tk(e.poll_vote)?(s=s.filter(function(t){return t.id!==e.poll_vote.id}),r&&(i=void 0)):(o=tE(e.poll.vote_counts_by_option),r&&e.poll_vote.option_id&&delete a[e.poll_vote.option_id]);var c=tC(e.poll);b.state.partialNext(tx(tx({},c),{},{latest_answers:s,lastActivityAt:new Date(e.created_at),ownAnswer:i,ownVotesByOptionId:a,maxVotedOptionIds:o}))}}),d()(this,"query",(n=o()(v().mark(function e(t){var n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.getPoll(t);case 2:return n=e.sent.poll,b.state.partialNext(tx(tx({},n),{},{lastActivityAt:new Date})),e.abrupt("return",n);case 6:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})),d()(this,"update",(r=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.updatePoll(tx(tx({},t),{},{id:b.id}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})),d()(this,"partialUpdate",(s=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.partialUpdatePoll(b.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})),d()(this,"close",o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.closePoll(b.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))),d()(this,"delete",o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.deletePoll(b.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))),d()(this,"createOption",(i=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.createPollOption(b.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})),d()(this,"updateOption",(a=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.updatePollOption(b.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})),d()(this,"deleteOption",(c=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.deletePollOption(b.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return c.apply(this,arguments)})),d()(this,"castVote",(l=o()(v().mark(function e(t,n){var r,s,i,a,o;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(r=b.data).max_votes_allowed,i=r.ownVotesByOptionId,!(s&&s===Object.keys(i).length)||(o=Object.values(i)[0],Object.values(i).slice(1).forEach(function(e){var t;(!(null!==(t=o)&&void 0!==t&&t.created_at)||new Date(e.created_at)<new Date(o.created_at))&&(o=e)}),!(null!==(a=o)&&void 0!==a&&a.id))){e.next=8;break}return e.next=8,b.removeVote(o.id,n);case 8:return e.next=10,b.client.castPollVote(n,b.id,{option_id:t});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)})),function(e,t){return l.apply(this,arguments)})),d()(this,"removeVote",(h=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.removePollVote(n,b.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e,t){return h.apply(this,arguments)})),d()(this,"addAnswer",(p=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.addPollAnswer(n,b.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e,t){return p.apply(this,arguments)})),d()(this,"removeAnswer",(f=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.removePollVote(n,b.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e,t){return f.apply(this,arguments)})),d()(this,"queryAnswers",(g=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.queryPollAnswers(b.id,t.filter,t.sort,t.options);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return g.apply(this,arguments)})),d()(this,"queryOptionVotes",(y=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.client.queryPollVotes(b.id,t.filter,t.sort,t.options);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return y.apply(this,arguments)})),this.client=w,this.id=_.id,this.state=new e6(this.getInitialStateFromPollResponse(_))}return h()(e,[{key:"data",get:function(){return this.state.getLatestValue()}}]),e}();function tE(e){for(var t=0,n=[],r=0,s=Object.entries(null!=e?e:{});r<s.length;r++){var i=m()(s[r],2),a=i[0],o=i[1];o>t?(n=[a],t=o):o===t&&n.push(a)}return n}function tC(e){return{answers_count:e.answers_count,latest_votes_by_option:e.latest_votes_by_option,vote_count:e.vote_count,vote_counts_by_option:e.vote_counts_by_option}}function tR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var tO=function(){function e(t){var n,r,s,i=this,a=t.client;u()(this,e),d()(this,"client",void 0),d()(this,"pollCache",new Map),d()(this,"unsubscribeFunctions",new Set),d()(this,"fromState",function(e){return i.pollCache.get(e)}),d()(this,"registerSubscriptions",function(){i.unsubscribeFunctions.size||(i.unsubscribeFunctions.add(i.subscribeMessageNew()),i.unsubscribeFunctions.add(i.subscribePollUpdated()),i.unsubscribeFunctions.add(i.subscribePollClosed()),i.unsubscribeFunctions.add(i.subscribeVoteCasted()),i.unsubscribeFunctions.add(i.subscribeVoteChanged()),i.unsubscribeFunctions.add(i.subscribeVoteRemoved()))}),d()(this,"unregisterSubscriptions",function(){i.unsubscribeFunctions.forEach(function(e){return e()}),i.unsubscribeFunctions.clear()}),d()(this,"createPoll",(n=o()(v().mark(function e(t){var n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.client.createPoll(t);case 2:return n=e.sent.poll,e.abrupt("return",new tS({client:i.client,poll:n}));case 5:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})),d()(this,"getPoll",(r=o()(v().mark(function e(t){var n,r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=i.fromState(t))){e.next=4;break}return i.client.getPoll(t).then(function(e){var t=e.poll;return i.setOrOverwriteInCache(t,!0)}),e.abrupt("return",n);case 4:return e.next=6,i.client.getPoll(t);case 6:return r=e.sent.poll,i.setOrOverwriteInCache(r),e.abrupt("return",i.fromState(t));case 10:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})),d()(this,"queryPolls",(s=o()(v().mark(function e(t){var n,r,s,a,o,c,u=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:[],r=u.length>2&&void 0!==u[2]?u[2]:{},e.next=4,i.client.queryPolls(t,n,r);case 4:return a=(s=e.sent).polls,o=s.next,c=a.map(function(e){return i.setOrOverwriteInCache(e,!0),i.fromState(e.id)}),e.abrupt("return",{polls:c,next:o});case 9:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})),d()(this,"hydratePollCache",function(e,t){var n,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return tR(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tR(e,t)}}(e))){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}(e);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.poll){var a=s.poll;i.setOrOverwriteInCache(a,t)}}}catch(e){r.e(e)}finally{r.f()}}),d()(this,"setOrOverwriteInCache",function(e,t){if(i.client._cacheEnabled()){var n=i.fromState(e.id);if(n)t&&n.reinitializeState(e);else{var r=new tS({client:i.client,poll:e});i.pollCache.set(r.id,r)}}}),d()(this,"subscribePollUpdated",function(){return i.client.on("poll.updated",function(e){var t,n;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(n=i.fromState(e.poll.id))||void 0===n||n.handlePollUpdated(e))}).unsubscribe}),d()(this,"subscribePollClosed",function(){return i.client.on("poll.closed",function(e){var t,n;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(n=i.fromState(e.poll.id))||void 0===n||n.handlePollClosed(e))}).unsubscribe}),d()(this,"subscribeVoteCasted",function(){return i.client.on("poll.vote_casted",function(e){var t,n;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(n=i.fromState(e.poll.id))||void 0===n||n.handleVoteCasted(e))}).unsubscribe}),d()(this,"subscribeVoteChanged",function(){return i.client.on("poll.vote_changed",function(e){var t,n;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(n=i.fromState(e.poll.id))||void 0===n||n.handleVoteChanged(e))}).unsubscribe}),d()(this,"subscribeVoteRemoved",function(){return i.client.on("poll.vote_removed",function(e){var t,n;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(n=i.fromState(e.poll.id))||void 0===n||n.handleVoteRemoved(e))}).unsubscribe}),d()(this,"subscribeMessageNew",function(){return i.client.on("message.new",function(e){var t=e.message;if(t){var n=eh(t);i.hydratePollCache([n])}}).unsubscribe}),this.client=a}return h()(e,[{key:"data",get:function(){return this.pollCache}}]),e}();function tI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tI(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tI(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tL={"channel.deleted":"channelDeletedHandler","channel.hidden":"channelHiddenHandler","channel.truncated":"channelTruncatedHandler","channel.updated":"channelUpdatedHandler","channel.visible":"channelVisibleHandler","message.new":"newMessageHandler","member.updated":"memberUpdatedHandler","notification.added_to_channel":"notificationAddedToChannelHandler","notification.message_new":"notificationNewMessageHandler","notification.removed_from_channel":"notificationRemovedFromChannelHandler"},tP={abortInFlightQuery:!1,allowNotLoadedChannelPromotionForEvent:{"channel.visible":!0,"message.new":!0,"notification.added_to_channel":!0,"notification.message_new":!0},lockChannelOrder:!1},tA={limit:10,offset:0},tT=function e(t){var n,r,s,i,a=this,c=t.client,l=t.eventHandlerOverrides,h=t.options;u()(this,e),d()(this,"state",void 0),d()(this,"client",void 0),d()(this,"unsubscribeFunctions",new Set),d()(this,"eventHandlers",new Map),d()(this,"eventHandlerOverrides",new Map),d()(this,"options",{}),d()(this,"stateOptions",{}),d()(this,"setChannels",function(e){a.state.next(function(t){var n=t.channels,r=e7(e)?e(n):e;return n===r?t:tU(tU({},t),{},{channels:r})})}),d()(this,"setEventHandlerOverrides",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.entries(e).reduce(function(e,t){var n=m()(t,2),r=n[0],s=n[1];return s&&(e[r]=s),e},{});a.eventHandlerOverrides=new Map(Object.entries(t))}),d()(this,"setOptions",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.options=tU(tU({},tP),e)}),d()(this,"queryChannels",(n=o()(v().mark(function e(t){var n,r,s,i,o,c,u,l,h,p,d,f,g=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=g.length>1&&void 0!==g[1]?g[1]:[],r=g.length>2&&void 0!==g[2]?g[2]:{},s=g.length>3&&void 0!==g[3]?g[3]:{},o=(i=tU(tU({},tA),r)).offset,c=i.limit,!(a.state.getLatestValue().pagination.isLoading&&!a.options.abortInFlightQuery)){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,a.stateOptions=s,a.state.next(function(e){return tU(tU({},e),{},{pagination:tU(tU({},e.pagination),{},{isLoading:!0,isLoadingNext:!1,filters:t,sort:n,options:r})})}),e.next=12,a.client.queryChannels(t,n,r,s);case 12:h=e.sent,p=o+(null!==(u=null==h?void 0:h.length)&&void 0!==u?u:0),d=tU(tU({},r),{},{offset:p}),f=a.state.getLatestValue().pagination,a.state.partialNext({channels:h,pagination:tU(tU({},f),{},{hasNext:(null!==(l=null==h?void 0:h.length)&&void 0!==l?l:0)>=c,isLoading:!1,options:d}),initialized:!0}),e.next=24;break;case 19:throw e.prev=19,e.t0=e.catch(7),a.client.logger("error",e.t0.message),a.state.next(function(e){return tU(tU({},e),{},{pagination:tU(tU({},e.pagination),{},{isLoading:!1})})}),e.t0;case 24:case"end":return e.stop()}},e,null,[[7,19]])})),function(e){return n.apply(this,arguments)})),d()(this,"loadNext",o()(v().mark(function e(){var t,n,r,s,i,o,c,u,l,h,p,d,f,g,m,y,b;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=a.state.getLatestValue()).pagination,r=t.initialized,s=n.filters,i=n.sort,o=n.options,c=n.isLoadingNext,u=n.hasNext,!(!r||c||!u)){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,d=(p=tU(tU({},tA),o)).offset,f=p.limit,a.state.partialNext({pagination:tU(tU({},n),{},{isLoading:!1,isLoadingNext:!0})}),e.next=9,a.client.queryChannels(s,i,o,a.stateOptions);case 9:g=e.sent,m=a.state.getLatestValue().channels,y=d+(null!==(l=null==g?void 0:g.length)&&void 0!==l?l:0),b=tU(tU({},o),{},{offset:y}),a.state.partialNext({channels:ev([].concat(E()(m||[]),E()(g)),"cid"),pagination:tU(tU({},n),{},{hasNext:(null!==(h=null==g?void 0:g.length)&&void 0!==h?h:0)>=f,isLoading:!1,isLoadingNext:!1,options:b})}),e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(4),a.client.logger("error",e.t0.message),a.state.next(function(e){return tU(tU({},e),{},{pagination:tU(tU({},e.pagination),{},{isLoadingNext:!1})})}),e.t0;case 21:case"end":return e.stop()}},e,null,[[4,16]])}))),d()(this,"notificationAddedToChannelHandler",(r=o()(v().mark(function e(t){var n,r,s,i,o,c,u,l,h,p,d;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(s=null!==(n=null==t?void 0:t.channel)&&void 0!==n?n:{}).id,o=s.type,c=s.members,!(!o||!(null!==(r=a.options.allowNotLoadedChannelPromotionForEvent)&&void 0!==r&&r["notification.added_to_channel"]))){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,e_({client:a.client,id:i,members:null==c?void 0:c.reduce(function(e,t){var n=t.user,r=t.user_id||(null==n?void 0:n.id);return r&&e.push(r),e},[]),type:o});case 5:if(u=e.sent,h=(l=a.state.getLatestValue()).pagination,p=l.channels){e.next=9;break}return e.abrupt("return");case 9:d=(null!=h?h:{}).sort,a.setChannels(eU({channels:p,channelToMove:u,sort:d}));case 11:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})),d()(this,"channelDeletedHandler",function(e){var t=a.state.getLatestValue().channels;if(t){var n=E()(t),r=n.findIndex(function(t){var n;return t.cid===(e.cid||(null===(n=e.channel)||void 0===n?void 0:n.cid))});r<0||(n.splice(r,1),a.setChannels(n))}}),d()(this,"channelHiddenHandler",this.channelDeletedHandler),d()(this,"newMessageHandler",function(e){var t,n=a.state.getLatestValue(),r=n.pagination,s=n.channels;if(s){var i=null!=r?r:{},o=i.filters,c=i.sort,u=e.channel_type,l=e.channel_id;if(u&&l){var h=a.client.channel(u,l),p=s.indexOf(h),d=p>=0,f=ek(h),v=eS(h),g=eE(o),m=eR(c);g&&v&&!o.archived||g&&!v&&o.archived||m&&f||a.options.lockChannelOrder||!d&&(null===(t=a.options.allowNotLoadedChannelPromotionForEvent)||void 0===t||!t["message.new"])||a.setChannels(eU({channels:s,channelToMove:h,channelToMoveIndexWithinChannels:p,sort:c}))}}}),d()(this,"notificationNewMessageHandler",(s=o()(v().mark(function e(t){var n,r,s,i,o,c,u,l,h,p,d,f,g,m;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(s=null!==(n=null==t?void 0:t.channel)&&void 0!==n?n:{}).id,o=s.type,!(!i||!o)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,e_({client:a.client,id:i,type:o});case 5:if(c=e.sent,l=(u=a.state.getLatestValue()).channels,d=(p=null!=(h=u.pagination)?h:{}).filters,f=p.sort,g=eE(d),m=eS(c),!(!l||g&&m&&!d.archived||g&&!m&&d.archived||!(null!==(r=a.options.allowNotLoadedChannelPromotionForEvent)&&void 0!==r&&r["notification.message_new"]))){e.next=12;break}return e.abrupt("return");case 12:a.setChannels(eU({channels:l,channelToMove:c,sort:f}));case 13:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})),d()(this,"channelVisibleHandler",(i=o()(v().mark(function e(t){var n,r,s,i,o,c,u,l,h,p,d,f;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.channel_type,s=t.channel_id,!(!r||!s)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,e_({client:a.client,id:t.channel_id,type:t.channel_type});case 5:if(i=e.sent,c=(o=a.state.getLatestValue()).channels,h=(l=null!=(u=o.pagination)?u:{}).sort,d=eE(p=l.filters),f=eS(i),!(!c||d&&f&&!p.archived||d&&!f&&p.archived||!(null!==(n=a.options.allowNotLoadedChannelPromotionForEvent)&&void 0!==n&&n["channel.visible"]))){e.next=12;break}return e.abrupt("return");case 12:a.setChannels(eU({channels:c,channelToMove:i,sort:h}));case 13:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})),d()(this,"notificationRemovedFromChannelHandler",this.channelDeletedHandler),d()(this,"memberUpdatedHandler",function(e){var t,n=a.state.getLatestValue(),r=n.pagination,s=n.channels,i=r.filters,o=r.sort;if(null!==(t=e.member)&&void 0!==t&&t.user&&e.member.user.id===a.client.userID&&e.channel_type&&e.channel_id){var c=e.channel_type,u=e.channel_id,l=eR(o),h=eE(i),p=eC({atIndex:0,sort:o,targetKey:"pinned_at"});if(s&&(l||h)&&!a.options.lockChannelOrder){var d=a.client.channel(c,u),f=s.indexOf(d),v=f>=0,g=ek(d),m=eS(d),y=E()(s);if(v&&y.splice(f,1),h&&!m&&null!=i&&i.archived||h&&m&&!(null!=i&&i.archived)){a.setChannels(y);return}var b=null;1!==p&&(-1!==p||g)||(b=eI({channels:y}));var w="number"==typeof b?b+1:0;s[w]!==d&&(y.splice(w,0,d),a.setChannels(y))}}}),d()(this,"subscriptionOrOverride",function(e){var t=tL[e.type],n=a.eventHandlers.get(t),r=a.eventHandlerOverrides.get(t);if(r&&"function"==typeof r){r(a.setChannels,e);return}n&&"function"==typeof n&&n(e)}),d()(this,"registerSubscriptions",function(){if(!a.unsubscribeFunctions.size)for(var e=0,t=Object.keys(tL);e<t.length;e++){var n=t[e];a.unsubscribeFunctions.add(a.client.on(n,a.subscriptionOrOverride).unsubscribe)}}),d()(this,"unregisterSubscriptions",function(){a.unsubscribeFunctions.forEach(function(e){return e()}),a.unsubscribeFunctions.clear()}),this.client=c,this.state=new e6({channels:[],pagination:{isLoading:!1,isLoadingNext:!1,hasNext:!1,filters:{},sort:{},options:tA},initialized:!1}),this.setEventHandlerOverrides(void 0===l?{}:l),this.setOptions(void 0===h?{}:h),this.eventHandlers=new Map(Object.entries({channelDeletedHandler:this.channelDeletedHandler,channelHiddenHandler:this.channelHiddenHandler,channelVisibleHandler:this.channelVisibleHandler,memberUpdatedHandler:this.memberUpdatedHandler,newMessageHandler:this.newMessageHandler,notificationAddedToChannelHandler:this.notificationAddedToChannelHandler,notificationNewMessageHandler:this.notificationNewMessageHandler,notificationRemovedFromChannelHandler:this.notificationRemovedFromChannelHandler}))},tj=["created_at","updated_at","last_active","online"],tM=["params","headers"];function tD(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return tN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tN(e,t)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function tN(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?t$(Object(n),!0).forEach(function(t){d()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function tq(e){return"string"==typeof e||e instanceof String}var tH=function(){var e,t,n,r,s,a,c,l,p,f,g,y,w,x,S,R,I,L,P,A,T,j,D,N,$,F,q,H,V,B,W,G,K,J,Y,Q,Z,ee,ea,ec,eu,eh,ep,ed,ef,ev,eg,em,ey,ew,e_,ek,eS,eE,eC,eR,eO,eI,eU,eL,eP,eA,eT,ej,eM,eD,eN,eF,eH,eV,eG,ez,eX,eY,eZ,e0,e1,e2,e8,e9,e7,e6,te,tt,tn,tr,ts,ti,to,tc,tu,tl,th,tp,tf,tv,tg,tm,tb,tw,t_,tx,tk,tS,tE,tC,tR,tI,tU,tL,tP,tA;function tN(e,t,n){var r,s,i,a,c,l=this;u()(this,tN),d()(this,"_user",void 0),d()(this,"activeChannels",void 0),d()(this,"threads",void 0),d()(this,"polls",void 0),d()(this,"anonymous",void 0),d()(this,"persistUserOnConnectionFailure",void 0),d()(this,"axiosInstance",void 0),d()(this,"baseURL",void 0),d()(this,"browser",void 0),d()(this,"cleaningIntervalRef",void 0),d()(this,"clientID",void 0),d()(this,"configs",void 0),d()(this,"key",void 0),d()(this,"listeners",void 0),d()(this,"logger",void 0),d()(this,"recoverStateOnReconnect",void 0),d()(this,"moderation",void 0),d()(this,"mutedChannels",void 0),d()(this,"mutedUsers",void 0),d()(this,"node",void 0),d()(this,"options",void 0),d()(this,"secret",void 0),d()(this,"setUserPromise",void 0),d()(this,"state",void 0),d()(this,"tokenManager",void 0),d()(this,"user",void 0),d()(this,"userAgent",void 0),d()(this,"userID",void 0),d()(this,"wsBaseURL",void 0),d()(this,"wsConnection",void 0),d()(this,"wsFallback",void 0),d()(this,"wsPromise",void 0),d()(this,"consecutiveFailures",void 0),d()(this,"insightMetrics",void 0),d()(this,"defaultWSTimeoutWithFallback",void 0),d()(this,"defaultWSTimeout",void 0),d()(this,"sdkIdentifier",void 0),d()(this,"deviceIdentifier",void 0),d()(this,"nextRequestAbortController",null),d()(this,"_getConnectionID",function(){var e,t;return(null===(e=l.wsConnection)||void 0===e?void 0:e.connectionID)||(null===(t=l.wsFallback)||void 0===t?void 0:t.connectionID)}),d()(this,"_hasConnectionID",function(){return!!l._getConnectionID()}),d()(this,"connectUser",(r=o()(v().mark(function e(t,n){var r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error('The "id" field on the user is missing');case 2:if(!(l.userID===t.id&&l.setUserPromise)){e.next=5;break}return console.warn("Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),e.abrupt("return",l.setUserPromise);case 5:if(!l.userID){e.next=7;break}throw Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");case 7:return(l._isUsingServerAuth()||l.node)&&!l.options.allowServerSideConnect&&console.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),l.userID=t.id,l.anonymous=!1,r=l._setToken(t,n),l._setUser(t),s=l.openConnection(),l.setUserPromise=Promise.all([r,s]).then(function(e){return e[1]}),e.prev=14,e.next=17,l.setUserPromise;case 17:return e.abrupt("return",e.sent);case 20:throw e.prev=20,e.t0=e.catch(14),l.persistUserOnConnectionFailure?l.closeConnection():l.disconnectUser(),e.t0;case 24:case"end":return e.stop()}},e,null,[[14,20]])})),function(e,t){return r.apply(this,arguments)})),d()(this,"setUser",this.connectUser),d()(this,"_setToken",function(e,t){return l.tokenManager.setTokenOrProvider(t,e)}),d()(this,"closeConnection",(s=o()(v().mark(function e(t){var n,r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null!=l.cleaningIntervalRef&&(clearInterval(l.cleaningIntervalRef),l.cleaningIntervalRef=void 0),e.next=3,Promise.all([null===(n=l.wsConnection)||void 0===n?void 0:n.disconnect(t),null===(r=l.wsFallback)||void 0===r?void 0:r.disconnect(t)]);case 3:return e.abrupt("return",Promise.resolve());case 4:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})),d()(this,"createChannelManager",function(e){var t=e.eventHandlerOverrides,n=e.options;return new tT({client:l,eventHandlerOverrides:void 0===t?{}:t,options:void 0===n?{}:n})}),d()(this,"openConnection",o()(v().mark(function e(){var t,n,r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.userID){e.next=2;break}throw Error("User is not set on client, use client.connectUser or client.connectAnonymousUser instead");case 2:if(!(null!==(t=l.wsConnection)&&void 0!==t&&t.isConnecting&&l.wsPromise)){e.next=5;break}return l.logger("info","client:openConnection() - connection already in progress",{tags:["connection","client"]}),e.abrupt("return",l.wsPromise);case 5:if(!((null!==(n=l.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=l.wsFallback)&&void 0!==r&&r.isHealthy())&&l._hasConnectionID())){e.next=8;break}return l.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists",{tags:["connection","client"]}),e.abrupt("return");case 8:return l.clientID="".concat(l.userID,"--").concat(eo()),l.wsPromise=l.connect(),l._startCleaning(),e.abrupt("return",l.wsPromise);case 12:case"end":return e.stop()}},e)}))),d()(this,"_setupConnection",this.openConnection),d()(this,"_normalizeDate",function(e){if(e instanceof Date&&(e=e.toISOString()),""===e)throw Error("Don't pass blank string for since, use null instead if resetting the token revoke");return e}),d()(this,"disconnectUser",(i=o()(v().mark(function e(t){var n,r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(l.logger("info","client:disconnect() - Disconnecting the client",{tags:["connection","client"]}),delete l.user,delete l._user,delete l.userID,l.anonymous=!1,n=l.closeConnection(t),r=0,s=Object.values(l.activeChannels);r<s.length;r++)s[r]._disconnect();return l.activeChannels={},l.state=new eq({client:l}),l.threads.resetState(),setTimeout(l.tokenManager.reset),e.abrupt("return",n);case 12:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})),d()(this,"disconnect",this.disconnectUser),d()(this,"connectAnonymousUser",function(){(l._isUsingServerAuth()||l.node)&&!l.options.allowServerSideConnect&&console.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),l.anonymous=!0,l.userID=eo();var e={id:l.userID,anon:!0};return l._setToken(e,""),l._setUser(e),l._setupConnection()}),d()(this,"setAnonymousUser",this.connectAnonymousUser),d()(this,"doAxiosRequest",(a=o()(v().mark(function e(t,n,r){var s,i,a,o,c=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.length>3&&void 0!==c[3]?c[3]:{},e.next=3,l.tokenManager.tokenReady();case 3:i=l._enrichAxiosOptions(s),e.prev=4,l._logApiRequest(t,n,r,i),e.t0=t,e.next="get"===e.t0?9:"delete"===e.t0?13:"post"===e.t0?17:"postForm"===e.t0?21:"put"===e.t0?25:"patch"===e.t0?29:"options"===e.t0?33:37;break;case 9:return e.next=11,l.axiosInstance.get(n,i);case 11:case 15:case 19:case 23:case 27:case 31:case 35:return a=e.sent,e.abrupt("break",38);case 13:return e.next=15,l.axiosInstance.delete(n,i);case 17:return e.next=19,l.axiosInstance.post(n,r,i);case 21:return e.next=23,l.axiosInstance.postForm(n,r,i);case 25:return e.next=27,l.axiosInstance.put(n,r,i);case 29:return e.next=31,l.axiosInstance.patch(n,r,i);case 33:return e.next=35,l.axiosInstance.options(n,i);case 37:throw Error("Invalid request type");case 38:return l._logApiResponse(t,n,a),l.consecutiveFailures=0,e.abrupt("return",l.handleResponse(a));case 43:if(e.prev=43,e.t1=e.catch(4),e.t1.client_request_id=null===(o=i.headers)||void 0===o?void 0:o["x-client-request-id"],l._logApiError(t,n,e.t1),l.consecutiveFailures+=1,!e.t1.response){e.next=60;break}if(!(e.t1.response.data.code===er.TOKEN_EXPIRED&&!l.tokenManager.isStatic())){e.next=57;break}if(!(l.consecutiveFailures>1)){e.next=53;break}return e.next=53,et(ei(l.consecutiveFailures));case 53:return l.tokenManager.loadToken(),e.next=56,l.doAxiosRequest(t,n,r,s);case 56:return e.abrupt("return",e.sent);case 57:return e.abrupt("return",l.handleResponse(e.t1.response));case 60:throw e.t1;case 61:case"end":return e.stop()}},e,null,[[4,43]])})),function(e,t,n){return a.apply(this,arguments)})),d()(this,"dispatchEvent",function(e){e.received_at||(e.received_at=new Date);var t=l._handleClientEvent(e),n=e.cid,r=n?l.activeChannels[n]:void 0;r&&r._handleChannelEvent(e),l._callClientListeners(e),r&&r._callChannelListeners(e),t.forEach(function(e){return e()})}),d()(this,"handleEvent",function(e){var t=JSON.parse(e.data);l.dispatchEvent(t)}),d()(this,"_updateMemberWatcherReferences",function(e){var t=l.state.userChannelReferences[e.id]||{};for(var n in t){var r=l.activeChannels[n];null!=r&&r.state&&(r.state.members[e.id]&&(r.state.members[e.id].user=e),r.state.watchers[e.id]&&(r.state.watchers[e.id]=e),r.state.read[e.id]&&(r.state.read[e.id].user=e))}}),d()(this,"_updateUserReferences",this._updateMemberWatcherReferences),d()(this,"_updateUserMessageReferences",function(e){var t=l.state.userChannelReferences[e.id]||{};for(var n in t){var r=l.activeChannels[n];if(r){var s=r.state;null==s||s.updateUserMessages(e)}}}),d()(this,"_deleteUserMessageReference",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=l.state.userChannelReferences[e.id]||{};for(var r in n){var s=l.activeChannels[r];if(s){var i=s.state;null==i||i.deleteUserMessages(e,t)}}}),d()(this,"_handleUserEvent",function(e){if(e.user){if("user.presence.changed"===e.type||"user.updated"===e.type){if(e.user.id===l.userID){var t=tF({},l.user||{}),n=tF({},l._user||{});for(var r in l.user)r in e.user||({channel_mutes:!0,devices:!0,mutes:!0,total_unread_count:!0,unread_channels:!0,unread_count:!0,unread_threads:!0,invisible:!0,privacy_settings:!0,roles:!0,push_preferences:!0})[r]||(delete t[r],delete n[r]);for(var s in e.user)n&&s in n&&(n[s]=e.user[s]);l._user=tF({},n),l.user=tF(tF({},t),e.user)}l.state.updateUser(e.user),l._updateMemberWatcherReferences(e.user)}"user.updated"===e.type&&l._updateUserMessageReferences(e.user),"user.deleted"===e.type&&e.user.deleted_at&&(e.mark_messages_deleted||e.hard_delete)&&l._deleteUserMessageReference(e.user,e.hard_delete)}}),d()(this,"_callClientListeners",function(e){var t=[];l.listeners.all&&t.push.apply(t,E()(l.listeners.all)),l.listeners[e.type]&&t.push.apply(t,E()(l.listeners[e.type]));for(var n=0;n<t.length;n++)(0,t[n])(e)}),d()(this,"recoverState",o()(v().mark(function e(){var t;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l.logger("info","client:recoverState() - Start of recoverState with connectionID ".concat(l._getConnectionID()),{tags:["connection"]}),!((t=Object.keys(l.activeChannels)).length&&l.recoverStateOnReconnect)){e.next=10;break}return l.logger("info","client:recoverState() - Start the querying of ".concat(t.length," channels"),{tags:["connection","client"]}),e.next=6,l.queryChannels({cid:{$in:t}},{last_message_at:-1},{limit:30});case 6:l.logger("info","client:recoverState() - Querying channels finished",{tags:["connection","client"]}),l.dispatchEvent({type:"connection.recovered"}),e.next=11;break;case 10:l.dispatchEvent({type:"connection.recovered"});case 11:l.wsPromise=Promise.resolve(),l.setUserPromise=Promise.resolve();case 13:case"end":return e.stop()}},e)}))),d()(this,"getChannelByMembers",function(e,t){var n,r=(null!==(n=t.members)&&void 0!==n?n:[]).map(function(e){var t;return"string"==typeof e?e:null!==(t=e.user_id)&&void 0!==t?t:""}),s=r.sort().join(","),i=ex(e,r);if(!i)throw Error("Please specify atleast one member when creating unique conversation");for(var a in l.activeChannels){var o=l.activeChannels[a];if(!o.disconnected&&(a===i||0===a.indexOf("".concat(e,":!members-"))&&Object.keys(o.state.members).sort().join(",")===s))return o}var c=new e$(l,e,void 0,t);return l._cacheEnabled()&&(l.activeChannels[i]=c),c}),d()(this,"getChannelById",function(e,t,n){if("string"==typeof t&&~t.indexOf(":"))throw Error("Invalid channel id ".concat(t,", can't contain the : character"));var r="".concat(e,":").concat(t);if(r in l.activeChannels&&l.activeChannels[r]&&!l.activeChannels[r].disconnected){var s=l.activeChannels[r];return Object.keys(n).length>0&&(s.data=tF(tF({},s.data),n),s._data=tF(tF({},s._data),n)),s}var i=new e$(l,e,t,n);return l._cacheEnabled()&&(l.activeChannels[i.cid]=i),i}),d()(this,"updateUsers",this.upsertUsers),d()(this,"updateUser",this.upsertUser),d()(this,"_unblockMessage",this.unblockMessage),d()(this,"markAllRead",this.markChannelsRead),d()(this,"_isUsingServerAuth",function(){return!!l.secret}),d()(this,"_cacheEnabled",function(){return!l._isUsingServerAuth()||!l.options.disableCache}),d()(this,"_buildWSPayload",function(e){return JSON.stringify({user_id:l.userID,user_details:l._user,device:l.options.device,client_request_id:e})}),this.key=e,this.listeners={},this.state=new eq({client:this}),this.mutedChannels=[],this.mutedUsers=[],this.moderation=new td(this),t&&tq(t)&&(this.secret=t);var h=n||(t&&!tq(t)?t:{});this.browser=void 0!==h.browser&&h.browser,this.node=!this.browser,this.options=tF({timeout:3e3,withCredentials:!1,warmUp:!1,recoverStateOnReconnect:!0,disableCache:!1,wsUrlParams:new URLSearchParams({})},h),this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new(O()).Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.axiosInstance=C.Z.create(this.options),this.setBaseURL(this.options.baseURL||"https://chat.stream-io-api.com"),"undefined"!=typeof process&&"env"in process&&process.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030"),"undefined"!=typeof process&&"env"in process&&process.env.STREAM_LOCAL_TEST_HOST&&this.setBaseURL("http://"+process.env.STREAM_LOCAL_TEST_HOST),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.activeChannels={},this.configs={},this.anonymous=!1,this.persistUserOnConnectionFailure=null===(c=this.options)||void 0===c?void 0:c.persistUserOnConnectionFailure,this.tokenManager=new eQ(this.secret),this.consecutiveFailures=0,this.insightMetrics=new eB,this.defaultWSTimeoutWithFallback=6e3,this.defaultWSTimeout=15e3,this.axiosInstance.defaults.paramsSerializer=el,this.logger=en(h.logger)?h.logger:function(){return null},this.recoverStateOnReconnect=this.options.recoverStateOnReconnect,this.threads=new ty({client:this}),this.polls=new tO({client:this})}return h()(tN,[{key:"devToken",value:function(e){var t;return["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",(t=JSON.stringify({user_id:e}),(0,i.JQ)(new Uint8Array(function(e,t){var n=[];if(z(e)&&t&&z(e)){for(var r=0,s=e.length;r<s;r++)if(e.charAt(r)){var i=t(e.charAt(r),r,e);n[r]=i}}else if(!z(e)&&!(t&&z(e))){for(var a=0,o=e.length;a<o;a++)if(a in e){var c=t(e[a],a,e);n[a]=c}}return n}(t,function(e){return e.charCodeAt(0)})))),"devtoken"].join(".")}},{key:"getAuthType",value:function(){return this.anonymous?"anonymous":"jwt"}},{key:"setBaseURL",value:function(e){this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")}},{key:"_setUser",value:function(e){this.user=e,this.userID=e.id,this._user=tF({},e)}},{key:"updateAppSettings",value:(e=o()(v().mark(function e(t){var n;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null!=(n=t.apn_config)&&n.p12_cert&&(t=tF(tF({},t),{},{apn_config:tF(tF({},n),{},{p12_cert:Buffer.from(n.p12_cert).toString("base64")})})),e.next=4,this.patch(this.baseURL+"/app",t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"revokeTokens",value:(t=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateAppSettings({revoke_tokens_issued_before:this._normalizeDate(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"revokeUserToken",value:(n=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.revokeUsersToken([t],n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"revokeUsersToken",value:(r=o()(v().mark(function e(t,n){var r,s,i,a;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0===n?new Date().toISOString():this._normalizeDate(n),r=[],s=tD(t);try{for(s.s();!(i=s.n()).done;)a=i.value,r.push({id:a,set:{revoke_tokens_issued_before:n}})}catch(e){s.e(e)}finally{s.f()}return e.next=6,this.partialUpdateUsers(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"getAppSettings",value:(s=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/app");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"testPushSettings",value:(a=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/check_push",tF(tF(tF(tF(tF(tF(tF({user_id:t},n.messageID?{message_id:n.messageID}:{}),n.apnTemplate?{apn_template:n.apnTemplate}:{}),n.firebaseTemplate?{firebase_template:n.firebaseTemplate}:{}),n.firebaseDataTemplate?{firebase_data_template:n.firebaseDataTemplate}:{}),n.skipDevices?{skip_devices:!0}:{}),n.pushProviderName?{push_provider_name:n.pushProviderName}:{}),n.pushProviderType?{push_provider_type:n.pushProviderType}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"testSQSSettings",value:(c=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sqs",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"testSNSSettings",value:(l=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sns",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"setGuestUser",value:(p=o()(v().mark(function e(t){var n,r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.anonymous=!0,e.prev=1,e.next=4,this.post(this.baseURL+"/guest",{user:t});case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.anonymous=!1,e.t0;case 11:return this.anonymous=!1,(r=n.user).created_at,r.updated_at,r.last_active,r.online,s=k()(r,tj),e.next=15,this.connectUser(s,n.access_token);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this,[[1,7]])})),function(e){return p.apply(this,arguments)})},{key:"createToken",value:function(e,t,n){if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");var r={};return t&&(r.exp=t),n&&(r.iat=n),eJ(this.secret,e,r,{})}},{key:"on",value:function(e,t){var n=this,r=t?e:"all",s=t||e;return r in this.listeners||(this.listeners[r]=[]),this.logger("info","Attaching listener for ".concat(r," event"),{tags:["event","client"]}),this.listeners[r].push(s),{unsubscribe:function(){n.logger("info","Removing listener for ".concat(r," event"),{tags:["event","client"]}),n.listeners[r]=n.listeners[r].filter(function(e){return e!==s})}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this.logger("info","Removing listener for ".concat(n," event"),{tags:["event","client"]}),this.listeners[n]=this.listeners[n].filter(function(e){return e!==r})}},{key:"_logApiRequest",value:function(e,t,n,r){this.logger("info","client: ".concat(e," - Request - ").concat(t),{tags:["api","api_request","client"],url:t,payload:n,config:r})}},{key:"_logApiResponse",value:function(e,t,n){this.logger("info","client:".concat(e," - Response - url: ").concat(t," > status ").concat(n.status),{tags:["api","api_response","client"],url:t,response:n})}},{key:"_logApiError",value:function(e,t,n){this.logger("error","client:".concat(e," - Error - url: ").concat(t),{tags:["api","api_response","client"],url:t,error:n})}},{key:"get",value:function(e,t){return this.doAxiosRequest("get",e,null,{params:t})}},{key:"put",value:function(e,t){return this.doAxiosRequest("put",e,t)}},{key:"post",value:function(e,t){return this.doAxiosRequest("post",e,t)}},{key:"patch",value:function(e,t){return this.doAxiosRequest("patch",e,t)}},{key:"delete",value:function(e,t){return this.doAxiosRequest("delete",e,null,{params:t})}},{key:"sendFile",value:function(e,t,n,r,s){var i,a,o,c,u=(i=t,a=n,o=r||"multipart/form-data",c=new(U()),null!==i&&"object"===_()(i)&&(i.readable||"function"==typeof i._read)||null!=i&&null!=i.constructor&&"function"==typeof i.constructor.isBuffer&&i.constructor.isBuffer(i)?a?c.append("file",i,a):c.append("file",i):c.append("file",{uri:i,name:a||i.split("/").reverse()[0],contentType:o||void 0,type:o||void 0}),c);return null!=s&&u.append("user",JSON.stringify(s)),this.doAxiosRequest("postForm",e,u,{headers:u.getHeaders?u.getHeaders():{},config:{timeout:0,maxContentLength:1/0,maxBodyLength:1/0}})}},{key:"errorFromResponse",value:function(e){var t;return t=new e5("StreamChat error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=Error("StreamChat error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t}},{key:"handleResponse",value:function(e){var t=e.data;if(!e.status||e.status<200||300<=e.status)throw this.errorFromResponse(e);return t}},{key:"_handleClientEvent",value:function(e){var t,n,r,s=this,i=[];return this.logger("info","client:_handleClientEvent - Received event of type { ".concat(e.type," }"),{tags:["event","client"],event:e}),("user.presence.changed"===e.type||"user.updated"===e.type||"user.deleted"===e.type)&&this._handleUserEvent(e),"health.check"===e.type&&e.me&&(this.user=e.me,this.state.updateUser(e.me),this.mutedChannels=e.me.channel_mutes,this.mutedUsers=e.me.mutes),e.channel&&"notification.message_new"===e.type&&this._addChannelConfig(e.channel),"notification.channel_mutes_updated"===e.type&&null!==(n=e.me)&&void 0!==n&&n.channel_mutes&&(this.mutedChannels=e.me.channel_mutes),"notification.mutes_updated"===e.type&&null!==(r=e.me)&&void 0!==r&&r.mutes&&(this.mutedUsers=e.me.mutes),"notification.mark_read"===e.type&&0===e.unread_channels&&Object.keys(this.activeChannels).forEach(function(e){return s.activeChannels[e].state.unreadCount=0}),("channel.deleted"===e.type||"notification.channel_deleted"===e.type)&&e.cid&&(this.state.deleteAllChannelReference(e.cid),null===(t=this.activeChannels[e.cid])||void 0===t||t._disconnect(),i.push(function(){e.cid&&delete s.activeChannels[e.cid]})),i}},{key:"_muteStatus",value:function(e){for(var t,n=0;n<this.mutedChannels.length;n++){var r,s=this.mutedChannels[n];if((null===(r=s.channel)||void 0===r?void 0:r.cid)===e){t={muted:!s.expires||new Date(s.expires).getTime()>new Date().getTime(),createdAt:s.created_at?new Date(s.created_at):new Date,expiresAt:s.expires?new Date(s.expires):null};break}}return t||{muted:!1,createdAt:null,expiresAt:null}}},{key:"connect",value:(f=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!this.userID||!this._user)){e.next=2;break}throw Error("Call connectUser or connectAnonymousUser before starting the connection");case 2:if(this.wsBaseURL){e.next=4;break}throw Error("Websocket base url not set");case 4:if(this.clientID){e.next=6;break}throw Error("clientID is not set");case 6:if(!this.wsConnection&&(this.options.warmUp||this.options.enableInsights)&&this._sayHi(),this.options.wsConnection&&this.node?(this.options.wsConnection.setClient(this),this.wsConnection=this.options.wsConnection):this.wsConnection=new eK({client:this}),e.prev=8,!this.wsFallback){e.next=13;break}return e.next=12,this.wsFallback.connect();case 12:case 15:case 28:return e.abrupt("return",e.sent);case 13:return e.next=15,this.wsConnection.connect(this.options.enableWSFallback?this.defaultWSTimeoutWithFallback:this.defaultWSTimeout);case 18:if(e.prev=18,e.t0=e.catch(8),!(this.options.enableWSFallback&&function(e){if("boolean"==typeof e.isWSFailure)return e.isWSFailure;try{return JSON.parse(e.message).isWSFailure}catch(e){return!1}}(e.t0)&&function(){var e="undefined"!=typeof navigator?navigator:void 0;return e?"boolean"!=typeof e.onLine||e.onLine:(console.warn("isOnline failed to access window.navigator and assume browser is online"),!0)}())){e.next=29;break}return this.logger("info","client:connect() - WS failed, fallback to longpoll",{tags:["connection","client"]}),this.dispatchEvent({type:"transport.changed",mode:"longpoll"}),this.wsConnection._destroyCurrentWSConnection(),this.wsConnection.disconnect().then(),this.wsFallback=new e3({client:this}),e.next=28,this.wsFallback.connect();case 29:throw e.t0;case 30:case"end":return e.stop()}},e,this,[[8,18]])})),function(){return f.apply(this,arguments)})},{key:"_sayHi",value:function(){var e=this,t=eo();this.doAxiosRequest("get",this.baseURL+"/hi",null,{headers:{"x-client-request-id":t}}).catch(function(n){e.options.enableInsights&&eW("http_hi_failed",{api_key:e.key,err:n,client_request_id:t})})}},{key:"queryUsers",value:(g=o()(v().mark(function e(t){var n,r,s,i,a=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},s={presence:!1},e.next=5,this.wsPromise;case 5:return this._hasConnectionID()||(s.presence=!1),e.next=8,this.get(this.baseURL+"/users",{payload:tF(tF({filter_conditions:t,sort:es(n)},s),r)});case 8:return i=e.sent,this.state.updateUsers(i.users),e.abrupt("return",i);case 11:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"queryBannedUsers",value:(y=o()(v().mark(function e(){var t,n,r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.get(this.baseURL+"/query_banned_users",{payload:tF({filter_conditions:t,sort:es(n)},r)});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"queryMessageFlags",value:(w=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.get(this.baseURL+"/moderation/flags/message",{payload:tF({filter_conditions:t},n)});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(){return w.apply(this,arguments)})},{key:"queryChannels",value:(x=o()(v().mark(function e(t){var n,r,s,i,a,o,c=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:[],r=c.length>2&&void 0!==c[2]?c[2]:{},s=c.length>3&&void 0!==c[3]?c[3]:{},i={state:!0,watch:!0,presence:!1},e.next=6,this.wsPromise;case 6:return this._hasConnectionID()||(i.watch=!1),a=tF(tF({filter_conditions:t,sort:es(n)},i),r),e.next=10,this.post(this.baseURL+"/channels",a);case 10:return o=e.sent,this.dispatchEvent({type:"channels.queried",queriedChannels:{channels:o.channels,isLatestMessageSet:!0}}),e.abrupt("return",this.hydrateActiveChannels(o.channels,s,r));case 13:case"end":return e.stop()}},e,this)})),function(e){return x.apply(this,arguments)})},{key:"queryReactions",value:(S=o()(v().mark(function e(t,n){var r,s,i,a=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:[],s=a.length>3&&void 0!==a[3]?a[3]:{},e.next=4,this.wsPromise;case 4:return i=tF({filter:n,sort:es(r)},s),e.next=7,this.post(this.baseURL+"/messages/"+encodeURIComponent(t)+"/reactions",i);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return S.apply(this,arguments)})},{key:"hydrateActiveChannels",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,s=n.skipInitialization,i=n.offlineMode,a=void 0!==i&&i,o=[],c=tD(t);try{for(c.s();!(e=c.n()).done;){var u=e.value;this._addChannelConfig(u.channel);var l=this.channel(u.channel.type,u.channel.id);l.data=u.channel,l.offlineMode=a,l.initialized=!a,l.push_preferences=u.push_preferences;var h=void 0;void 0===s?h=l._initializeState(u,"latest").messageSet:s.includes(u.channel.id)||(l.state.clearMessages(),h=l._initializeState(u,"latest").messageSet),h&&(h.pagination=tF(tF({},h.pagination),eb({parentSet:h,requestedPageSize:(null==r?void 0:r.message_limit)||25,returnedPage:u.messages,logger:this.logger})),this.polls.hydratePollCache(u.messages,!0)),o.push(l)}}catch(e){c.e(e)}finally{c.f()}return o}},{key:"search",value:(R=o()(v().mark(function e(t,n){var r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=i.length>2&&void 0!==i[2]?i[2]:{}).offset&&r.next)){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(s=tF(tF({filter_conditions:t},r),{},{sort:r.sort?es(r.sort):void 0}),"string"!=typeof n){e.next=8;break}s.query=n,e.next=13;break;case 8:if("object"!==_()(n)){e.next=12;break}s.message_filter_conditions=n,e.next=13;break;case 12:throw Error("Invalid type ".concat(_()(n)," for query parameter"));case 13:return e.next=15,this.wsPromise;case 15:return e.next=17,this.get(this.baseURL+"/search",{payload:s});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this)})),function(e,t){return R.apply(this,arguments)})},{key:"setLocalDevice",value:function(e){var t,n,r;if(null!==(t=this.wsConnection)&&void 0!==t&&t.isConnecting&&this.wsPromise||(null!==(n=this.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=this.wsFallback)&&void 0!==r&&r.isHealthy())&&this._hasConnectionID())throw Error("you can only set device before opening a websocket connection");this.options.device=e}},{key:"addDevice",value:(I=o()(v().mark(function e(t,n,r,s){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/devices",tF(tF({id:t,push_provider:n},null!=r?{user_id:r}:{}),null!=s?{push_provider_name:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return I.apply(this,arguments)})},{key:"getDevices",value:(L=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/devices",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return L.apply(this,arguments)})},{key:"getUnreadCount",value:(P=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/unread",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"getUnreadCountBatch",value:(A=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/unread_batch",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"setPushPreferences",value:(T=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/push_preferences",{preferences:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"removeDevice",value:(j=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/devices",tF({id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return j.apply(this,arguments)})},{key:"getRateLimits",value:(D=o()(v().mark(function e(t){var n,r,s,i,a,o;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t||{}).serverSide,s=n.web,i=n.android,a=n.ios,o=n.endpoints,e.abrupt("return",this.get(this.baseURL+"/rate_limits",{server_side:r,web:s,android:i,ios:a,endpoints:o?o.join(","):void 0}));case 2:case"end":return e.stop()}},e,this)})),function(e){return D.apply(this,arguments)})},{key:"_addChannelConfig",value:function(e){var t=e.cid,n=e.config;this._cacheEnabled()&&(this.configs[t]=n)}},{key:"channel",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.userID&&!this._isUsingServerAuth())throw Error("Call connectUser or connectAnonymousUser before creating a channel");if(~e.indexOf(":"))throw Error("Invalid channel group ".concat(e,", can't contain the : character"));return t&&"object"===_()(t)?this.getChannelByMembers(e,t):!t&&"object"===_()(r)&&null!==(n=r.members)&&void 0!==n&&n.length?this.getChannelByMembers(e,r):t?this.getChannelById(e,t,r):new e$(this,e,void 0,r)}},{key:"partialUpdateUser",value:(N=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.partialUpdateUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return N.apply(this,arguments)})},{key:"upsertUsers",value:($=o()(v().mark(function e(t){var n,r,s,i;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=tD(t),e.prev=2,r.s();case 4:if((s=r.n()).done){e.next=11;break}if((i=s.value).id){e.next=8;break}throw Error("User ID is required when updating a user");case 8:n[i.id]=i;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.next=21,this.post(this.baseURL+"/users",{users:n});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}},e,this,[[2,13,16,19]])})),function(e){return $.apply(this,arguments)})},{key:"upsertUser",value:function(e){return this.upsertUsers([e])}},{key:"partialUpdateUsers",value:(F=o()(v().mark(function e(t){var n,r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=tD(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}if(r.value.id){e.next=7;break}throw Error("User ID is required when updating a user");case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return e.next=19,this.patch(this.baseURL+"/users",{users:t});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}},e,this,[[1,11,14,17]])})),function(e){return F.apply(this,arguments)})},{key:"deleteUser",value:(q=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/users/".concat(encodeURIComponent(t)),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return q.apply(this,arguments)})},{key:"restoreUsers",value:(H=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/restore",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return H.apply(this,arguments)})},{key:"reactivateUser",value:(V=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/reactivate"),tF({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return V.apply(this,arguments)})},{key:"reactivateUsers",value:(B=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/reactivate",tF({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return B.apply(this,arguments)})},{key:"deactivateUser",value:(W=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/deactivate"),tF({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return W.apply(this,arguments)})},{key:"deactivateUsers",value:(G=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/deactivate",tF({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return G.apply(this,arguments)})},{key:"exportUser",value:(K=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/".concat(encodeURIComponent(t),"/export"),tF({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return K.apply(this,arguments)})},{key:"banUser",value:(J=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/ban",tF({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return J.apply(this,arguments)})},{key:"unbanUser",value:(Y=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/moderation/ban",tF({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return Y.apply(this,arguments)})},{key:"shadowBan",value:(Q=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.banUser(t,tF({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return Q.apply(this,arguments)})},{key:"removeShadowBan",value:(Z=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.unbanUser(t,tF({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return Z.apply(this,arguments)})},{key:"blockUser",value:(ee=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/block",tF({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return ee.apply(this,arguments)})},{key:"getBlockedUsers",value:(ea=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/block",tF({},t?{user_id:t}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return ea.apply(this,arguments)})},{key:"unBlockUser",value:(ec=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/unblock",tF({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return ec.apply(this,arguments)})},{key:"muteUser",value:(eu=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.post(this.baseURL+"/moderation/mute",tF(tF({target_id:t},n?{user_id:n}:{}),r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return eu.apply(this,arguments)})},{key:"unmuteUser",value:(eh=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/unmute",tF({target_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return eh.apply(this,arguments)})},{key:"userMuteStatus",value:function(e){if(!this.user||!this.wsPromise)throw Error("Make sure to await connectUser() first.");for(var t=0;t<this.mutedUsers.length;t+=1)if(this.mutedUsers[t].target.id===e)return!0;return!1}},{key:"flagMessage",value:(ep=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",tF({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return ep.apply(this,arguments)})},{key:"flagUser",value:(ed=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",tF({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return ed.apply(this,arguments)})},{key:"unflagMessage",value:(ef=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",tF({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return ef.apply(this,arguments)})},{key:"unflagUser",value:(ev=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",tF({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return ev.apply(this,arguments)})},{key:"getCallToken",value:(eg=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/calls/".concat(encodeURIComponent(t)),tF({},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return eg.apply(this,arguments)})},{key:"_queryFlags",value:(em=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/flags",tF({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(){return em.apply(this,arguments)})},{key:"_queryFlagReports",value:(ey=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/reports",tF({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(){return ey.apply(this,arguments)})},{key:"_reviewFlagReport",value:(ew=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.patch(this.baseURL+"/moderation/reports/".concat(encodeURIComponent(t)),tF({review_result:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return ew.apply(this,arguments)})},{key:"unblockMessage",value:(e_=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unblock_message",tF({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return e_.apply(this,arguments)})},{key:"markChannelsRead",value:(ek=o()(v().mark(function e(){var t,n=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/channels/read",tF({},t));case 3:case"end":return e.stop()}},e,this)})),function(){return ek.apply(this,arguments)})},{key:"createCommand",value:function(e){return this.post(this.baseURL+"/commands",e)}},{key:"getCommand",value:function(e){return this.get(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"updateCommand",value:function(e,t){return this.put(this.baseURL+"/commands/".concat(encodeURIComponent(e)),t)}},{key:"deleteCommand",value:function(e){return this.delete(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"listCommands",value:function(){return this.get(this.baseURL+"/commands")}},{key:"createChannelType",value:function(e){var t=b()({},{commands:["all"]},e);return this.post(this.baseURL+"/channeltypes",t)}},{key:"getChannelType",value:function(e){return this.get(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"updateChannelType",value:function(e,t){return this.put(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)),t)}},{key:"deleteChannelType",value:function(e){return this.delete(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"listChannelTypes",value:function(){return this.get(this.baseURL+"/channeltypes")}},{key:"translateMessage",value:(eS=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/translate"),{language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return eS.apply(this,arguments)})},{key:"translate",value:(eE=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/translate",{text:t,source_language:r,destination_language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return eE.apply(this,arguments)})},{key:"_normalizeExpiration",value:function(e){var t=null;if("number"==typeof e){var n=new Date;n.setSeconds(n.getSeconds()+e),t=n.toISOString()}else tq(e)?t=e:e instanceof Date&&(t=e.toISOString());return t}},{key:"_validateAndGetMessageId",value:function(e,t){var n;if("string"==typeof e)n=e;else{if(!e.id)throw Error(t);n=e.id}return n}},{key:"pinMessage",value:function(e,t,n,r){var s=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(s,{set:{pinned:!0,pin_expires:this._normalizeExpiration(t),pinned_at:this._normalizeExpiration(r)}},n)}},{key:"unpinMessage",value:function(e,t){var n=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(n,{set:{pinned:!1}},t)}},{key:"updateMessage",value:(eC=o()(v().mark(function e(t,n,r){var s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error("Please specify the message id when calling updateMessage");case 2:return s=b()({},t),delete s.id,["command","created_at","html","latest_reactions","own_reactions","quoted_message","reaction_counts","reply_count","type","updated_at","user","pinned_at","__html"].forEach(function(e){null!=s[e]&&delete s[e]}),null!=n&&(tq(n)?s.user_id=n:s.user={id:n.id}),Array.isArray(s.mentioned_users)&&!tq(s.mentioned_users[0])&&(s.mentioned_users=s.mentioned_users.map(function(e){return e.id})),e.next=10,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t.id)),tF({message:s},r));case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)})),function(e,t,n){return eC.apply(this,arguments)})},{key:"partialUpdateMessage",value:(eR=o()(v().mark(function e(t,n,r,s){var i;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateMessage");case 2:return i=r,null!=r&&tq(r)&&(i={id:r}),e.next=6,this.put(this.baseURL+"/messages/".concat(encodeURIComponent(t)),tF(tF(tF({},n),s),{},{user:i}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return eR.apply(this,arguments)})},{key:"deleteMessage",value:(eO=o()(v().mark(function e(t,n){var r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r={hard:!0}),e.next=4,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t)),r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return eO.apply(this,arguments)})},{key:"undeleteMessage",value:(eI=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/undelete"),{undeleted_by:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return eI.apply(this,arguments)})},{key:"getMessage",value:(eU=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/messages/".concat(encodeURIComponent(t)),tF({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return eU.apply(this,arguments)})},{key:"queryThreads",value:(eL=o()(v().mark(function e(){var t,n,r,s=this,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=tF({limit:10,participant_limit:10,reply_limit:3,watch:!0},i.length>0&&void 0!==i[0]?i[0]:{}),n=tF({},t),t.filter&&Object.keys(t.filter).length>0&&(n.filter=t.filter),t.sort&&(Array.isArray(t.sort)?t.sort.length>0:Object.keys(t.sort).length>0)&&(n.sort=es(t.sort)),e.next=7,this.post("".concat(this.baseURL,"/threads"),n);case 7:return r=e.sent,e.abrupt("return",{threads:r.threads.map(function(e){return new ta({client:s,threadData:e})}),next:r.next});case 9:case"end":return e.stop()}},e,this)})),function(){return eL.apply(this,arguments)})},{key:"getThread",value:(eP=o()(v().mark(function e(t){var n,r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},t){e.next=3;break}throw Error("Please specify the messageId when calling getThread");case 3:return r=tF({participant_limit:100,reply_limit:3,watch:!0},n),e.next=6,this.get("".concat(this.baseURL,"/threads/").concat(encodeURIComponent(t)),r);case 6:return s=e.sent,e.abrupt("return",new ta({client:this,threadData:s.thread}));case 8:case"end":return e.stop()}},e,this)})),function(e){return eP.apply(this,arguments)})},{key:"partialUpdateThread",value:(eA=o()(v().mark(function e(t,n){var r,s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateThread");case 2:r=["created_at","id","last_message_at","type","updated_at","user","reply_count","participants","channel","custom"],e.t0=v().keys(tF(tF({},n.set),n.unset));case 4:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,!r.includes(s)){e.next=8;break}throw Error("You cannot set ".concat(s," field on Thread object. ").concat(s," is reserved for server-side use. Please omit ").concat(s," from your set object."));case 8:e.next=4;break;case 10:return e.next=12,this.patch("".concat(this.baseURL,"/threads/").concat(encodeURIComponent(t)),n);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return eA.apply(this,arguments)})},{key:"getUserAgent",value:function(){if(this.userAgent)return this.userAgent;var e,t="8.60.0",n="";n=this.sdkIdentifier?"stream-chat-".concat(this.sdkIdentifier.name,"-v").concat(this.sdkIdentifier.version,"-llc-v").concat(t):"stream-chat-js-v".concat(t,"-").concat(this.node?"node":"browser");var r=null!==(e=this.deviceIdentifier)&&void 0!==e?e:{};return[["os",r.os],["device_model",r.model],["client_bundle",""]].reduce(function(e,t){var n=m()(t,2),r=n[0],s=n[1];return s&&s.length>0?e.concat("|".concat(r,"=").concat(s)):e},n)}},{key:"setUserAgent",value:function(e){this.userAgent=e}},{key:"_enrichAxiosOptions",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},n=this._getToken(),r=null;null!==this.nextRequestAbortController&&(r=this.nextRequestAbortController.signal,this.nextRequestAbortController=null),null!==(e=t.headers)&&void 0!==e&&e["x-client-request-id"]||(t.headers=tF(tF({},t.headers),{},{"x-client-request-id":eo()}));var s=this.options.axiosRequestConfig||{},i=s.params,a=s.headers,o=k()(s,tM);return tF(tF(tF({params:tF(tF({user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key},t.params),i||{}),headers:tF(tF(tF({},n?{Authorization:n}:void 0),{},{"stream-auth-type":this.getAuthType(),"X-Stream-Client":this.getUserAgent()},t.headers),a||{})},r?{signal:r}:{}),t.config),o||{})}},{key:"_getToken",value:function(){return!this.tokenManager||this.anonymous?null:this.tokenManager.getToken()}},{key:"_startCleaning",value:function(){var e=this;null==this.cleaningIntervalRef&&(this.cleaningIntervalRef=setInterval(function(){for(var t=0,n=Object.values(e.activeChannels);t<n.length;t++)n[t].clean()},500))}},{key:"verifyWebhook",value:function(e,t){return!!this.secret&&function(e,t,n){var r=Buffer.from(t,"utf8"),s=M().createHmac("sha256",r).update(e).digest("hex");try{return M().timingSafeEqual(Buffer.from(s),Buffer.from(n))}catch(e){return!1}}(e,this.secret,t)}},{key:"getPermission",value:function(e){return this.get("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"createPermission",value:function(e){return this.post("".concat(this.baseURL,"/permissions"),tF({},e))}},{key:"updatePermission",value:function(e,t){return this.put("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)),tF({},t))}},{key:"deletePermission",value:function(e){return this.delete("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"listPermissions",value:function(){return this.get("".concat(this.baseURL,"/permissions"))}},{key:"createRole",value:function(e){return this.post("".concat(this.baseURL,"/roles"),{name:e})}},{key:"listRoles",value:function(){return this.get("".concat(this.baseURL,"/roles"))}},{key:"deleteRole",value:function(e){return this.delete("".concat(this.baseURL,"/roles/").concat(encodeURIComponent(e)))}},{key:"sync",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.post("".concat(this.baseURL,"/sync"),tF({channel_cids:e,last_sync_at:t},n))}},{key:"sendUserCustomEvent",value:(eT=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post("".concat(this.baseURL,"/users/").concat(encodeURIComponent(t),"/event"),{event:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return eT.apply(this,arguments)})},{key:"createBlockList",value:function(e){return this.post("".concat(this.baseURL,"/blocklists"),e)}},{key:"listBlockLists",value:function(e){return this.get("".concat(this.baseURL,"/blocklists"),e)}},{key:"getBlockList",value:function(e,t){return this.get("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"updateBlockList",value:function(e,t){return this.put("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"deleteBlockList",value:function(e,t){return this.delete("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"exportChannels",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=tF({channels:e},t);return this.post("".concat(this.baseURL,"/export_channels"),n)}},{key:"exportUsers",value:function(e){return this.post("".concat(this.baseURL,"/export/users"),e)}},{key:"exportChannel",value:function(e,t){return this.exportChannels([e],t)}},{key:"getExportChannelStatus",value:function(e){return this.get("".concat(this.baseURL,"/export_channels/").concat(encodeURIComponent(e)))}},{key:"campaign",value:function(e,t){return e&&"object"===_()(e)?new X(this,null,e):new X(this,e,t)}},{key:"segment",value:function(e,t,n){return"string"==typeof t?new e4(this,e,t,n):new e4(this,e,null,t)}},{key:"validateServerSideAuth",value:function(){if(!this.secret)throw Error("Campaigns is a server-side only feature. Please initialize the client with a secret to use this feature.")}},{key:"createSegment",value:(ej=o()(v().mark(function e(t,n,r){var s;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),s=tF({id:n,type:t},r),e.abrupt("return",this.post(this.baseURL+"/segments",s));case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return ej.apply(this,arguments)})},{key:"createUserSegment",value:(eM=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("user",t,n));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eM.apply(this,arguments)})},{key:"createChannelSegment",value:(eD=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("channel",t,n));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eD.apply(this,arguments)})},{key:"getSegment",value:(eN=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}},e,this)})),function(e){return eN.apply(this,arguments)})},{key:"updateSegment",value:(eF=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/segments/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eF.apply(this,arguments)})},{key:"addSegmentTargets",value:(eH=o()(v().mark(function e(t,n){var r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/addtargets"),r));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return eH.apply(this,arguments)})},{key:"querySegmentTargets",value:(eV=o()(v().mark(function e(t){var n,r,s,i=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:[],s=i.length>3&&void 0!==i[3]?i[3]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/targets/query"),tF({filter:n||{},sort:r||[]},s)));case 5:case"end":return e.stop()}},e,this)})),function(e){return eV.apply(this,arguments)})},{key:"removeSegmentTargets",value:(eG=o()(v().mark(function e(t,n){var r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/deletetargets"),r));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return eG.apply(this,arguments)})},{key:"querySegments",value:(ez=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/query",tF({filter:t,sort:n},r)));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return ez.apply(this,arguments)})},{key:"deleteSegment",value:(eX=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}},e,this)})),function(e){return eX.apply(this,arguments)})},{key:"segmentTargetExists",value:(eY=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/target/").concat(encodeURIComponent(n))));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eY.apply(this,arguments)})},{key:"createCampaign",value:(eZ=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns",tF({},t)));case 2:case"end":return e.stop()}},e,this)})),function(e){return eZ.apply(this,arguments)})},{key:"getCampaign",value:(e0=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/campaigns/".concat(encodeURIComponent(t)),tF({},null==n?void 0:n.users)));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return e0.apply(this,arguments)})},{key:"startCampaign",value:(e1=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/start"),{scheduled_for:null==n?void 0:n.scheduledFor,stop_at:null==n?void 0:n.stopAt}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return e1.apply(this,arguments)})},{key:"queryCampaigns",value:(e2=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.next=3,this.post(this.baseURL+"/campaigns/query",tF({filter:t,sort:n},r||{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t,n){return e2.apply(this,arguments)})},{key:"updateCampaign",value:(e8=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/campaigns/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return e8.apply(this,arguments)})},{key:"deleteCampaign",value:(e9=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/campaigns/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}},e,this)})),function(e){return e9.apply(this,arguments)})},{key:"stopCampaign",value:(e7=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/stop")));case 2:case"end":return e.stop()}},e,this)})),function(e){return e7.apply(this,arguments)})},{key:"enrichURL",value:(e6=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get(this.baseURL+"/og",{url:t}));case 1:case"end":return e.stop()}},e,this)})),function(e){return e6.apply(this,arguments)})},{key:"getTask",value:(te=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get("".concat(this.baseURL,"/tasks/").concat(encodeURIComponent(t))));case 1:case"end":return e.stop()}},e,this)})),function(e){return te.apply(this,arguments)})},{key:"deleteChannels",value:(tt=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/channels/delete",tF({cids:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return tt.apply(this,arguments)})},{key:"deleteUsers",value:(tn=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(void 0!==(n=r.length>1&&void 0!==r[1]?r[1]:{}).user&&!["soft","hard","pruning"].includes(n.user))){e.next=3;break}throw Error("Invalid delete user options. user must be one of [soft hard pruning]");case 3:if(!(void 0!==n.conversations&&!["soft","hard"].includes(n.conversations))){e.next=5;break}throw Error("Invalid delete user options. conversations must be one of [soft hard]");case 5:if(!(void 0!==n.messages&&!["soft","hard","pruning"].includes(n.messages))){e.next=7;break}throw Error("Invalid delete user options. messages must be one of [soft hard pruning]");case 7:return e.next=9,this.post(this.baseURL+"/users/delete",tF({user_ids:t},n));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)})),function(e){return tn.apply(this,arguments)})},{key:"_createImportURL",value:(tr=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/import_urls",{filename:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return tr.apply(this,arguments)})},{key:"_createImport",value:(ts=o()(v().mark(function e(t){var n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{mode:"upsert"},e.next=3,this.post(this.baseURL+"/imports",tF({path:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return ts.apply(this,arguments)})},{key:"_getImport",value:(ti=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports/".concat(encodeURIComponent(t)));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return ti.apply(this,arguments)})},{key:"_listImports",value:(to=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return to.apply(this,arguments)})},{key:"upsertPushProvider",value:(tc=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/push_providers",{push_provider:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return tc.apply(this,arguments)})},{key:"deletePushProvider",value:(tu=o()(v().mark(function e(t){var n,r;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.name,e.next=3,this.delete(this.baseURL+"/push_providers/".concat(encodeURIComponent(n),"/").concat(encodeURIComponent(r)));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e){return tu.apply(this,arguments)})},{key:"listPushProviders",value:(tl=o()(v().mark(function e(){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/push_providers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return tl.apply(this,arguments)})},{key:"createAbortControllerForNextRequest",value:function(){return this.nextRequestAbortController=new AbortController}},{key:"commitMessage",value:(th=o()(v().mark(function e(t){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/commit"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return th.apply(this,arguments)})},{key:"createPoll",value:(tp=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls",tF(tF({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return tp.apply(this,arguments)})},{key:"getPoll",value:(tf=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t)),n?{user_id:n}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return tf.apply(this,arguments)})},{key:"updatePoll",value:(tv=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls",tF(tF({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return tv.apply(this,arguments)})},{key:"partialUpdatePoll",value:(tg=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.patch(this.baseURL+"/polls/".concat(encodeURIComponent(t)),tF(tF({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return tg.apply(this,arguments)})},{key:"deletePoll",value:(tm=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t)),tF({},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t){return tm.apply(this,arguments)})},{key:"closePoll",value:(tb=o()(v().mark(function e(t,n){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.partialUpdatePoll(t,{set:{is_closed:!0}},n));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return tb.apply(this,arguments)})},{key:"createPollOption",value:(tw=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),tF(tF({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return tw.apply(this,arguments)})},{key:"getPollOption",value:(t_=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return t_.apply(this,arguments)})},{key:"updatePollOption",value:(tx=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),tF(tF({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return tx.apply(this,arguments)})},{key:"deletePollOption",value:(tk=o()(v().mark(function e(t,n,r){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return tk.apply(this,arguments)})},{key:"castPollVote",value:(tS=o()(v().mark(function e(t,n,r,s){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote"),tF({vote:r},s?{user_id:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return tS.apply(this,arguments)})},{key:"addPollAnswer",value:(tE=o()(v().mark(function e(t,n,r,s){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.castPollVote(t,n,{answer_text:r},s));case 1:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return tE.apply(this,arguments)})},{key:"removePollVote",value:(tC=o()(v().mark(function e(t,n,r,s){return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote/").concat(encodeURIComponent(r)),tF({},s?{user_id:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return tC.apply(this,arguments)})},{key:"queryPolls",value:(tR=o()(v().mark(function e(){var t,n,r,s,i,a=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},i=(s=a.length>3?a[3]:void 0)?"?user_id=".concat(s):"",e.next=7,this.post(this.baseURL+"/polls/query".concat(i),tF({filter:t,sort:es(n)},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(){return tR.apply(this,arguments)})},{key:"queryPollVotes",value:(tI=o()(v().mark(function e(t){var n,r,s,i,a,o=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:[],s=o.length>3&&void 0!==o[3]?o[3]:{},a=(i=o.length>4?o[4]:void 0)?"?user_id=".concat(i):"",e.next=7,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/votes").concat(a),tF({filter:n,sort:es(r)},s));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e){return tI.apply(this,arguments)})},{key:"queryPollAnswers",value:(tU=o()(v().mark(function e(t){var n,r,s,i,a,o=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:[],s=o.length>3&&void 0!==o[3]?o[3]:{},a=(i=o.length>4?o[4]:void 0)?"?user_id=".concat(i):"",e.next=7,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/votes").concat(a),tF({filter:tF(tF({},n),{},{is_answer:!0}),sort:es(r)},s));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e){return tU.apply(this,arguments)})},{key:"queryMessageHistory",value:(tL=o()(v().mark(function e(){var t,n,r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.post(this.baseURL+"/messages/history",tF({filter:t,sort:es(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(){return tL.apply(this,arguments)})},{key:"updateFlags",value:(tP=o()(v().mark(function e(t,n){var r,s=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.post(this.baseURL+"/automod/v1/moderation/update_flags",tF({message_ids:t,reviewed_by:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return tP.apply(this,arguments)})},{key:"queryDrafts",value:(tA=o()(v().mark(function e(){var t,n,r=arguments;return v().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=tF(tF({},t=r.length>0&&void 0!==r[0]?r[0]:{}),{},{sort:t.sort?es(t.sort):void 0}),e.next=4,this.post(this.baseURL+"/drafts/query",n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(){return tA.apply(this,arguments)})}],[{key:"getInstance",value:function(e,t,n){return tN._instance||("string"==typeof t?tN._instance=new tN(e,t,n):tN._instance=new tN(e,t)),tN._instance}}]),tN}();d()(tH,"_instance",void 0);var tV="Allow",tB=["*"],tW=["*"],tG=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tB,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tW,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:tV;u()(this,e),d()(this,"name",void 0),d()(this,"action",void 0),d()(this,"owner",void 0),d()(this,"priority",void 0),d()(this,"resources",void 0),d()(this,"roles",void 0),this.name=t,this.action=a,this.owner=i,this.priority=n,this.resources=r,this.roles=s};new tG("Allow all",999,tB,tW,!1,tV),new tG("Deny all",1,tB,tW,!1,"Deny")},91282:(e,t,n)=>{"use strict";let WebSocket=n(99364);WebSocket.createWebSocketStream=n(66994),WebSocket.Server=n(53840),WebSocket.Receiver=n(92535),WebSocket.Sender=n(67345),WebSocket.WebSocket=WebSocket,WebSocket.WebSocketServer=WebSocket.Server,e.exports=WebSocket},23242:e=>{"use strict";e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},91125:e=>{"use strict";e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},54527:(e,t,n)=>{"use strict";var r=n(23242);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},35536:e=>{"use strict";e.exports=function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},24233:e=>{"use strict";function t(e,t,n,r,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise(function(s,i){var a=e.apply(n,r);function o(e){t(a,s,i,o,c,"next",e)}function c(e){t(a,s,i,o,c,"throw",e)}o(void 0)})}},e.exports.__esModule=!0,e.exports.default=e.exports},59585:e=>{"use strict";e.exports=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},45837:(e,t,n)=>{"use strict";var r=n(47204),s=n(76529);e.exports=function(e,t,n){if(r())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var a=new(e.bind.apply(e,i));return n&&s(a,n.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports},17434:(e,t,n)=>{"use strict";var r=n(67178);function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,r(s.key),s)}}e.exports=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},27538:(e,t,n)=>{"use strict";var r=n(67178);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},5233:e=>{"use strict";function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},80733:e=>{"use strict";function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},30899:(e,t,n)=>{"use strict";var r=n(76529);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},72065:e=>{"use strict";e.exports=function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}},e.exports.__esModule=!0,e.exports.default=e.exports},47204:e=>{"use strict";function t(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(e.exports=t=function(){return!!n},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},86182:e=>{"use strict";e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},77247:e=>{"use strict";e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,i,a,o=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(e){u=!0,s=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw s}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports},47060:e=>{"use strict";e.exports=function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},67734:e=>{"use strict";e.exports=function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},29963:(e,t,n)=>{"use strict";var r=n(47542);e.exports=function(e,t){if(null==e)return{};var n,s,i=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],-1===t.indexOf(n)&&({}).propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i},e.exports.__esModule=!0,e.exports.default=e.exports},47542:e=>{"use strict";e.exports=function(e,t){if(null==e)return{};var n={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},1429:(e,t,n)=>{"use strict";var r=n(61090).default,s=n(35536);e.exports=function(e,t){if(t&&("object"==r(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return s(e)},e.exports.__esModule=!0,e.exports.default=e.exports},26918:(e,t,n)=>{"use strict";var r=n(61090).default;function s(){e.exports=s=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},i=Object.prototype,a=i.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",h=c.toStringTag||"@@toStringTag";function p(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,n){return e[t]=n}}function d(e,n,r,s){var i,a,c=Object.create((n&&n.prototype instanceof b?n:b).prototype);return o(c,"_invoke",{value:(i=new U(s||[]),a=v,function(n,s){if(a===g)throw Error("Generator is already running");if(a===m){if("throw"===n)throw s;return{value:t,done:!0}}for(i.method=n,i.arg=s;;){var o=i.delegate;if(o){var c=function e(n,r){var s=r.method,i=n.iterator[s];if(i===t)return r.delegate=null,"throw"===s&&n.iterator.return&&(r.method="return",r.arg=t,e(n,r),"throw"===r.method)||"return"!==s&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+s+"' method")),y;var a=f(i,n.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var o=a.arg;return o?o.done?(r[n.resultName]=o.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):o:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,y)}(o,i);if(c){if(c===y)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===v)throw a=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=g;var u=f(e,r,i);if("normal"===u.type){if(a=i.done?m:"suspendedYield",u.arg===y)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(a=m,i.method="throw",i.arg=u.arg)}})}),c}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=d;var v="suspendedStart",g="executing",m="completed",y={};function b(){}function w(){}function _(){}var x={};p(x,u,function(){return this});var k=Object.getPrototypeOf,S=k&&k(k(L([])));S&&S!==i&&a.call(S,u)&&(x=S);var E=_.prototype=b.prototype=Object.create(x);function C(e){["next","throw","return"].forEach(function(t){p(e,t,function(e){return this._invoke(t,e)})})}function R(e,t){var n;o(this,"_invoke",{value:function(s,i){function o(){return new t(function(n,o){!function n(s,i,o,c){var u=f(e[s],e,i);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&a.call(h,"__await")?t.resolve(h.__await).then(function(e){n("next",e,o,c)},function(e){n("throw",e,o,c)}):t.resolve(h).then(function(e){l.value=e,o(l)},function(e){return n("throw",e,o,c)})}c(u.arg)}(s,i,n,o)})}return n=n?n.then(o,o):o()}})}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function L(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,i=function n(){for(;++s<e.length;)if(a.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw TypeError(r(e)+" is not iterable")}return w.prototype=_,o(E,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,h,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,p(e,h,"GeneratorFunction")),e.prototype=Object.create(E),e},n.awrap=function(e){return{__await:e}},C(R.prototype),p(R.prototype,l,function(){return this}),n.AsyncIterator=R,n.async=function(e,t,r,s,i){void 0===i&&(i=Promise);var a=new R(d(e,t,r,s),i);return n.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},C(E),p(E,h,"Generator"),p(E,u,function(){return this}),p(E,"toString",function(){return"[object Generator]"}),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=L,U.prototype={constructor:U,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,s){return o.type="throw",o.arg=e,n.next=r,s&&(n.method="next",n.arg=t),!!s}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var s=r.arg;I(n)}return s}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},76529:e=>{"use strict";function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},71450:(e,t,n)=>{"use strict";var r=n(91125),s=n(77247),i=n(13297),a=n(47060);e.exports=function(e,t){return r(e)||s(e,t)||i(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},78708:(e,t,n)=>{"use strict";var r=n(54527),s=n(86182),i=n(13297),a=n(67734);e.exports=function(e){return r(e)||s(e)||i(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},82917:(e,t,n)=>{"use strict";var r=n(61090).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=r(s))return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},67178:(e,t,n)=>{"use strict";var r=n(61090).default,s=n(82917);e.exports=function(e){var t=s(e,"string");return"symbol"==r(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},61090:e=>{"use strict";function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},13297:(e,t,n)=>{"use strict";var r=n(23242);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=({}).toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},48963:(e,t,n)=>{"use strict";var r=n(80733),s=n(76529),i=n(72065),a=n(45837);function o(t){var n="function"==typeof Map?new Map:void 0;return e.exports=o=function(e){if(null===e||!i(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),s(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,o(t)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},94213:(e,t,n)=>{"use strict";var r=n(26918)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}};